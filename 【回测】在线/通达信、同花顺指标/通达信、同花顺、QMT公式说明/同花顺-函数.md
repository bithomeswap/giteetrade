# 公式编写规则
## 语言规范
在自定义公式里面的各种符号**只能用半角不能用全角**
![](http://u.thsi.cn/fileupload/data/Input/2012/08/07/664d6fd6d0599ac2becc49dcebffd11c.gif)
直接访问数据项的函数
	OPEN[t]为t周期之前的开盘价
	所有行情数据项(CLOSE等)都与此相同
## 标识符
标识符在表达式中只存名称,值保留在符号表
	**标识符包括函数名、参数名和变量名**
- 函数名用来传递函数返回值
- 参数名用于函数调用时的参数传递
- 变量名在计算中存储中间计算结果
## 分隔符
![](http://u.thsi.cn/fileupload/data/Input/2012/08/07/ee7bcd426a3bb06aa04dcd7d7042a60f.gif)
## 赋值语句
`a=b`含义为将b的值付给a
	“＝”和“:=”两个运算符的意义、用法完全相同
	这样主要是为了更好地兼容市场上目前的各种带有公式编辑功能的分析软件
1. `＝`含义为**赋值**
2. `:=`含义为**赋值**
3. `:`含义为**赋值并输出数值或字符串**
4. `:>`含义为**赋值并输出图形**
## 条件语句
其一般形式为:` IF(逻辑表达式) 语句1; ELSE 语句2;`
	如果逻辑表达式的值为非0(TURE)即真,则执行语句1
	如果表达式的值为0(FALSE)即假,则跳过语句1而执行语句2
1. `ELSE语句2;`部分是选择项,表示若逻辑表达式的值为非0则执行语句1,否则跳过语句1继续执行
2. 如果语句1或语句2有多于一条语句要执行时,必须使用`{}`把这些语句包括在其中,并以`;`结尾,此时条件语句形式为:`IF(逻辑表达式){语句体1;}ELSE{语句体2;}`
3. 条件语句**可以嵌套**,`ELSE`语句与最近的一个`IF`语句匹配
4. 可用阶梯式`IF-ELSE-IF`结构。一般形式为:`IF(逻辑表达式1) 语句1;ELSE IF(逻辑表达式2) 语句2;ELSE IF(逻辑表达式3) 语句3;`
## 循环语句
`while`循环的一般形式为:`while(条件)语句;`
	`while`循环表示当条件为真时,便执行语句,直到条件为假才结束循环,并继续执行循环程序外的后续语句。
	可以有**多层循环嵌套**
	语句可以是语句体,此时必须用`{}`括起来
1. 当`break`语句用`while`循环语句中时,可使程序终止循环而执行循环后面的语句
	`break`语句对`if-else`的条件语句不起作用
	在多层循环中,一个`break`语句**只向外跳一层**
2. `continue`语句的作用是跳过循环体中剩余的语句而强行执行下一次循环
	`continue`语句只用在`while`循环体中,常与`if`条件语句一起使用,用来加速循环
## 函数调用
调用函数的基本方式为:`函数名(参数,参数,…)`
1. 其返回值为函数里面的`return`语句规定的返回值
2. 若无return语句,则返回被调用函数里,以函数名命名的变量的值
3. 若无以函数名命名的变量,则返回最后一个输出的值
4. 若无输出的值,则返回最后一个被调用的语句的值
例如:调用KDJ指标,KDJ函数的名称为kdj,其参数和内容如下:
![](http://u.thsi.cn/fileupload/data/Input/2012/08/07/c63e74746bd31141e08080902d265f9a.gif)
```VB
RSV:=(CLOSE-LLV(LOW,N))/(HHV(HIGH,N)-LLV(LOW,N))*100;
K:SMA(RSV,M1,1);
D:SMA(K,M2,1);
J:3*K-2*D
```
当在其它函数里输入`a=KDJ(8,6,6)`的时候,相当于计算N1＝8, M1＝6, M2＝6时的J值,并把这个值赋给a
- 当传递的参数数目不等于被调用函数设置的参数数目时
1. 没有传递参数,则采用原来设置的默认参数计算
2. 传递参数少于被调用函数设置的参数数目,则将参数传过去,依次改变前面同样数目参数的值,后面其它的参数采用原来设置的默认参数计算
3. 传递参数大于被调用函数设置的参数数目,则将参数传过去,依次改变被调用函数的参数值,多余的参数不起作用
- **函数名称不区分大小写**
- 新建的函数,其函数名与其它已存在的函数里面的内部变量**不能重名**
- 自定义公式里面如果有多数据项输出,则调用此函数的时候返回值默认为最后一个输出
1. 如果希望确定某项输出则可用return
2. 也可将函数名指定为其中一项输出
## 关于“空”
所谓“空”即指**没有数据**
在某些情况下,一些数据项可能取不到数据,这时返回值为“空”
1. “空”与任何数据作计算时,相应计算被取消
	7×NULL(即“空”)得到的结果为7
2. “空”与任何数据比较大小时,“空”较小
	-7>NULL(即“空”)得到的结果为1
可以用`ISNULL`函数来判断某个数据是否为“空”
# 行情数据说明
## 代码与周期
由于证券市场里的**各项数据都与代码、时间密切相关**
	这里的各项数据都只能用于特定的一类或几类代码及相应的一个或几个周期
	同一个数据项可能适用于多类代码及多个周期,其具体的数值也将不同
- **代码的分类**
1. 个股(含债券)
2. 沪深指数(仅1A0001(统计上海A、B股基金)、1A0002(统计上海A股)、1A0003(统计上海B股)、399001(统计深圳A、B股基金)、399002(统计深圳A股)、399003(统计深圳B股)六个指数)
3. 期货
- **周期分类**
1. 实时(记录当前传过来的数据)
2. 成交明细(记录每一笔成交的数据)
3. 分时(记录每分钟成交的数据)
4. 分钟K线(以1分钟为单位的K线数据)
5. 日K线(以1个交易日为单位的K线数据)
> [!NOTE] 提示
> 一、分时与分钟K线的区别在于:分钟K线数据较多,包含了与K线相关的高、开、低、收、成交次数等数据
> 二、沪深指数没有成交明细周期的数据
> 三、适用于分钟K线、日K线周期的所有数据,都同时适用于个股与沪深指数,只不过其数据内容不同而已
## 基本数据项
**行情数据**和**财务数据**同属于**基本数据项**
	其数值是主站端直接发过来,其自身并不带周期
1. 编写公式的时候,如果所选用的周期不在此数据项的适用范围内,不会报错，但数值将为“空”
2. 基本数据项都可以直接拖到表格里,它将依照表格的代码、周期而显示相应的数值
3. 基本数据项都可以直接拖到窗口里作为一个曲线输出,但一般不推荐这样做
	其它计算项,即由客户端编写公式计算得到的数据项都是带有周期的
1. 在编写一个公式的时候我们需要确定一个周期(由于分钟K线、日K线周期里的各项数据仅有微小差别,所以统称为**技术分析周期**),以后只有在这个周期下才能调用这个公式
## 通用数据项
### `AMOUNT_IND`(分时金额累加)
返回该周期下的即时（非累加）成交金额
### `CAPITAL_UNTS`(流通股本)
返回当前股票的流通股本，单位为手
### `CLOSE`(收盘)
含义:当周期的收盘价
用于:个股的分钟K线、日K线周期。沪深指数的分钟K线、日K线周期
### `CODE`(代码)
含义：证券的代码
用于：个股的所有周期。沪深指数的所有周期
### `CODETYPE`(证券类型)
含义：指明当前商品的类型。
	0是指数
	1是A股
	2是B股
	3是债券
	4是基金
用于：个股、指数的各种周期
### `DATETIME`(时间)
含义:显示时间
	当用于不同周期的时候,系统会自动传送相应的时间类型
	而具体的显示方案则在“窗口属性”的“时间坐标”项里的“时间格式”一栏里选择
用于:个股、沪深指数所有的周期。
### `HIGH`(最高)
含义：在分钟K线、日K线周期时，分别为当周期的最高价。
用于：个股的分钟K线、日K线周期。沪深指数的分钟K线、日K线周期。
补充：分时中引用最高价，请参考语句‘最高:HHV(NEW,0)’
### `HQSYL`（市盈率-交易所分布）
### `HQSYL2`（市盈率2）
### `HX_STOCKMARK`(股票标记)
### `HX_TEXTMARKTR`（备注）
### `INVOL`(内盘)、`OUTVOL`(外盘)
含义:内盘、外盘(又称为**主动性抛盘**、**主动性买盘**)成交量。
	判断依据为若某笔成交,其价格小于等于前一次传过来的买一的价格,则称为内盘
	若其价格大于等于前一次传过来的卖一的价格,则称为外盘
	内外盘之和一般不等于总成交量
1. 在周期为“实时”、“分时”时,为当日的内、外盘
2. 在周期为“分钟K线”和“日K线”时,分别为某一分钟和某一日的内、外盘
3. 用于指数时指所有相应股票的内、外盘之和
用于:个股的实时、分时、分钟K线、日K线周期。沪深指数的实时、分时、分钟K线、日K线周期。
### `ISBN`（ISBN）
### `LOW`(最低)
含义：在分钟K线、日K线周期时，分别为当周期的最低价。
用于：个股的分钟K线、日K线周期。沪深指数的分钟K线、日K线周期。
补充：分时中引用最高价，请参考语句‘最低:LLV(NEW,0)’
### `MARKETTYPE`(市场类别)
### `MONEY`(金额)
含义:在实时、分时周期时代表当日的成交金额之和
	在分钟K线、日K线周期时代表那一个周期的成交金额只和
	当用于指数时,指此指数所包含所有交易品种成交金额之和
用于:个股的实时、分时、分钟K线、日K线周期。沪深指数的实时、分时、分钟K线、日K线周期
### `MONEYFS`（分时金额）
### `NEW`(现价)
含义:用于个股时为**最近一笔成交的价格**;用于沪深指数时为最近一次从交易所传来的指数值。
用于:个股的实时、成交明细周期;沪深指数的实时周期。
### `NEWVOL`(现手)
含义:用于个股时为**最近一笔成交的成交量**;用于沪深指数时为对应市场的所有股票的最后一笔成交量之和。
用于:个股的实时、成交明细周期。沪深指数的实时周期。
### `OPEN`(开盘)、
含义:在实时周期时,为当日的开盘价、最高价、最低价;在分钟K线、日K线周期时,分别为当周期的开盘价、最高价、最低价。
用于:个股的实时、分钟K线、日K线周期。沪深指数的实时、分钟K线、日K线周期。
### `OPENVOL`(开盘量)
含义:开盘时第一笔成交的成交量。当用于指数时,指此指数所包含所有交易品种开盘集合竞价成交量之和
用于:个股的实时、日K线周期。沪深指数的实时、日K线周期
### `PRE`(昨收)
含义:上一交易日的收盘价。
	在分钟K线周期,也是昨日收盘价,而不是上一周期的收盘价
	如果当天有除权,则其值为除权之后的昨日收盘价
用于:所有类型、所有周期。
### `PRENAME`(证券前缀)
### `RZRQ`（融资融券）
### `TOTALCAPITAL_UNTS`（总股本）
返回当前股票的总股本，单位为手
TQFLAG(复权状态)
返回当前K线的复权状态
	0:不复权 
	1:前复权 
	2:后复权
### `VALIDBEGIN`(起始)、`VALIDEND`(终止)
含义:区间统计的起始、终止时间
	当用于不同周期的时候,系统会自动传送相应的时间类型
	而具体的显示方案则在“窗口属性”的“时间坐标”项里的“时间格式”一栏里选择
	与DATETIME(时间)的用法类似
用于:个股、沪深指数所有的周期
### `VOL`(总手)
含义:在实时、分时、成交明细周期时代表**当日**的成交量之和
	在分钟K线、日K线周期时代表**那一个周期**的成交量只和
	当用于指数时,指此指数所包含所有交易品种成交量之和
用于:个股的实时、分时、成交明细、分钟K线、日K线周期。沪深指数的实时、分时、分钟K线、日K线周期
	**VOL与MONEY相比多了一个成交明细周期**
### `VOLAMOUNT1`(成交笔数)
### `YJLX`（应计利息）
### `ZQMC`（证券名称）
含义：证券的名称。
用于：个股的所有周期。沪深指数的所有周期。
## 个股数据
### `BUY_____`(买n)、`SELL_____`(卖n)
1. BUYPRICE1(买一)、BUYPRICE2(买二)、BUYPRICE3(买三)
2. SELLPRICE1(卖一)、SELLPRICE2(卖二)、SELLPRICE3(卖三)
3. BUYCOUNT1(买一量)、BUYCOUNT2(买二量)、BUYCOUNT3(买三量)
4. SELLCOUNT1(卖一量)、SELLCOUNT2(卖二量)、SELLCOUNT3(卖三量)
5. BUY_MONEY1（买一金额）、BUY_MONEY2（买二金额）、BUY_MONEY3（买三金额）
含义:委托买入、卖出价格一、二、三及对应的委托数量
用于:个股的实时周期
### `FIVEDAYVOL`(五日总量)
含义:过去五日各交易成交量之和
用于:个股的所有的周期。(主要用来计算量比)
### `MINE`（是否有雷）
### `PERVOL`(分价量比)
### `VOLAMOUNT`(成交次数)
含义:在周期为“实时”时,为**当日**的成交次数。在周期为“分钟K线”和“日K线”时,分别为**某一分钟**和**某一日**的成交次数
用于:个股的实时、分钟K线、日K线周期
### `VOLCLASS`(成交量分类)
- “3”为“成交价<=买三价”
- “2”为“买三价<成交价<=买二价”
- “1”为“买二价<成交价<=买一价”
- “0”为“买一价<成交价<卖一价”
- “5”为“卖一价<=成交价<卖二价”
- “6”为“卖二价<=成交价<卖三价”
- “7”为“卖三价<=成交价”
这里的买卖盘的价格都是指上一次传过来的价格,与内外盘原理相同
也可以将“成交量分类”视为划分更为详细的内外盘
用于:个股的实时、分时、成交明细。
### `SELLPRICE`(卖出)、`BUYPRICE`(买入)
含义:本次成交时的委托卖出、买入价。即用于成交明细的买一价、卖一价。
用于:个股的成交明细周期。
### 盘后成交额
### 日线盘后成交额
### 十档委托分布
### 五百档委托分布
## 仅适用于大盘的数据项
### `SELLCOUNT(`委卖)、`BUYCOUNT`(委买)
含义:当前本类指数所有股票的卖出数量、买入数量之和
用于:沪深指数的实时、分时周期
### `FALLTREND`(下跌趋势)、`RISETREND`(上涨趋势)
含义:当前本类指数所有下跌、上涨股票的最新价之和除以本类指数所有股票的最新价之和
用于:沪深指数的实时、分时周期
### `FALLCOUNT`(下跌家数)、`RISECOUNT`(上涨家数)
含义:当前本类指数所有下跌、上涨股票的家数之和
用于:沪深指数的实时、分时周期
### `FALLLIMITCOUNT`（跌停家数）、`RISELIMITCOUNT`（涨停家数）
该字段表示指数下当天跌停、涨停的股票个数
注：该字段在美股里用作52周最低最高价日期
### `HQLTSZ`(流通市值)
### `HQZSZ`(总市值)
### `IDX_FLAG`(指数级别标识)
### `IDX_PJGB`(平均股价)
### `IDX_SYL`(静态市盈率)
### `IDX_YBJJ`（样本均价）
### `IDX_YBSL`（样本数量）
### `IDX_ZB`（占比）
### `IDX_ZSZ`(总市值)
### `INDEXLEAD`(领先指标)
含义:即不加权的指标涨跌幅再乘以10000
	具体地说就是,设A＝“当前本类指数所有股票的最新价之和”,B＝“当前本类指数所有股票的昨日收盘价”,那么INDEXLEAD＝(A-B)/B×10000。
用于:沪深指数的实时、分时周期。
INDEXTYPE（指数种类）
### `TOTALSTOCK`(本类股票总数)
含义:本类股票家数之和
用于:沪深指数的实时周期
## 股本结构

| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| AG                  | A股                  |
| AZGB                | A股总股本               |
| BBRQ                | 股本变动日期              |
| BG                  | B股                  |
| BZGB                | B股总股本               |
| FQRG                | 发起人股                |
| FRGJW               | 境外法人股               |
| FXJA                | A股发行价               |
| GDZS                | 股东总数                |
| GJG                 | 国家股                 |
| HG                  | H股                  |
| NBZGG               | 内部职工股               |
| SHGZG               | 流通股                 |
| YXG                 | 优先股                 |
| ZCXS                | 主承销商                |
| ZGS                 | 总股数                 |
| ZPG                 | 转配股                 |
| ZZYLTGB             | 自有流通股本              |
## 前十大股东

| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| CGS_                | 持股数（1-10）           |
| GDMC_               | 股东名称（1-10）          |
## 资产负债表
| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| CH                  | 存货                  |
| CHDJZB              | 存货跌价准备              |
| CQFZHJ              | 长期负债合计              |
| CQJK                | 长期借款                |
| CQTZHJ              | 长期投资合计              |
| CQYFK               | 长期应付款               |
| DQJK                | 短期借款                |
| FZHJ                | 负债合计                |
| GDQYHJ              | 股东权益合计              |
| GDZCHJ              | 固定资产合计              |
| GJJ                 | 公积金                 |
| HBZJ                | 货币资金                |
| LDFZHJ              | 流动负债合计              |
| LDZCHJ              | 流动资产合计              |
| MGGJJ               | 每股公积金               |
| QTYSK               | 其他应收款               |
| WFPLR               | 未分配利润               |
| WXZC                | 无形资产                |
| YFZHK               | 应付债款                |
| YNDQFZ              | 一年内到期的长期的长期负债       |
| YFZKJE              | 应付账款净额              |
| ZCZJ                | 资产总计                |
## 利润表
| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| BTSR                | 补贴收入                |
| CHDJSS              | 存货跌价损失              |
| CWFY                | 财务费用                |
| DTMGSY              | 动态每股收益              |
| DTSCJLR             | 动态市场净利润             |
| GLFY                | 管理费用                |
| JLR                 | 净利润                 |
| JTSCJLR             | 静态市场净利润             |
| KFJLR               | 扣非净利润               |
| LRZE                | 利润总额                |
| QTLR                | 其他业务利润              |
| SCGDQYHJ            | 市场股东权益合计            |
| SDS                 | 所得税                 |
| SDSFH               | 所得税返还               |
| TZSY                | 投资收益                |
| YYFY                | 营业费用                |
| YYWSR               | 营业外收入               |
| ZYYWCB              | 主营业务成本              |
| ZYYWLR              | 主营业务利润              |
| ZYYWSR              | 主营业务收入              |
## 现金流量表
| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| JYJE                | 经营活动产生的现金流量净额       |
| JYR_XS              | 销售商品提供劳务收到的现金       |
| RZZL                | 融资租赁固定资产            |
| TZJE                | 投资活动产生的现金流量净额       |
| XJJZJ               | 现金及现金等价物净增加额        |
## 财务报表附注
| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| 3YYSZK              | 3年以内应收帐款            |
| CQGPTZ              | 长期股票投资              |
| DQGPTZ              | 短期股票投资              |
| YSZK1_2Y            | 1-2年以内应收帐款          |
| YSZK1Y              | 1年以内应收帐款            |
| YSZK2_3Y            | 2-3年以内应收帐款          |
## 计算项
| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| CJ_JZCSYL           | 净资产收益率              |
| DTJLR               | 动态净利润               |
| l_JZCSYL            | 净资产收益率(国际标准)        |
| JLRNEW              | 净利润NEW              |
| JYLX                | 净利润新                |
| MGJZC               | 每股净资产               |
| MGSY                | 每股收益                |
| MGSYX               | 每股收益新               |
| MGXJLLJE            | 每股经营活动产生的现金流量金额     |
| MGYL                | 每股盈利                |
| NBJLR               | 年报净利润               |
| TTMJLR              | TTM净利润              |
| YEARJLR             | 年报净利润               |
| ZJGCGGXS            | 在建工程杠杆系数            |
| ZJLC                | 资金流出                |
| ZJLR                | 资金流入                |
| 每股盈利新               | 每股盈利新               |
## 资金数据
| <center>名称</center> | <center>含义</center> |
| ------------------- | ------------------- |
| BIGBUYCOUNT1        | 主动买入特大单量            |
| BIGBUYCOUNT2        | 主动买入大单量             |
| BIGBUYCOUNT3        | 主动买入中单量             |
| BIGBUYCOUNT4        | 主动买入小单量             |
| BIGSELLCOUNT1       | 主动卖出特大单量            |
| BIGSELLCOUNT2       | 主动卖出大单量             |
| BIGSELLCOUNT3       | 主动卖出中单量             |
| BIGSELLCOUNT4       | 主动卖出小单量             |
| SMALLBUYCOUNT4      | 主动买入小单量             |
| SMALLSELLCOUNT4     | 主动卖出小单量             |
| WAITBUYCOUNT1       | 主动买入特大单量            |
| WAITBUYCOUNT2       | 主动买入大单量             |
| WAITBUYCOUNT3       | 主动买入中单量             |
| WAITSELLCOUNT1      | 主动卖出特大单量            |
| WAITSELLCOUNT2      | 主动卖出大单量             |
| WAITSELLCOUNT3      | 主动卖出中单量             |
## 时间函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                                                                                                            |
| ------------------- | ------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| BARPOS              | K线位置                |                     |                                                                                                                                                                                |
| COUNTTIME           | 时间差                 |                     | COUNTTIME（N,L,K）。N、L为时间，其格式为YYYYMMDD。K为1、2或者3。当K为1时返回第二个之间比第一个时间晚多少年。当K为2时返回第二个之间比第一个时间晚多少月。当K为3时返回第二个之间比第一个时间晚多少日。例如：COUNTTIME（20000808，19990606，2）其返回值为-2。注意：这里返回值有正负号       |
| DATE                | 年月日                 |                     |                                                                                                                                                                                |
| DATE_S              | 年月日-1900            |                     | 返回当前的年月日，年份只返回后两位。如果是2000年之后，需要在最前边加1                                                                                                                                          |
| DAY                 | 日                   |                     |                                                                                                                                                                                |
| DAYSTOTODAY         | 距离今日的天数             |                     | 取得K线天数距离今日为第几个自然日<br>                                                                                                                                                          |
| FORMATTIME          | 时间格式                | 转换时间格式              | FORMATTIME(N)。目前只支持 N=1 把当前时间转换成距开盘分钟数返回。例如：分时中的量比曲线公式：(VOL*(TRADETIME-1)*5)/(FORMATTIME(1)*FIVEDAYVOL)。                                                                       |
| FORMOPEN            | 距开盘分钟               | 求当前时刻距开盘有多长时间       | 返回当前时刻距开盘有多长时间，单位为分钟。例如：当前时刻为早上十点，则返回31                                                                                                                                        |
| HOUR                | 小时                  |                     |                                                                                                                                                                                |
| LUNARDATE           | 农历                  | 返回农历日期              | LUNARDATE(N) 或者 LUNARDATE。当采用第一种调用方式时，参数N代表显示格式，可设置值为0、1、2。下面用例子来说明这3种显示格式：当公历日期是2015年1月1日时，格式0显示结果为“甲午年十一月十一”，格式1显示结果为“马”，格式2显示结果为“丙子月 丁丑日”。当采用第二种调用方式时，显示结果与LUNARDATE(0)是一样的 |
| MACHINEDATE         | 机器日期                |                     | 返回当前客户端机器时间从1900以来的的年月日,比如2016年10月1日为:01161001,MACHINEDATE+19000000后才是真正的日期值                                                                                                   |
| MACHINEDATETIME     | 客户机器时间返回小时分秒        |                     | 返回当前客户端机器时间的小时分钟秒，例如11:01:15时返回110115                                                                                                                                          |
| MACHINEWEEK         | 机器周期                |                     | 返回当前客户端时间为星期几，例如，星期四时，返回4                                                                                                                                                      |
| MINUTE              | 分钟                  |                     |                                                                                                                                                                                |
| MONTH               | 月份                  |                     |                                                                                                                                                                                |
| PERIOD              | 周期                  |                     | 返回周期类型，取值范围为0~14，依次分别是1分钟、5分钟、15分钟、30分钟、60分钟、日线、周线、月线、自定义多分钟周期、自定义多日周期、季线、年线、5秒线（暂不支持）、多秒线（暂不支持）、其它周期                                                                          |
| PERIODNAME          | 周期                  |                     |                                                                                                                                                                                |
| SOLARTERM           | 节气                  |                     |                                                                                                                                                                                |
| TIME                | 时分秒                 |                     |                                                                                                                                                                                |
| TIME2               | 小时分钟秒               |                     | 返回当前的小时分钟秒（秒实际不生效）的数据，适用于日线以下周期                                                                                                                                                |
| TIME_HM             | 小时分钟                |                     | 返回当前的小时分钟数据,适用于日线以下周期。例如14:55时，返回1455                                                                                                                                          |
| TOTALFZNUM          | 总交易时间（分钟）           |                     | 返回该品种的每天的总交易分钟数                                                                                                                                                                |
| TRADETIME           | 总开盘分钟               | 求当前代码类型的开市交易时间      | 返回交易时间，单位为分钟。目前一般市场都返回241，与日期或具体的股票无关                                                                                                                                          |
| VALIDBEGINTIME      | 起始时间                |                     |                                                                                                                                                                                |
| VALIDENDTIME        | 终止时间                |                     |                                                                                                                                                                                |
| WEEKDAY             | 星期                  |                     |                                                                                                                                                                                |
| WEEKOFYEAR          | 当前星期数               |                     | 取得该周是年内第几周，例如本年第二周返回2                                                                                                                                                          |
| YEAR                | 年份                  |                     |                                                                                                                                                                                |
## 逻辑函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                                                       |
| ------------------- | ------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| CROSS               | 上穿                  | 两条线交叉               | CROSS(A,B)表示当A从下方向上穿过B时返回1,否则返回0。例如：CROSS(MA(CLOSE,5),MA(CLOSE,10))表示5日均线与10日均线交金叉                                        |
| DOWNNDAY            | 连跌                  | 连跌N个周期              | DOWNNDAY(CLOSE,M)表示是否连跌M个周期                                                                                               |
| EVERY               | 连续满足                | 是否一直存在条件满足          | EVERY(CLOSE>OPEN,3)表示是否连续3天收阳线                                                                                            |
| EXIST               | 存在                  | 是否存在                | EXIST(CLOSE>OPEN,3)表示是否3天内存在阳线                                                                                            |
| IF                  | 条件                  | 根据条件求不同的值           | IF(X,A,B)若X不为0则返回A，否则返回B。 例如：IF(CLOSE>OPEN,HIGH,LOW)表示该周期收阳则返回最高值，否则返回最低值                                                 |
| LAST                | 持续存在                | 是否连续存在              | LAST(X,A,B)，A>B，表示从前A日到前B日一直满足X条件。若A为0，表示从第一天开始，若B为0，表示最后一天                                                               |
| LONGCROSS           | 维持若干周期后上穿           | 两条线维持一定周期后交叉        | LONGCROSS(A,B,N)表示A在N周期内都小于B,本周期从下方向上穿过B时返回1,否则返回0。例如：LONGCROSS(MA(CLOSE,5),MA(CLOSE,10),5)表示5日均线维持5周期后与10日均线交金叉          |
| NDAY                | 连续大于                | 是否连续存在X>Y           | NDAY(CLOSE,OPEN,3)表示是否连续3天收阳线                                                                                             |
| UPNDAY              | 连涨                  | 连涨M个周期              | UPNDAY(CLOSE,M)表示是否连涨M个周期                                                                                                 |
| VALUEWHEN           | 条件判断                |                     | VALUEWHEN(COND,X) <br>当COND条件成立时,取X的当前值,否则取VALUEWHEN的上个值。例如：VALUEWHEN(CLOSE>5, H); 如果当前的收盘价 >5, 则返回最高价，否则返回前一个VALUEWHEN的值 |
## 引用函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                                                                                    |
| ------------------- | ------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| BACKSET             | 向前赋值                | 将当前位置到若干周期前的数据设为X   | BACKSET(X,N)，若X非0，将当前位置到N周期前的数值设为X。例如：BACKSET(CLOSE>OPEN,2)若收阳则将该周期及前2个周期数值设为1，否则为0                                                                    |
| BARSCOUNT           | 有效周期数               | 求总的周期数              | BARSCOUNT(X)，第一个有效数据到当前的天数                                                                                                                             |
| BARSLAST            |                     | 上一次条件成立到当前的周期数      | BARSLAST(X)，上一次X不为0到现在的天数。例如：BARSLAST(CLOSE/REF(CLOSE,1)>=1.1)表示上一个涨停板到当前的周期数                                                                          |
| BARSSINCE           |                     | 第一个条件成立到当前的周期数      | BARSSINCE(X)：第一次X不为0到现在的天数。例如：BARSSINCE(HIGH>10)表示股价超过10元时到当前的周期数                                                                                      |
| BARSSINCEN          |                     |                     | BARSSINCEN(COND,X)<br>返回X个周期内，第一次满足COND的日期距今的周期数                                                                                                       |
| COUNT               | 满足条件的周期数            |                     | COUNT(X,N)，统计N周期中满足X条件的周期数，若N=0则从第一个有效值开始。例如：COUNT(CLOSE>OPEN,20)表示统计20周期内收阳的周期数                                                                       |
| DMA                 | 动态移动平均              |                     | DMA(X,A)，求X的动态移动平均。算法： 若Y=DMA(X,A)则 `Y=A*X+(1-A)*Y'`，其中Y'表示上一周期Y值，A必须小于1。例如：DMA(CLOSE,VOL/CAPITAL)表示求以换手率作平滑因子的平均价                                     |
| EMA                 | 指数平滑移动平均            |                     | EMA(X,N)，求X的N日指数平滑移动平均。算法：若Y=EMA(X,N)则`Y=[2*X+(N-1)*Y']/(N+1)`，其中Y'表示上一周期Y值。例如：EMA(CLOSE,30)表示求30日指数平滑均价                                               |
| FILTER              | 信号过滤                | 过滤连续出现的信号           | FILTER(X,N):X满足条件后，将其后N周期内的数据置为0,<br>若N为0表示将其后的所有数据置0                                                                                                  |
| HHV                 | 最高值                 |                     | HHV(X,N)，求N周期内X最高值，N=0则从第一个有效值开始。 例如：HHV(HIGH,30)表示求30日最高价                                                                                             |
| HHVBARS             | 最高值周期数              | 求上一高点到当前的周期数        | HHVBARS(X,N):求N周期内X最高值到当前周期数，N=0表示从第一个有效值开始统计。<br>例如：HHVBARS(HIGH,0)求得历史新高到到当前的周期数                                                                     |
| LLV                 | 最低值                 |                     | LLV(X,N),求N周期内X最低值，N=0则从第一个有效值开始。例如：LLV(LOW,0)表示求历史最低价                                                                                                 |
| LLVBARS             | 最低值周期数              | 求上一低点到当前的周期数        | LLVBARS(X,N):求N周期内X最低值到当前周期数，N=0表示从第一个有效值开始统计。<br>例如：LLVBARS(HIGH,10)求得10日最低点到当前的周期数                                                                   |
| MA                  | 简单移动平均              |                     | MA(X,N)，求X的N日移动平均值。算法：(X1+X2+X3+，，，+Xn)/N。例如：MA(CLOSE,10)表示求10日均价                                                                                      |
| REF                 | 向前引用                | 引用若干周期前的数据          | REF(X,A),引用A周期前的X值。例如：REF(CLOSE,1)表示上一周期的收盘价，在日线上就是昨收                                                                                                  |
| REFX                | 向后引用                | 引用若干周期后的数据          | REFX(&X,A),引用A周期后的X值。例如：REFX(&CLOSE,1)表示后一周期的收盘价，在日线上就是明收                                                                                              |
| SMA                 | 移动平均                |                     | SMA(X,N,M)，求X的N日移动平均，M为权重。算法： 若Y=SMA(X,N,M)则 Y=[M*X+(N-M)*Y']/N,其中Y'表示上一周期Y值，N必须大于M。例如：SMA(CLOSE,30,1)表示求30日移动平均价                                      |
| SUM                 | 求和                  |                     | SUM(X,N)，统计N周期中X的总和，N=0则从第一个有效值开始。例如：SUM(VOL,5)周期设为日线时，表示最近5个交易日的成交量之和。SUM(VOL,0)表示从传数据过来第一天起的成交量总和，具体如在区间统计里统计“总手” SUM(VOL,0)即是指全区间的成交量之和             |
| SUMBARS             | 求和                  | 向前累加到指定值到现在的周期数     | SUMBARS(X,A):将X向前累加直到大于等于A,返回这个区间的周期数。<br>例如：SUMBARS(VOL,CAPITAL)求完全换手到现在的周期数                                                                          |
| WMA                 | 加权移动平均              |                     | WMA(X,A),求X的加权移动平均。<br>算法: 若Y=WMA(X,A) 则 `Y=(N*X0+(N-1)*X1+(N-2)*X2)+...+1*XN)/(N+(N-1)+(N-2)+...+1)`X0表示本周期值，X1表示上一周期值。<br>例如：WMA(CLOSE,20)表示求20日加权均价 |
## 算术函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                                  |
| ------------------- | ------------------- | ------------------- | ---------------------------------------------------------------------------------------------------- |
| ABS                 | 平均值                 |                     | ABS(X)返回X的绝对值。例如：ABS(-34)返回34                                                                        |
| ACOS                | 反余弦                 |                     |                                                                                                      |
| ASIN                | 反正弦                 |                     |                                                                                                      |
| ATAN                | 反正切                 |                     |                                                                                                      |
| BETWEEN             | 介于                  |                     | BETWEEN(A,B,C)表示A处于B和C之间时返回1，否则返回0 <br>例如：BETWEEN(CLOSE,MA(CLOSE,10),MA(CLOSE,5))表示收盘价介于5日均线和10日均线之间 |
| BITWISE             | 位操作                 |                     |                                                                                                      |
| CEIL                | 向上取整                |                     |                                                                                                      |
| COS                 | 余弦                  |                     | COS(X)返回X的余弦值                                                                                        |
| DIV                 | 商                   |                     |                                                                                                      |
| EXP                 | 指数                  |                     |                                                                                                      |
| FLOOR               | 向下取整                |                     |                                                                                                      |
| INTPART             | 取整                  |                     |                                                                                                      |
| ISNULL              | 空                   | 判断是否为空              | ISNULL(A)表示如果A为空（即没有数据）则返回1,否则返回0                                                                    |
| LN                  | 自然对数                |                     |                                                                                                      |
| LOG                 | 以10为底的对数            |                     |                                                                                                      |
| MAX                 | 最大值                 |                     | MAX(A,B)返回A和B中的较大值。例如：MAX(CLOSE-OPEN,0)表示若收盘价大于开盘价返回它们的差值，否则返回0                                      |
| MAX_N               | 最大值                 |                     | 返回N个数中的最大值，例如：MAX_N(A1,A2,A3,A4)返回A1、A2、A3、A4中的最大值                                                   |
| MIN                 | 最小值                 |                     | MIN(A,B)返回A和B中的较小值。例如：MIN(CLOSE,OPEN)返回开盘价和收盘价中的较小值                                                  |
| MIN_N               | 最小值                 |                     | 返回N个数中的最小值，例如：MIN_N(A1,A2,A3)返回A1、A2、A3中的最小值                                                         |
| MOD                 | 取模                  | 求模运算                | MOD(A,B)返回A对B求模。例如：MOD(26,10)返回6                                                                     |
| NOT                 | 非                   | 逻辑非                 | NOT(X)返回非X，即当X=0时返回1，否则返回0。例如：NOT(5>3)返回0                                                            |
| POW                 | 幂                   |                     | POW（X,Y）。求X的Y次幂。例如：POW（2,3）为8                                                                        |
| RAND                | 随机数                 |                     |                                                                                                      |
| RANGE               | 范围                  | 介于某个范围之间            | RANGE(A,B,C)表示A大于B同时小于C时返回1，否则返回0。例如：RANGE(CLOSE,MA(CLOSE,5),MA(CLOSE,10))表示收盘价大于5日均线并且小于10日均线       |
| REVERSE             | 求反                  | 求相反数                | REVERSE(X)返回-X。 例如REVERSE(CLOSE)返回-CLOSE                                                             |
| SIN                 | 正弦                  |                     |                                                                                                      |
| SQRT                | 平方根                 |                     | SQRT(X)为X的平方根。例如：SQRT(CLOSE)收盘价的平方根                                                                  |
| TAN                 | 正切                  |                     |                                                                                                      |
## 统计函数
| <center>名称</center> | <center>含义</center> | <center>用法</center>                                                                       |
| ------------------- | ------------------- | ----------------------------------------------------------------------------------------- |
| AVEDEV              | 平均绝对差               | AVEDEV(X,N)                                                                               |
| CORREL              | 相关系数                | CORREL(X,Y,N)为X与Y的N周期相关系数，其有效值范围<br>在-1 ~ 1之间<br>例如:CORREL(CLOSE,INDEXC,10)表示收盘价与大盘指数之间的  |
| COVAR               | 协方差                 | COVAR(X,Y,N)为X与Y的N周期协方差<br>例如:COVAR(CLOSE,INDEXC,10)表示收盘价与大盘指数之间<br>的10周期协方差              |
| DEVSQ               | 数据偏差平方和             | DEVSQ(X,N)                                                                                |
| FORCAST             | 线性回归预测值             | FORCAST(X,N)为X的N周期线性回归预测值。<br>例如:FORCAST(CLOSE,10)表示求10周期线性回归预测本周期收盘价                     |
| KURT                | 峰值                  | KURT(X,N)<br>返回数据集的峰值。峰值反映与正态分布相比某一分布的<br>尖锐度或平坦度。正峰值表示相对尖锐的分布。<br>负峰值表示相对平坦的分布           |
| SKEW                | 偏斜度                 | SKEW(X,N)<br>返回分布的偏斜度。偏斜度反映以平均值为中心的分布的<br>不对称程度。正偏斜度表示不对称边的分布更趋向正值。<br>负偏斜度表示不对称边的分布更趋向负值 |
| SLOPE               | 线性回归斜率              | SLOPE(X,N)为X的N周期线性回归线的斜率。<br>例如:SLOPE(CLOSE,10)表示求10周期线性回归线的斜率                            |
| STD                 | 标准差                 | STD(X,N)为X的N日估算标准差                                                                        |
| STDP                | 总体标准差               | STDP(X,N)为X的N日总体标准差                                                                       |
| VAR                 | 估算样本方差              | VAR(X,N)为X的N日估算样本方差                                                                       |
| VARP                | 总体样本方差              | VARP(X,N)为X的N日总体样本方差                                                                      |
| VARPDS              | 样本总体方差              | VARP_DS(VAR,N)<br>返回VAR变量在N周期内的方差。计算方法为Σ(x_i-x_p)^2/n，其中x_p为样本X的平均值                       |
## 指标函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                                                                                                                                                                                                                                                              |
| ------------------- | ------------------- | ------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CM                  | 成本分布                | 用于画筹码成交分布云          | CM(0,1,2,0,1000,1,0,0,0,1)<br>参数含义：<br>1、计算总天数：0表示计算全部天数。<br>2、当日成本算法：平均分布为0，三角分布为1。<br>3、精度：一般是2。<br>4、起始位置：0是从当天开始计算,1是从前一天开始算,类推。<br>5、换手：默认为100000%换手。<br>6、计算方式：按成交量计算为1，按成交金额计算为2。<br>7、筹码计算价格限制的最大值：默认为0。<br>8、筹码计算价格限制的最小值：默认为0。<br>9、功能切换：0表示筹码分布和火焰山（自定义天数前的筹码云），1表示活跃度（自定义天数内的筹码云）。<br>10、历史换手衰减系数：默认为1，可取0.1~10之间的数值 |
| COST                |                     | 成本分布情况              | COST(10)，表示10%获利盘的价格是多少，即有10%的持仓量在该价格以下，其余90%在该价格以上,为套牢盘。该函数仅对日线分析周期有效                                                                                                                                                                                                                                                           |
| FLATZIG             |                     | 归一化之字转向             | FLATZIG(K,N,ABS),当价格变化量超过N%时转向,<br>K表示0:开盘价,1:最高价,2:最低价,3:收盘价,4:低点采用最<br>低价、高点采用最高价。若ABS为0或省略，则表示相对FLATZIG<br>转向，否则为绝对FLATZIG转向。<br>与ZIG函数不同的是本函数返回值在0~1之间。<br>例如：FLATZIG(3,5)表示收盘价的5%的归一化ZIG转向<br>★本函数的计算结果引用了未来数据★                                                                                                             |
| PEAK                | 波峰值                 | 前M个ZIG转向波峰值         | PEAK(K,N,M,ABS)表示之字转向ZIG(K,N,ABS)的前M个波峰的数<br>值,M必须大于等于1。若ABS为0或省略，则表示相对ZIG转向，<br>否则为绝对ZIG转向。<br>例如：PEAK(1,5,1)表示%5最高价ZIG转向的上一个波峰的数值                                                                                                                                                                                              |
| PEAKBARS            | 峰波位置                | 前M个ZIG转向波峰到当前距离     | PEAKBARS(K,N,M,ABS)表示之字转向ZIG(K,N,ABS)的前M个<br>波峰到当前的周期数,M必须大于等于1。若ABS为0或省略，<br>则表示相对ZIG转向，否则为绝对ZIG转向。<br>例如：PEAKBARS(0,5,1)表示%5开盘价ZIG转向的上一个波峰到<br>当前的周期数<br>★本函数的计算结果引用了未来数据★                                                                                                                                                     |
| PWINNER             | 远期获利盘比例             |                     | 表示10天前的那部分成本以当前收市价卖出的获利盘比例，例如返回0.2表示20%获利盘；<br>该函数仅对日线分析周期有效                                                                                                                                                                                                                                                                     |
| SAR_S               | 抛物转向                |                     | SAR(N,S,M),N为计算周期,S为步长,M为极值。例如，SAR(10,2,20)表示计算10日抛物转向，步长为2%，极限值为20%                                                                                                                                                                                                                                                             |
| TROUGH              | 波谷值                 | 前M个ZIG转向波谷值         | TROUGH(K,N,M,ABS)表示之字转向ZIG(K,N,ABS)的前M个波谷<br>的数值,M必须大于等于1。若ABS为0或省略，则表示相对ZIG转<br>向，否则为绝对ZIG转向。<br>例如：TROUGH(2,5,2)表示%5最低价ZIG转向的前2个波谷的数值<br>★本函数的计算结果引用了未来数据★                                                                                                                                                                     |
| TROUGHBARS          | 波谷位置                | 前M个ZIG转向波谷到当前距离     | TROUGHBARS(K,N,M,ABS)表示之字转向ZIG(K,N,ABS)的前<br>M个波谷到当前的周期数,M必须大于等于1。若ABS为0或省略，<br>则表示相对ZIG转向，否则为绝对ZIG转向。<br>例如：TROUGHBARS(2,5,2)表示%5最低价ZIG转向的前2个波谷<br>到当前的周期数<br>★本函数的计算结果引用了未来数据★                                                                                                                                                 |
| WINNER              | 获利盘                 | 表示获利盘比例             | WINNER(CLOSE)，表示以当前收市价卖出的获利盘比例。例如返回0，1表示10%获利盘；WINNER(10，5)表示10，5元价格的获利盘比例。该函数仅对日线分析周期有效                                                                                                                                                                                                                                         |
| ZIG                 | 之字转向                |                     | ZIG(K,N)，当价格变化量超过N%时转向，K表示0：开盘价，1：最高价，2：最低价，3：收盘价。例如：ZIG(3,5)表示当前收盘价超过上次ZIG转向输出值的+5%或-5%，则输出当前收盘价并ZIG转向。<br>★本函数的计算结果引用了未来数据★                                                                                                                                                                                                    |
## 板块函数
| <center>名称</center> | <center>含义</center> | <center>解读</center>             | <center>用法</center>                                                                      |
| ------------------- | ------------------- | ------------------------------- | ---------------------------------------------------------------------------------------- |
| BLOCK               | 所属板块                | 获取个股的所属板块                       | BLOCK(M,N)，M表示选择的数据项，M为0表示取二级行业，1表示取三级行业，2表示取所属地域，3表示取所属概念。N表示换行，针对概念这类数目较多的板块，行业和地域可以不传 |
| BLOCKAVG            | 板块平均                | 求板块里某一数据项的平均值                   | BLOCKAVG(&N),N表示选择的数据项。例如：BLOCKAVG(&NEW)表示这个板块里所有股票当前时刻的平均价                              |
| BLOCKCOUNT          | 股票数                 |                                 |                                                                                          |
| BLOCKLEAD           | 板块领先股票              | 取板块指数的所属个股中数据X最大的股票的数据Y。适用于板块指数 | BLOCKLEAD(&X,&Y)  取板块指数中个股数据X最大的股票的数据Y。如BLOCKLEAD(&VOL,&ZQMC)取该板块指数中成交量最大的股票名称           |
| BLOCKMAX            | 板块最大值               | 求板块里某一数据项的最大值                   | BLOCKMAX(&N)，N表示选择的数据项。例如：BLOCKMAX(&HIGH)表示这个板块里所有股票当天的最高价                               |
| BLOCKMIN            | 板块最小值               | 求板块里某一数据项的最小值                   | BLOCKMIN(&N)，N表示选择的数据项。例如：BLOCKMIN(&LOW)表示这个板块里所有股票当天的最低价                                |
| BLOCKSTD            | 板块标准差               |                                 |                                                                                          |
| BLOCKSUM            | 板块求和                | 求板块里某一数据项的和                     | BLOCKSUM(&N)，N表示选择的数据项。例如：BLOCKSUM(&VOL)表示这个板块里所有股票当前时刻的总成交手数                            |
| BROKERINFO          | 券商编号                |                                 |                                                                                          |
| INBLOCK             | 属于板块                | 判断当前代码是否属于某个板块                  | INBLOCK('BLOCK')，BLOCK是板块名称                                                              |
| ZSBLOCK             | 所属指数名称              |                                 | 返回投资品种所属的大盘指数。范围包含上海指数、深证指数和沪深指数                                                         |
| ZSBLOCKNUM          | 所属指数数目              |                                 | 返回投资品种所属的大盘指数的个数。范围包含上海指数、深证指数和沪深指数                                                      |
## 财务函数
| <center>名称</center> | <center>含义</center> | <center>解读</center>  | <center>用法</center>                                                                                                                   |
| ------------------- | ------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| GETREPTYPE          | 报表类型                | 取当期报表类型              | getreptype(&N) N为财务数据项。其返回值为1（1季度季报）、2（中报）、3（3季度季报）、4（年报）                                                                             |
| LASTREP             | 最近报表                | 按报表发布时间调用报表数据项       | LASTREP(&N,K) N为财务数据项，K为报表顺序，1表示最近一次公布的报表、2表示最近第二次公布报表、依此类推                                                                           |
| MIDREP              | 中报                  | 调用中报数据项              | MIDREP(&N,K,L)，N为财务数据项，K可以是1（表示最近一次的中报）、2（表示上一次的中报）、3、4等或者直接输入希望调用的年份                                                                 |
| QUARTERREP          | 季报                  | 调用季报数据项              | QUARTERREP(&N,K,L)，N为财务数据项，K可以是1（表示最近一次的季报）、2（表示上一次的季报）、3、4等或者直接输入希望调用的年份，L可以是1或3即第一季度或第三季度的季报。注意L仅在K选择年份的时候适用                        |
| REP                 | 同期报表                | 调用最近一次报表或与其同类型报表的数据项 | REP(&N,K) N为财务数据项，K为1（表示最近一次公布的报表）、2（表示去年与最近一次公布报表同类型报表）、3、4等                                                                         |
| REPDATE             | 报表日期                |                      | REPDATE(&参数1,参数2,参数3)<br>参数1＝财务数据项<br>参数2＝引用周期数，与YEARREP等的调用相同<br>参数3＝1、一季度报表，2、中报，3、三季度报表，4、年报<br>如REPDATE(&ZGB,1,4)，表示取最近总股本年报的报表日期 |
| YEARREP             | 年报                  | 调用年报数据项              | YEARREP(&N,K)，N为财务数据项，K可以是1（表示最近一次的年报）、2（表示上一次的年报）、3、4等或者直接输入希望调用的年份。<br>注意：N要为基本的财务数据项，而不能是编写的计算项目，即N为功能树里公式栏里面的“财务数据”目录下面的数据项       |
## 绘图函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                                                                                                                                                                                                                                                                                   |
| ------------------- | ------------------- | ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| DRAWBAND            | 画带状线                |                     | 当VAL1>VAL2时,在VAL1和VAL2之间填充COLOR1;当VAL1<VAL2时,填充COLOR2,这里的颜色均使用RGB函数计算得到。<br>例如:DRAWBAND(OPEN,RGB(0,224,224),CLOSE,RGB(255,96,96));                                                                                                                                                                                                                    |
| DRAWBMP             | 画位图                 | 在图形上绘制位图            | DRAWBMP(COND,PRICE,BMPFILE),当COND条件满足时,在PRICE位置画BMPFILE文件名指定的BMP位图(缺省路径为软件安装目录\登录用户名\)。<br>例如：DRAWBMP(CLOSE>OPEN,LOW,'SUN')表示当收阳时在最低价位置画软件安装目录\登录用户名\Sun.BMP位图。<br>※BMPFILE参数指定的BMP文件默认路径为当前用户目录，如果不带后缀名即表示BMP文件，也可带后缀名使用JPG和GIF文件。<br>也可不用用户目录而使用全路径，路径中的'\'要写两个以下字符串作为参数都是合法的，如果文件存在的话：<br>"SUN","SUN.BMP","SUN.JPG","SUN.GIF","C:\\hexin\\SUN.JPG" |
| DRAWGBK             | 条件填充背景              |                     | DRAWGBK(CLOSE>OPEN,'MyBMP');表示收阳时用软件安装目录\登录用户名\MyBMP.BMP填充背景。<br>※使用图形作为背景时参数意义同DRAWBMP的说明                                                                                                                                                                                                                                                            |
| DRAWGBKLAST         | 最后条件填充背景            | 图形中最后一根K线条件填充背景区域   | DRAWGBKLAST(COND,COLOR),若图形中最后一根K线满足条件COND，则设定背景COLOR。COLOR可以为渐变颜色STRIP，也可以为BMP图形文件名(缺省路径为“软件安装目录\登录用户名\”)，若省略则使用指标线颜色填充(可以使用COLORRED等描述符设定)。<br>例如：DRAWGBKLAST(CLOSE>OPEN),COLORRED;表示最后一根K线收阳时用红色填充背景。<br>DRAWGBKLAST(CLOSE>OPEN,STRIP(RGB(255,0,0),RGB(0,255,0),1));表示图形中最后一根K线收阳时红绿过渡色沿水平方向填充背景。<br>※使用图形作为背景时参数意义同                               |
| DRAWICON            | 画图标                 |                     |                                                                                                                                                                                                                                                                                                                                                       |
| DRAWKLINE           | 画K线                 |                     | 以HIGH为最高价,OPEN为开盘价,LOW为最低,CLOSE收盘画K线                                                                                                                                                                                                                                                                                                                  |
| DRAWLINE            | 画直线                 | 在图形上绘制直线段           | DRAWLINE(COND1,PRICE1,COND2,PRICE2,EXPAND),当COND1条件满足时,在PRICE1位置画直线起点，当COND2条件满足时,在PRICE2位置画直线终点，EXPAND为延长类型。<br>例如：DRAWLINE(HIGH>=HHV(HIGH,20),HIGH,LOW<=LLV(LOW,20),LOW,1)表示在创20天新高与创20天新低之间画直线并且向右延长                                                                                                                                               |
| DRAWNUMBER          | 画数字                 |                     | 当COND条件满足时,在PRICE位置书写数字NUMBER。<br>例如:DRAWNUMBER(CLOSE/OPEN>1.08,LOW,C)表示当日涨幅大于8%时在最低价位置显示收盘价（价格）                                                                                                                                                                                                                                                      |
| DRAWNUMBER_FIX      | 画定点数字               |                     | DRAWNUMBER_FIX(COND,X,Y,TYPE,NUMBER).(中文名称：画定点数字)<br>用法:,当COND条件满足时,在当前指标窗口内(X,Y)位置书写数字NUMBER，X,Y为书写点在窗口中相对于左上角的百分比，TYPE:0为左对齐，1为右对齐。<br>例如:DRAWNUMBER_FIX(CURRBARSCOUNT=1 AND CLOSE/OPEN>1.08,0.5,0.5,0,C)表示最后一个交易日涨幅大于8%时在窗口中间位置显示收盘价                                                                                                               |
| DRAWTEXT            | 画文字                 | 在图形上显示文字            | DRAWTEXT(COND,PRICE,TEXT),当COND条件满足时,在PRICE位置书写文字TEXT。<br>例如：DRAWTEXT(CLOSE/OPEN>1.08,LOW,'大阳线')表示当日涨幅大于8%时在最低价位置显示'大阳线'字样                                                                                                                                                                                                                            |
| DRAWTEXT_FIX        | 画定点文字               |                     | 当COND条件满足时,在当前指标窗口内(X,Y)位置书写文字TEXT，X,Y为书写点在窗口中相对于左上角的百分比，TYPE:0为左对齐，1为右对齐。<br>例如:DRAWTEXT_FIX(CURRBARSCOUNT=1 AND CLOSE/OPEN>1.08,0.5,0.5,0,'大阳线')表示最后一个交易日涨幅大于8%时在窗口中间位置显示'大阳线'字样                                                                                                                                                                    |
| FILLRGN             | 条件填充区域              | 根据条件填充区域            | FILLRGN(PRICE1,PRICE2,COND1,COLOR1,COND2,COLOR2...),填充PRICE1到PRICE2之间的区域，当COND1条件满足时,用COLOR1颜色，当COND2条件满足时,用COLOR2颜色，否则不填充，从COLOR1之后的参数均可以省略，最多可以有15组条件。<br>例如：FILLRGN(CLOSE,OPEN,CLOSE>OPEN,RGB(255,0,0),CLOSE<OPEN,RGB(0,255,0))表示填充开盘价和收盘价之间的区域，阳线时用红色，阴线时用绿色，平盘不绘制                                                                                |
| HORLINE             | 画水平线                | 在图形上绘制水平线           | HORLINE(COND,PRICE,TYPE,EXTEND),当COND条件满足时,在PRICE位置沿水平方向绘制TYPE类型的线段,TYPE=0表示实线，1表示虚线'---'，2表示点线'...'，3表示点划线'-.-.-'，4表示点点划线'-..-..-'。EXTEND=1 表示向左延长，=2表示向右延长，=3表示左右延长。<br>例如：HORLINE(HIGH>=HHV(HIGH,20),HIGH,1,2)表示在创20天新高时画水平虚线向右延伸                                                                                                                  |
| PARTLINE            | 条件画线                | 根据条件画线              | PARTLINE(PRICE,COND1,COLOR1,COND2,COLOR2...),绘制PRICE线，当COND1条件满足时,用COLOR1颜色，当COND2条件满足时,用COLOR2颜色，否则不绘制，从COLOR1之后的参数均可以省略，最多可以有15组条件。<br>例如：PARTLINE(CLOSE,CLOSE>OPEN,RGB(255,0,0),CLOSE<OPEN,RGB(0,255,0),1,RGB(0,0,255))表示画收盘价线，阳线时用红色，阴线时用绿色，平盘用蓝色。注意最后一个条件为1，表示前面都不满足时必然满足这个条件                                                                    |
| POLYLINE            | 画折线                 | 在图形上绘制折线段           | POLYLINE(COND,PRICE),当COND条件满足时,以PRICE位置为顶点画折线连接。<br>例如：POLYILINE(HIGH>=HHV(HIGH,20),HIGH)表示在创20天新高点之间画折线                                                                                                                                                                                                                                             |
| RGB                 | 指定颜色                |                     | RGB(R,G,B),表示用三原色红(R)绿(G)蓝(B)混合组成指定颜色,每种颜色值可以设定为0-255。<br>例如RGB(255,0,0)表示红色，RGB(0,0,255)表示蓝色                                                                                                                                                                                                                                                         |
| STICKLINE           | 画柱线                 | 在图形上绘制柱线            | STICKLINE(COND,PRICE1,PRICE2,WIDTH,EMPTY),当COND条件满足时,在PRICE1和PRICE2位置之间画柱状线，宽度为WIDTH(10为标准间距),EMPTH不为0则画空心柱。<br>例如：STICKLINE(CLOSE>OPEN,CLOSE,OPEN,0.8,1)表示画K线中阳线的空心柱体部分                                                                                                                                                                              |
| STRIP               | 渐进色                 |                     | STRIP(RGB1,RGB2,DIR),表示生成RGB1色到RGB2色的渐变区域，DIR=1表示沿水平方向，否则表示沿垂直方向,其中RGB1,RGB2必须用RGB函数描述。本函数只能用于DRAWGBK、DRAWGBKLAST函数中，作为背景填充色描述符。<br>例如STRIP(RGB(255,0,0),RGB(0,255,0),0)表示由红色到绿色的垂直渐变色。<br>参数DIR表示渐变方向1、从上到下2、从下到上3、从左到右4、从右到左                                                                                                                        |
| TIPTEXT             | 提示文字                | 在图形上显示图标，鼠标移近时显示    | TIPTEXT(COND,PRICE,TEXT),当COND条件满足时,在PRICE位置显示图标，若PRICE为0，则在图形底部显示图标。<br>例如：TIPTEXT(CLOSE/OPEN>1.08,LOW,'大阳线，股价为:'+close)表示当日涨幅大于8%时在最低价位置显示图标,鼠标移近时显示文字'大阳线,股价为:15.88'字样。<br>※显示为三角图标                                                                                                                                                                |
| VERLINE             | 画垂直线                | 在图形上绘制垂直线           | VERTLINE(COND,TYPE),当COND条件满足时,沿垂直方向绘制TYPE类型的线段,TYPE=0表示实线，1表示虚线'---'，2表示点线'...'，3表示点划线'-.-.-'，4表示点点划线'-..-..-'。<br>例如：VERLINE(HIGH>=HHV(HIGH,20),1)                                                                                                                                                                                                  |
| ZIGLINE             | 画锯齿线                | 在图形上绘制锯齿线           | ZIGLINE(COND,PRICE),当COND条件满足时,以PRICE位置为顶点画锯齿连接。<br>例如：ZIGILINE(HIGH>=HHV(HIGH,20),HIGH)表示在创20天新高点之间画锯齿线                                                                                                                                                                                                                                              |
## 字符串函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                                                  |
| ------------------- | ------------------- | ------------------- | -------------------------------------------------------------------------------------------------------------------- |
| CON2STR             | 数值转字符串              |                     | CON2STR(NUM,X)<br>将数据类型的变量NUM取前X位小数并返回                                                                               |
| STKNAME             | 股票名称                |                     |                                                                                                                      |
| STR2CON             | 字符串转数值              |                     | VAR2CON(STR)<br>将STR字符串转换为数据类型并输出                                                                                    |
| STRCAT              | 字符串相加               |                     | STRCAT(STR1,STR2)<br>将字符串类型STR1和STR2结合在一起并返回。<br>注意：无论STR1与STR2中是否有序列型变量（随时间轴变化而变化）都适用，用法同VARCAT                     |
| STRCMP              | 字符串比较               |                     | STRCMP(STR1,STR2)<br>将字符串STR1，字符串STR2比较。如果完全匹配，则返回1，不相同则返回0                                                          |
| STRFIND             | 字符串查找               | 在字符串中查找另一个字符串       | STRFIND(STRING,SUBSTRING,N),从字符串STRING的第N个字符开始查找字符串SUBSTRING,返回找到的位置，若没有找到就返回0。<br>例如：STRFIND('abcdefgh','cde',1)返回3 |
| STRLEFT             | 字符串左部               | 取得字符串的左边部分          | STRLEFT(STRING,N),返回字符串STRING的左边N个字符。<br>例如：STRLEFT('abcdef',3)得到'abc'                                               |
| STRLEN              | 长度                  |                     | STRLEN(STR)<br>返回字符串STR的长度                                                                                           |
| STRMID              | 字符串中部               | 取得字符串的中间部分          | STRMID(STRING,N,M),返回字符串STRING的第N个字符开始的长度为M个字符的字符串。<br>例如：STRMID('abcdef',3,3)得到'cde'                                |
| STRRIGHT            | 字符串右部               | 取得字符串的右边部分          | STRRIGHT(STRING,N),返回字符串STRING的右边N个字符。<br>例如：STRRIGHT('abcdef',3)得到'def'                                             |
| STRSPACE            | 字符串右空格              |                     | STRSPACE(STR)<br>将字符串类型STR加一个空格后返回                                                                                   |
| TOSTRING            | 转换字符串               |                     | TOSTRING(X,N)，X是数值，N是精度。<br>例如：TOSTRING(3.14159,3)返回字符串‘3.141’                                                       |
| VAR2STR             | 转字符串                |                     | VAR2STR(VAR,N)<br>将VAR变量保留N位小数，并转换为字符串输出                                                                             |
| VARCAT              | 字符串相加               |                     | VARCAT(STR1,STR2)<br>将字符串类型STR1和STR2结合在一起并返回。<br>注意：无论STR1与STR2中是否有序列型变量（随时间轴变化而变化）都适用，用法同STRCAT                     |
## 大盘函数
| <center>名称</center> | <center>含义</center> | <center>解读</center> | <center>用法</center>                                                                  |
| ------------------- | ------------------- | ------------------- | ------------------------------------------------------------------------------------ |
| INDEXABOND          | 债券关联A股数据            |                     |                                                                                      |
| INDEXAH             | AH数据                |                     |                                                                                      |
| INDEXC              | 大盘收盘价               |                     |                                                                                      |
| INDEXDATA           | 大盘数据                | 求与具体某种商品相关的数据       | INDEXDATA(“N”，&X，K)。N为商品代码。X为数据项。K为周期数（可以不加）。INDEXDATA(“1A0001”，&LOW，3)为3天前上证指数的最低点位 |
| INDEXH              | 大盘最高价               |                     |                                                                                      |
| INDEXL              | 大盘最低价               |                     |                                                                                      |
| INDEXM              | 大盘成交额               |                     |                                                                                      |
| INDEXO              | 大盘开盘价               |                     |                                                                                      |
| INDEXV              | 大盘成交量               |                     |                                                                                      |
| PREDAYDATA          | 获取前一交易日实时数据（分时）     |                     |                                                                                      |
# 基本公式
这里的各种公式都是一些用于设置“同花顺”各种表格曲线的公式,我们预先写好您直接调用就可以了。当然您也完全可以根据个人爱好自己编写。
**注意:**
基本公式是用于编写配置用的,即只有高级版用户才能看到这个目录。
这里主要有如下几类公式:板块统计、区间统计、报价公式、分时公式、技术分析、文本浏览、期货公式、筹码分布、大单公式、曲线标志、其他。
**1、板块统计:**
这里有4个用于统计板块数值的公式。
(1)、板块均价。
`BLOCKPRICE`,用于计算板块最新的平均价。
(2)、板块最低价。
`BLOCKLOW`,用于计算板块的最低价。
(3)、板块最高价。
`BLOCKHIGH`,用于计算板块的最高价。
(4)、板块总手。
`BLOCKVOL`,用于计算板块的板块总手。
**2、区间统计:**
这里面是各种用于区间统计的公式,在做区间统计表格的时候,要将这里面的公式拖到表格里,而不能用普通的行情数据项。
**3、报价公式:**
一般实时数据都是由交易所直接发过来的。那些需要计算得出来、且周期为实时的数据并不多,都是一些与大盘统计相关的公式,放在这个目录下。
大盘目录:`EQUALCOUNT`(平盘家数)、`DaPanWeiCha`(委差)、`DaPanWeiBi`(委比)。
这三个函数都是直接调用不附带参数。其值分别为大盘指数对应的股票的平盘家数、所有对应的股票的委差之和、及以此计算的委比。
**4、分时公式:**
`5ZSZBH`(五分钟总市值变化)、`FiveRiseCount`(五分钟涨跌)、FiveRise(五分钟涨幅)。
这三项都是统计与5分钟相关的几个数据。
`FenShiVolClass`(分时成交量颜色),这是用来显示分时成交量颜色的公式。点修改,可以看到这个公式的输出为“黄”、“阴”、“平”三个曲线标志。在“输出方案设置”里面我们知道,当“输出颜色设置”选择“其它数据的颜色表示涨跌色”,而当其它数据输出为“曲线标志”时,则显示其标志的颜色。所以,这里通过三个“曲线标志”的颜色来显示分时成交量的颜色。
**5、技术分析:**
这里前5项都是与K线相关的数据项。
`VolColor`(成交量颜色),其原理与上面介绍的“分时成交量颜色”类似,用于显示K线的成交量的颜色。
**6、文本浏览:**
这里是用于建文本窗口的公式。如,用于F10页面的“个股资料”。
**7、期货公式:**
用于建期货页面的公式。这里的公式都是用“期货数据”编写的。
**8、筹码分布:**
这里是筹码分布和火焰山公式。其详细含义、用法参见《筹码分布及火焰山》。
**9、大单公式:**
这里放有做各种不同“大单表”的公式。
**10、曲线标志:**
这里是各种用于画在曲线上的标志图形,使用时将其拖到窗口里面就可以了。如,除权标志。
还有几个最常用的曲线,如K线、分时走势、均线、及其成交量的柱状图等。在“技术指标”下面的“曲线”目录里面。
# 条件选股
条件选股是根据提供系统或用户编制的条件选股公式进行选股选定一个条件选股公式或多个组合条件后,计算机自动帮您选出当时或历史上某一段时间内满足条件的所有股票,列在行情显示窗口,同时可保留成板块。
实时预警根据投资者设定的条件监控整个股票市场的动向,帮助投资者发现可能忽略或者不能注意到的风吹草动！投资者可以自己定义涨跌幅度、量比、绝对价位、成交量异动、指标突破价位、封停和打开停板等一系列的预警条件,系统将在条件满足时提醒投资者有异动的股票及其异动的特征。
这里放置各种用于选股及预警的公式。
条件选股公式的编写方法与其它公式编写方式相同。选股条件公式的核心内容为一个条件判断语句SELECT语句,其运算结果为“0”或者“1”即“不满足条件”或者“满足条件”。当然一般的公式也能用于选股,依结果为“非1”或者“1”来判断,即只有运算结果为“1”时才能选出来。参见“智能分析”。
# 技术指标

技术指标是在K线图中用于分析股票走势的曲线。这个目录下含有“同花顺”为您提供的200多种技术指标。参见“技术指标简介”。
# 交易系统

交易系统就是设定某种买卖条件,当满足条件的时候就在K线上画出买入、卖出的提示箭头,用于分析买卖策略的一种工具。从某种意义上说交易系统也是一种绘图曲线,也是通过编写公式完成的,这里列出了“同花顺”提供的各种交易系统。
编写交易系统的方法与编写一般曲线类似,是不过一般曲线是连续的输出,而交易系统是满足买卖条件的时候输出买入、卖出的曲线标志而已。输出曲线标志用“:>”。
例如,MACD交易系统的公式内容如下:
```
DIFF=EMA(CLOSE,SHORT)-EMA(CLOSE,LONG);
DEA=EMA(DIFF,M);
MACD1=2*(DIFF-DEA);
IF(CROSS(diff,dea))
a:>"buy";
IF(CROSS(dea,diff))
b:>"sell";
```
# 五彩K线
五彩K线是依照一定规则将普通K线标成多种不同的颜色,以突出某种K线形态的曲线公式。这里列有早晨之星、黄昏之星、十字星、长十字星、红绿灯等各种五彩K线。
五彩K线的编写方法与一般K线类似。只是一般K线公式以开盘价、收盘价为颜色判断的依据,而五彩K线则采用各种不同的形态为颜色判断依据。下面列出普通K线公式与“三红兵”五彩K线公式:
普通K线公式:
```
IF(CLOSE>OPEN)
RETURN"阳";
ELSEIF(CLOSE
RETURN"阴";
ELSEIF(CLOSE==OPENANDOPEN>=CLOSE[1])
RETURN"阳";
ELSEIF(CLOSE==OPENANDOPEN<=close[1])<>
RETURN"阴";
```
“三红兵”五彩K线公式:
```
IF(CLOSE[2]>OPEN[2]ANDCLOSE[1]>OPEN[1]ANDCLOSE>OPENAND
CLOSE[1]>CLOSE[2]ANDCLOSE>CLOSE[1])
**{RETURNBACKSET("colorred",2);}**
ELSERETURN"colorgreen";
```