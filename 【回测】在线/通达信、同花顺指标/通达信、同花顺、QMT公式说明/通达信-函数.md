# 公式系统(初级)
## 1. 公式类型说明
- 调出公式管理器
	公式-公式管理器
	快捷键 **CTRL+F**
- 公式类型分为四大类
1. **技术指标公式**
2. **条件选股公式**
3. **交易系统公式**
4. **五彩K线公式**
### 1.1 技术指标公式
技术分析界面中的指标为技术指标公式,如`MA`、`KDJ`、`MACD`等
- 可以通过公式管理器编写技术指标公式
1. 在公式管理器界面选择技术指标公式，点击右边的"**新建**"就可进入技术指标公式编辑区
2. 在指标公式编辑区,可以通过"**引入公式**",在已有指标的基础上修改指标公式
3. 可以通过插入函数来实现指标公式的编写
4. 编写完后测试公式,测试通过后退出,输入公式名称就可调出指标公式使用
### 1.2 条件选股公式
- 利用条件选股公式可以把符合一定技术形态的个股选出来
1. 在公式管理器中建立条件选股公式
2. 通过"**条件选股**"调用条件选股公式
- 条件选股调出
	公式-条件选股
	快捷键**CTRL+T**
### 1.3 专家系统公式
编写好专家系统公式后,可以叠加到Ｋ线上,交易系统自动列出买卖操作信号
- 专家系统公式调出
1. 在Ｋ线界面点击鼠标右键,选择专家系统指标
2. 选择一个专家系统,点击"确定",专家系统就会叠加在Ｋ线上面了
### 1.4 五彩Ｋ线公式
编写好五彩公式后,可以叠加到Ｋ线上,会把特殊的Ｋ线形态用不同的颜色标识出来
- 五彩K线公式调出
1. 在Ｋ线界面点击鼠标右键,选择五彩Ｋ线指示
2. 选择一五彩Ｋ线,点击"确定",五彩K线就会叠加在Ｋ线上面了
## 2. 公式函数的使用
我们在公式编辑器中选择插入函数,可以看到里面有许多函数,在附录中有一个简表,可以查找栏进行检索
## 3. 公式编写举例
### 3.1 均线指标编写
- 进入公式管理器,新建一技术指标公式
1. 依次点击菜单"公式-公式管理器",进入公式管理器界面
2. 左边的树型列表中选择技术指标公式下面的"均线型",点击右边的"新建",就会进入公式编辑界面
3. 填写完公式名称,公式描述,点击"插入函数",选择"简单移动平均",简单移动平均函数的用法会在对话框下边列出来,点击"确定"按钮,对应的函数会在公式编辑框内显示出来
4. 填写完MA函数的两个参数,第一个参数填写收盘价,收盘价在公式函数中用C表示,第二个参数填写均线日期,可以直接录入一数字,最后用分号结尾(注:公式编写涉及到符号时用英文字符)
5. 录入后,下面的动态翻译区会自动翻译公式的意义,"收盘价的10日简单移动平均",这样一条10日均线的指标就形成了.
**编辑器区的相关说明如下**:
- **公式类型**:对应的公式可选择加入不同的类型,设定后查看公式时将会在对应的分类项下列出来
- **画线方法**
1. 选择**副图**,指标将会在副图区显示
2. 选择**主图叠加**,指标将会在主图区显示
3. 也可选择在**副图上叠加K线**
- **坐标线位置**
1. 默认的是自动,系统自动根据指标值的范围设定的区间
2. 可以手动的设置坐标间隔,用分号分开,手动设置后,默认的将会没有
- **额外Y轴分界**:在指标上加上一些白色的横线
1. 点击"测试公式",若显示测试通过
2. 点击"确定"按钮保存公式
3. 调出公式时,键盘输入公式名字回车
### 3.2 简单条件选股公式编写
- 下面编写一选股公式,要求选出"股价小于每股净资产"的个股
1. 进入公式管理器,新建一条件选股公式
2. 点击菜单"公式-公式管理器→点条件选股公式"或者快捷键**CTRL+F**后点条件选股公式,进入条件选股公式管理器界面
3. 选择左边树型列表中条件选股公式下面的其它类型,点击"新建"
4. 输入公式名称,公式描述
5. 点"插入函数",选择"收盘价",点击"确定",对应的函数就到了编辑区
6. 录入空格,输入小于号,再点"插入函数",在财务函数中找到每股净资产放到后面,以分号结尾
7. 点击"测试公式",若显示测试通过,点击"确定"按钮保存公式
## 4. 附公式函数列表
### 4.1 序列行情函数

| <center>名称</center> | <center>含义</center> | <center>返回值</center>   | <center>用法</center> |
| ------------------- | ------------------- | ---------------------- | ------------------- |
| HIGH                | 最高价                 | 该周期最高价                 | HIGH                |
| H                   | 最高价                 | 该周期最高价                 | H                   |
| LOW                 | 最低价                 | 该周期最低价                 | LOW                 |
| L                   | 最低价                 | 该周期最低价                 | L                   |
| CLOSE               | 收盘价                 | 该周期收盘价                 | CLOSE               |
| C                   | 收盘价                 | 该周期收盘价                 | C                   |
| OPEN                | 开盘价                 | 该周期开盘价                 | OPEN                |
| O                   | 开盘价                 | 该周期开盘价                 | O                   |
| VOL                 | 成交量                 | 该周期成交量                 | VOL                 |
| V                   | 成交量                 | 该周期成交量                 | V                   |
| AMOUNT              | 成交额                 | 该周期成交额                 | AMOUNT              |
| **ZSTJJ**           | **分时图均价**           | 该周期的分时图均价线,对于分时图周期指标有效 |                     |
| ADVANCE             | 上涨家数                | 该周期上涨家数                | ADVANCE(本函数仅对大盘有效)  |
| DECLINE             | 下跌家数                | 该周期下跌家数                | DECLINE(本函数仅对大盘有效)  |
| VOLINSTK            | 持仓量                 | 该周期持仓量,对于期货和期权有意义      |                     |
| QHJSJ               | 结算价                 | 该周期结算价,对于期货和期权有意义      |                     |
| HKSHORTVOL          | 抛空量                 | 该周期抛空量,对于港股有意义         |                     |
| DHIGH               | 不定周期最高价             | 该不定周期最高价,属于未来函数        |                     |
| DOPEN               | 不定周期开盘价             | 该不定周期开盘价,属于未来函数        |                     |
| DLOW                | 不定周期最低价             | 该不定周期最低价,属于未来函数        |                     |
| DCLOSE              | 不定周期收盘价             | 该不定周期收盘价,属于未来函数        |                     |
| DVOL                | 不定周期成交量             | 该不定周期成交量价,属于未来函数       |                     |
### 4.2 时间函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                               |
| ------------------- | ------------------- | ------------------------------------- | --------------------------------------------------------------------------------- |
| PERIOD              | 周期类型                | 取得周期类型                                | 结果从0到13,依次分别是1/5/15/30/60分钟,日/周/月,多分钟,多日/季/年,5秒线/多秒线,13以上为自定义周期                   |
| DATE                | 日期                  | 取得该周期从1900以来的年月日                      | 例如函数返回1000101,表示2000年1月1日                                                         |
| TIME                | 时间(时分)              | 取得该周期的时分,适用于日线以下周期                    | TIME函数返回有效值范围为(0000-2359)                                                         |
| TIME2               | 时间(时分秒)             | 取得该周期的时分秒,适用于日线以下周期                   | TIME2函数返回有效值范围为(000000-235959)                                                    |
| YEAR                | 年份                  | 取得该周期的年份                              | YEAR(注:YEAR关键字也可用于跨周期年线引用)                                                        |
| MONTH               | 月份                  | 取得该周期的月份                              | MONTH函数返回有效值范围为(1-12)(注:MONTH关键字也可用于跨周期月线引用)                                      |
| WEEKOFYEAR          | 年内星期                | 取得该周是年内第几个周                           | WEEKOFYEAR                                                                        |
| WEEKDAY             | 星期                  | 取得该周期的星期数                             | WEEKDAY函数返回有效值范围为(1,2,3,4,5,6,0)                                                  |
| DAYSTOTODAY         | 离今天的天数              | 取得该周期的日期离今天的天数                        | DAYSTOTODAY                                                                       |
| DAY                 | 日                   | 取得该周期的日期                              | DAY函数返回有效值范围为(1-31)(DAY关键字可用于跨周期日线引用)                                             |
| HOUR                | 小时                  | 取得该周期的小时数                             | HOUR函数返回有效值范围为(0-23),对于日线及更长的分析周期值为0                                              |
| MINUTE              | 分钟                  | 取得该周期的分钟数                             | MINUTE函数返回有效值范围为(0-59),对于日线及更长的分析周期值为0                                            |
| FROMOPEN            | 当前离开盘分钟数            | 求当前时刻距开盘有多长时间                         | FROMOPEN返回当前时刻距开盘有多长时间,单位为分钟.<br>例如:FROMOPEN当前时刻为早上十点,则返回31                       |
| TOTALFZNUM          | 总分钟数                | 求该品种的每天的总交易分钟数                        | TOTALFZNUM返回前品种的每天的总交易分钟数,单位为分钟                                                   |
| DATETODAY           | 转换天数                | 指定日期到1990.12.19的天数                    | DATETODAY(date)返回date到1990.12.19的天数,有效日期为(901219-1341231).例如:DATETODAY(901219)返回0 |
| DAYTODATE(N)        | 转换日期                | 求1990.12.19后第若干天的日期                   | DAYTODATE(N).返回1990.12.19后第N天的日期,有效天数为(0-20000).例如:DAYTODATE(0)返回901219           |
| TIMETOSEC           | 当日秒数                | 求指定时刻距0时有多长时间                         | TIMETOSEC(time).返回time时刻距0时有多长时间,单位为秒.有效时间为(0-235959).例如:TIMETOSEC(93000)返回34200  |
| SECTOTIME           | 转换时间                | 求0时后若干秒是什么时间                          | SECTOTIME(N).返回0时后N秒是什么时间.有效秒数为(0-86399).例如:SECTOTIME(34200)返回93000               |
| MACHINEDATE         | 当前系统的日期             | 取得当前客户端机器从1900以来的的年月日                 | 2016年10月1日为:01161001,MACHINEDATE+19000000后才是真正的日期值,公式内容中请不要直接写8位长的日期数字            |
| MACHINTIME          | 当前系统的时间             | 取得当前客户端机器的时间,比如11:01:15时为110115       |                                                                                   |
| MACHINWEEK          | 当前系统的星期             | 取得当前客户端机器为星期几(1,2,3,4,5,6,0)          |                                                                                   |
| HQCRBK              | 行情区背景色              |                                       | 当前行情区背景色,黑色系为0,白色系为1                                                              |

### 4.3 引用函数
| <center>名称</center> | <center>含义</center>    | <center>返回值</center><center></center>   | <center>用法</center>                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------- | ---------------------- | --------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **DRAWNULL**        | **无效数**                | 无效数                                     | 例如:IF(CLOSE>REF(CLOSE,1),CLOSE,DRAWNULL)表示下跌时不画线                                                                                                                                                                                                                                                                                                                                                                                                                 |
| BACKSET             | 向前赋值                   | 将当前位置到若干周期前的数据设为1                       | 用法:BACKSET(X,N)若X非0,则将当前位置到N周期前的数值设为1.<br>例如:BACKSET(CLOSE>OPEN,2)若收阳则将该周期及前一周期数值设为1,否则为0                                                                                                                                                                                                                                                                                                                                                                        |
| BARSCOUNT           | 有效数据周期数                | 求总的周期数                                  | BARSCOUNT(X)第一个有效数据到当前的天数.<br>例如:BARSCOUNT(CLOSE)对于日线数据取得上市以来总交易日数                                                                                                                                                                                                                                                                                                                                                                                               |
| CURRBARSCOUNT       | 到最后交易日的周期数             | 求到最后交易日的周期数                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| TOTALBARSCOUNT      | 总的周期数                  | 求总的周期数                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| BARSLAST            | 上一次条件成立位置              | 上一次条件成立到当前的周期数                          | BARSLAST(X)上一次X不为0到现在的天数.<br>例如:BARSLAST(CLOSE/REF(CLOSE,1)>=1.1)表示上一个涨停板到当前的周期数                                                                                                                                                                                                                                                                                                                                                                                 |
| BARSSINCENN         | 周期内首个条件成立位置            | N周期内第一个条件成立到当前的周期数                      | ARSSINCEN(X,N):N周期内第一次X不为0到现在的周期数,N为常量<br>例如:BARSSINCEN(HIGH>10,10)表示10个周期内股价超过10元时到当前的周期数                                                                                                                                                                                                                                                                                                                                                                       |
| BARSSINCE           | 首个条件成立位置               | 第一个条件成立到当前的周期数                          | BARSSINCE(X)第一次X不为0到现在的天数.<br>例如:BARSSINCE(HIGH>10)表示股价超过10元时到当前的周期数                                                                                                                                                                                                                                                                                                                                                                                             |
| COUNT               | 统计                     | 统计满足条件的周期数                              | COUNT(X,N)统计N周期中满足X条件的周期数,若N=0则从第一个有效值开始.<br>例如:COUNT(CLOSE>OPEN,20)表示统计20周期内收阳的周期数                                                                                                                                                                                                                                                                                                                                                                              |
| BARSLASTCOUNT       | 条件连续成立次数               | 统计连续满足条件的周期数                            | BARSLASTCOUNT(X),统计连续满足X条件的周期数.<br>例如:BARSLASTCOUNT(CLOSE>OPEN)表示统计连续收阳的周期数                                                                                                                                                                                                                                                                                                                                                                                      |
| **HHV**             | **最高值**                | 求最高值                                    | HHV(X,N)求N周期内X最高值,N=0则从第一个有效值开始.<br>例如:HHV(HIGH,30)表示求30日最高价                                                                                                                                                                                                                                                                                                                                                                                                     |
| HHVBARS             | 上一高点位置                 | 求上一高点到当前的周期数                            | HHVBARS(X,N)求N周期内X最高值到当前周期数,N=0表示从第一个有效值开始统计.<br>例如:HHVBARS(HIGH,0)求得历史新高到到当前的周期数                                                                                                                                                                                                                                                                                                                                                                                |
| HOD                 | 高值名次                   | 求高值名次                                   | HOD(X,N):求当前X数据是N周期内的第几个高值,N=0则从第一个有效值开始.<br>例如:HOD(HIGH,20)返回是20日的第几个高价                                                                                                                                                                                                                                                                                                                                                                                         |
| LLV                 | 最低值                    | 求最低值                                    | LLV(X,N)求N周期内X最低值,N=0则从第一个有效值开始.<br>例如:LLV(LOW,0)表示求历史最低价                                                                                                                                                                                                                                                                                                                                                                                                        |
| LLVBARS             | 上一低点位置                 | 求上一低点到当前的周期数                            | LLVBARS(X,N)求N周期内X最低值到当前周期数,N=0表示从第一个有效值开始统计.<br>例如:LLVBARS(HIGH,20)求得20日最低点到当前的周期数                                                                                                                                                                                                                                                                                                                                                                              |
| LOD                 | 低值名次                   | 求低值名次                                   | LOD(X,N):求当前X数据是N周期内的第几个低值,N=0则从第一个有效值开始.<br>例如:LOD(LOW,20)返回是20日的第几个低价                                                                                                                                                                                                                                                                                                                                                                                          |
| HHVLLV              | 阶段最高最低值                | 阶段最高最低值                                 | HHVLLV(X,T,N1,N2),表示前N1日到前N2日时段内的X最高值(T=0时)或最低值(T=1时).若N1为0,表示从第一天开始,N2为0,表示到最后日止,当N1,N2非0时,N1应>=N2                                                                                                                                                                                                                                                                                                                                                              |
| REVERSE             | 求相反数                   | 求相反数                                    | REVERSE(X)返回-X.<br>例如:REVERSE(CLOSE)返回-CLOSE                                                                                                                                                                                                                                                                                                                                                                                                                     |
| REF                 | 向前引用                   | 引用若干周期前的数据.                             | REF(X,A)引用A周期前的X值.<br>例如:REF(CLOSE,BARSCOUNT(C)-1)表示第二根K线的收盘价                                                                                                                                                                                                                                                                                                                                                                                                    |
| REFX                | 日后的                    | 属于未来函数,引用若干周期后的数据                       | TT:=IF(C>O,1,2);REFX(CLOSE,TT);<br>表示阳线引用下一周期的收盘价,阴线引用日后第二周期的收盘价                                                                                                                                                                                                                                                                                                                                                                                                 |
| REFV                | 日前的(平滑处理)              | 引用若干周期前的数据(平滑处理)                        | REFV(X,A),引用A周期前的X值.A可以是变量.<br>例如:REFV(CLOSE,BARSCOUNT(C)-1)表示第二根K线的收盘价                                                                                                                                                                                                                                                                                                                                                                                          |
| REFXV               | 日后的(平滑处理)              | 属于未来函数,引用若干周期后的数据(平滑处理)                 | REFXV(X,A),引用A周期后的X值.A可以是变量.<br>例如:REFXV(CLOSE,1)表示下一周期的收盘价,在日线上就是明天收盘价                                                                                                                                                                                                                                                                                                                                                                                          |
| REFDATE             | 日(指定引用)                | 引用指定日期的数据                               | REFDATE(X,A)引用A日期的X值.<br>例如:REFDATE(CLOSE,1011208)表示2001年12月08日的收盘价                                                                                                                                                                                                                                                                                                                                                                                              |
| CALCSTOCKINDEX      | 指标引用                   | 指标引用                                    | CALCSTOCKINDEX(品种代码,指标名称,指标线),返回该指标相应输出的计算值.<br>例如:<br>CALCSTOCKINDEX('SH600000','KDJ',3)表示上证600000的KDJ指标第3个输出即J之值,第一个参数可在前面加SZ(深市),SH(沪市),BJ(京市)<br>CALCSTOCKINDEX('47_IFL0','MACD',2)表示IFL0品种的MACD指标第2个输出值.<br>注意:引用品种的对应周期的数据必须要先下载到本地                                                                                                                                                                                                                        |
| SUM                 | 总和                     | 求总和                                     | SUM(X,N)统计N周期中X的总和,N=0则从第一个有效值开始.<br>例如:SUM(VOL,0)表示统计从上市第一天以来的成交量总和                                                                                                                                                                                                                                                                                                                                                                                             |
| MULAR               | 累乘                     | 求累乘                                     | MULAR(X,N),统计N周期中X的乘积.N=0则从第一个有效值开始.<br>例如:MULAR(C/REF(C,1),0)表示统计从上市第一天以来的复利                                                                                                                                                                                                                                                                                                                                                                                    |
| FILTER              | 过滤                     | 过滤连续出现的信号                               | FILTER(X,N)X满足条件后,删除其后N周期内的数据置为0.<br>例如:FILTER(CLOSE>OPEN,5)查找阳线,5天内再次出现的阳线不被记录在内                                                                                                                                                                                                                                                                                                                                                                                |
| FILTERX             | 反向过滤                   | 反向过滤连续出现的信号                             | FILTERX(X,N):X满足条件后,将其前N周期内的数据置为0,N为常量.<br>例如:FILTERX(CLOSE>OPEN,5)查找阳线,前5天内出现过的阳线不被记录在内                                                                                                                                                                                                                                                                                                                                                                         |
| TFILT               | 区间过滤                   | 对指定时间段的数据进行过滤,该时间段以外的数据无效               | TFILT(X,D1,M1,D2,M2)<br>例如:TFILT(CLOSE,1040101,1025,1040101,1345)表示在2004年1月1日的10:25到2004年1月1日的13:45的收盘价是有效的.<br>周期以日为基本单位的,分时为0有效                                                                                                                                                                                                                                                                                                                                |
| TFILTER             | 信号过滤(多头)               | 过滤连续出现的信号                               | TFILTER(买入条件,卖出条件,N);过滤掉买入(卖出)信号发出后,下一个反向信号发出前的所有买入(卖出)信号.<br>N=1表示仅对买入信号过滤;<br>N=2表示仅对卖出信号过滤;<br>N=0表示对买入和卖出信号都过滤,返回1,2表示买入或卖出条件成立;<br>同一K线上只能有一个信号;<br>例如:<br>ENTERLONG:TFILTER(买入,卖出,1);<br>EXITLONG:TFILTER(买入,卖出,2)                                                                                                                                                                                                                                         |
| TTFILTER            | 信号过滤(多空)               | 按照开平配对等原则过滤不合理的信号                       | TTFILTER(买入开仓,卖出平仓,卖出开仓,买入平仓,N);<br>主要规则有:<br>1.连续的同方向指令只有第一个有效,其他的将被过滤;<br>2.交易信号必须配对出现(比如前面已经有了买开指令,则后面只允许出现卖平指令,其他的指令都被过滤掉);<br>N=1表示仅对买入开仓信号过滤;<br>N=2表示仅对卖出平仓信号过滤;<br>N=3表示仅对卖出开仓信号过滤;<br>N=4表示仅对买入平仓信号过滤;<br>N=0表示都过滤,返回1,2,3,4分别表示对应的条件成立;<br>同一K线上只能有一个信号;<br>例如:<br>ENTERLONG:TTFILTER(买入开仓,卖出平仓,卖出开仓,买入平仓,1);<br>EXITLONG:TTFILTER(买入开仓,卖出平仓,卖出开仓,买入平仓,2);<br>ENTERSHORT:TTFILTER(买入开仓,卖出平仓,卖出开仓,买入平仓,3);<br>EXITSHORT:TTFILTER(买入开仓,卖出平仓,卖出开仓,买入平仓,4) |
| TR                  | 真实波幅                   | 求真实波幅,(最高-最价),(最高-昨收),(最低-昨收)三者绝对值中的最大值 | TR,求真实波幅.<br>例如:ATR:=MA(TR,10);<br>表示求真实波幅的10周期均值                                                                                                                                                                                                                                                                                                                                                                                                                |
| SUMBARS             | 累加到指定值的周期数             | 向前累加到指定值到现在的周期数                         | SUMBARS(X,A)将X向前累加直到大于等于A,返回这个区间的周期数.若所有的数据都累加后还不能达到A,则返回此时前面的总周期数.<br>例如:SUMBARS(VOL,CAPITAL)求完全换手到现在的周期数                                                                                                                                                                                                                                                                                                                                                       |
| SUMBARSX            | 累加到指定值的周期数             | 向前累加到指定值到现在的周期数                         | SUMBARSX(X,A):将X向前累加直到大于等于A,返回这个区间的周期数,若所有的数据都累加后还不能达到A,则返回无效值                                                                                                                                                                                                                                                                                                                                                                                                   |
| MA                  | 简单移动平均                 | 简单移动平均                                  | MA(X,M)X的M日简单移动平均                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| SMA                 | 移动平均                   | 移动平均                                    | SMA(X,N,M)X的M日移动平均,M为权重,如Y=(X*M+Y'*(N-M))/N                                                                                                                                                                                                                                                                                                                                                                                                                      |
| TMA                 | 移动平均                   | 移动平均                                    | TMA(X,A,B),A和B必须小于1,算法Y=(A*Y'+B*X),其中Y'表示上一周期Y值.初值为X                                                                                                                                                                                                                                                                                                                                                                                                             |
| EMA                 | 指数移动平均                 | 返回指数移动平均                                | EMA(X,M)X的M日指数移动平均                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| MEMA                | 平滑移动平均                 | 平滑移动平均                                  | MEMA(X,M)X的M日平滑移动平均.<br>MEMA(X,N)与MA的差别在于起始值为一平滑值,而不是初始值                                                                                                                                                                                                                                                                                                                                                                                                         |
| EXPMEMA             | 指数平滑移动平均               | 指数平滑移动平均                                | EXPMEMA(X,M)X的M日指数平滑移动平均.<br>EXPMEMA同EMA(即EXPMA)的差别在于他的起始值为一平滑值                                                                                                                                                                                                                                                                                                                                                                                                  |
| WMA                 | 加权移动平均                 | 加权移动平均                                  | WMA(X,N):X的N日加权移动平均.算法:Yn=(1*X1+2*X2+...+n*Xn)/(1+2+...+n)                                                                                                                                                                                                                                                                                                                                                                                                       |
| DMA                 | 动态移动平均                 | 动态移动平均                                  | DMA(X,A)求X的动态移动平均.<br>算法:若Y=DMA(X,A)则Y=A*X+(1-A)*Y',其中Y'表示上一周期Y值,A必须小于1.<br>例如:DMA(CLOSE,VOL/CAPITAL)表示求以换手率作平滑因子的平均价                                                                                                                                                                                                                                                                                                                                            |
| AMA                 | 自适应均线                  | 自适应均线                                   | AMA(X,A),A为自适应系数,必须小于1.<br>算法:Y=Y'+A*(X-Y').初值为X                                                                                                                                                                                                                                                                                                                                                                                                                 |
| XMA                 | 偏移移动平均                 | 属于未来函数,返回偏移移动平均                         | XMA(X,N):X的N日偏移移动平均,用到了当日以后N/2日的数据,N支持变量,只供内部测试使用                                                                                                                                                                                                                                                                                                                                                                                                                |
| RANGE               | 介于某个范围之间               |                                         | RANGE(A,B,C)A在B和C.<br>例如:RANGE(A,B,C)表示A大于B同时小于C时返回1,否则返回0                                                                                                                                                                                                                                                                                                                                                                                                       |
| CONST               | 取值设为常数                 |                                         | CONST(A)取A最后的值为常量.<br>例如:CONST(INDEXC)表示取指数现价                                                                                                                                                                                                                                                                                                                                                                                                                    |
| TOPRANGE            | 当前值是近多少周期内的最大值         | 当前值是近多少周期内的最大值                          | TOPRANGE(X):X是近多少周期内X的最大值<br>例如:TOPRANGE(HIGH)表示当前最高价是近多少周期内最高价的最大值                                                                                                                                                                                                                                                                                                                                                                                              |
| LOWRANGE            | 当前值是近多少周期内的最小值         | 当前值是近多少周期内的最小值                          | LOWRANGE(X):X是近多少周期内X的最小值<br>例如:LOWRANGE(LOW)表示当前最低价是近多少周期内最低价的最小值                                                                                                                                                                                                                                                                                                                                                                                               |
| FINDHIGH            | 寻找指定周期内的特定最大值          | N周期前的M周期内的第T个最大值                        | FINDHIGH(VAR,N,M,T):VAR在N日前的M天内第T个最高价                                                                                                                                                                                                                                                                                                                                                                                                                            |
| FINDHIGHBARS        | 寻找指定周期内的特定最大值到当前周期的周期数 | N周期前的M周期内的第T个最大值到当前周期的周期数               | FINDHIGHBARS(VAR,N,M,T):VAR在N日前的M天内第T个最高价到当前周期的周期数                                                                                                                                                                                                                                                                                                                                                                                                               |
| FINDLOW             | 寻找指定周期内的特定最小值          | N周期前的M周期内的第T个最小值                        | FINDLOW(VAR,N,M,T):VAR在N日前的M天内第T个最低价                                                                                                                                                                                                                                                                                                                                                                                                                             |
| FINDLOWBARS         | 寻找指定周期内的特定最小值到当前周期的周期数 | N周期前的M周期内的第T个最小值到当前周期的周期数               | FINDLOWBARS(VAR,N,M,T):VAR在N日前的M天内第T个最低价到当前周期的周期数                                                                                                                                                                                                                                                                                                                                                                                                                |
| EXTERNSTR           | 引用自定义外部字符串数据           |                                         | EXTERNSTR(TYPE,ID)<br>TYPE为1表示是系统保留数据,<br>TYPE为0表示是自定义外部数据,读取signals目录下面的的extern_user.txt,请用自定义数据管理器来维护<br>extern_user.txt为文本结构,如下1\|600717\|1\|好股\|0.33<br>市场(0:深圳,1:上海,2:北京)\|品种代码\|数据号\|文字串\|数值如果是导出格式,则不需要数据号                                                                                                                                                                                                                                                |
| EXTERNVALUE         | 引用自定义外部数值数据            |                                         | EXTERNVALUE(TYPE,ID),用法同EXTERNSTR类似                                                                                                                                                                                                                                                                                                                                                                                                                              |
| SIGNALS_SYS         | 引用自定义序列数据(系统)          | 引用自定义序列数据(系统)                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| SIGNALS_USER        | 引用自定义序列数据              | 引用自定义序列数据                               | 读取个人目录下的signals目录下面的[signals_user_?]目录,请用自定义数据管理器来维护<br>SIGNALS_USER(11,TYPE):表示读当前品种的11数据号的序列数据(自定义数据需按日期从小到大排序),TYPE:1表示做平滑处理,没有自定义数据的周期返回上一周期的值;0表示不做平滑处理;2表示没有数据则为0                                                                                                                                                                                                                                                                                          |
| EXTDATA_USER        | 引用扩展数据                 | 引用扩展数据                                  | 请用扩展数据管理器来设置和刷新数据.<br>EXTDATA_USER(N,TYPE),N取(1-100),表示读当前品种的N号扩展序列数据,TYPE:1表示做平滑处理,没有数据的周期返回上一周期的值;0表示不做平滑处理;2表示没有数据则为0                                                                                                                                                                                                                                                                                                                                         |
| SPLIT               | 除权除息数据                 | 除权除息数据                                  | SPLIT(N,TYPE),取得之前第N次除息除权(送转股,分红)的除权除息数据,参数为0表示送转股的比例(送转/(送转+10)),1表示每股分红(分红/10)),例如:SPLIT(0,0)=0.5表示最近一次除权可能是10送10                                                                                                                                                                                                                                                                                                                                              |
| SPLITBARS           | 除权除息到现在的周期数            | 除权除息到现在的周期数                             | SPLITBARS(N,TYPE),取得之前第N次除权除息到当前的周期数,参数为0表示送转股,1表示分红,2表示送转股或分红,例如:SPLITBARS(0,0)=0表示当天发生除权                                                                                                                                                                                                                                                                                                                                                                       |
| DIVFACTOR           | 除权因子                   | 除权因子                                    | DIVFACTOR(TYPE),TYPE=0表示根据使用公式时带进来的复权方式(自适应)1表示前复权2表示后复权                                                                                                                                                                                                                                                                                                                                                                                                         |
| ZTPRICE             | 计算涨停价                  | 涨停价                                     | ZTPRICE(REF(CLOSE,1),0.1):按10%计算得到在昨收盘基础上的涨停价(对于复权序列K线,由于复权处理或不复权时的分红转增,根据前一天的收盘价计算结果可能与涨停价不符)<br>比如:ZTPRICE(REF(QHJSJ,1),0.1),得到期货的涨停价                                                                                                                                                                                                                                                                                                                          |
| DTPRICE             | 计算跌停价                  | 跌停价                                     | DTPRICE(REF(CLOSE,1),0.1):按10%计算得到在昨收盘基础上的跌停价(对于复权序列K线,由于复权处理或不复权时的分红转增,根据前一天的收盘价计算结果可能与跌停价不符)<br>比如:DTPrice(REF(QHJSJ,1),0.6),得到期货的跌停价(跌停比例为0.6的话)                                                                                                                                                                                                                                                                                                              |
| TDXDLL1             | 第1号DLL                 | 调用DLL中的函数                               | DLL1(funcid,param1,param2,param3),funcid为数字,表示调用dll函数编号                                                                                                                                                                                                                                                                                                                                                                                                          |
| TDXDLL2             | 第2号DLL                 | 调用DLL中的函数                               | DLL2(funcid,param1,param2,param3),funcid为数字,表示调用dll函数编号                                                                                                                                                                                                                                                                                                                                                                                                          |
| USERFUNC0           | DLL函数(无参数)             | 调用DLL中的函数,DLL中内部对应定义                    | USERFUNC0                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| USERFUNC1           | DLL函数(1参数)             | 调用DLL中的函数,DLL中内部对应定义                    | USERFUNC1(param1)                                                                                                                                                                                                                                                                                                                                                                                                                                                |
### 4.4 板块字符函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center>                | <center>用法</center>                                                                                                                                            |
| ------------------- | ------------------- | ---------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CODE                | 品种代码                | 品种代码                                                 | DRAWTEXT_FIX(ISLASTBAR,0,0,0,CODE);在屏幕左上角显示品种代码                                                                                                                |
| STKNAME             | 品种名称                | 品种名称                                                 | DRAWTEXT_FIX(ISLASTBAR,0,0,0,STKNAME);在屏幕左上角显示品种名称                                                                                                             |
| HYBLOCK             | 所属行业(字串)            | 品种所属行业                                               | DRAWTEXT_FIX(ISLASTBAR,0,0,0,HYBLOCK);在屏幕左上角显示所属行业板块                                                                                                           |
| DYBLOCK             | 所属地域(字串)            | 品种所属地域                                               | DRAWTEXT_FIX(ISLASTBAR,0,0,0,DYBLOCK);在屏幕左上角显示所属地域板块                                                                                                           |
| MOREHYBLOCK         | 所属细分行业(字串)          | 品种所属细分行业                                             | DRAWTEXT_FIX(ISLASTBAR,0,0,0,MOREHYBLOCK);在屏幕左上角显示所属细分行业板块                                                                                                     |
| LEVEL1HYBLOCK       | 所属一级研究行业(字串)        | 品种所属一级研究行业                                           | DRAWTEXT_FIX(ISLASTBAR,0,0,0,LEVEL1HYBLOCK);在屏幕左上角显示所属一级研究行业板块                                                                                                 |
| MAINBUSINESS        | 主营构成(字串)            | 主营构成                                                 | DRAWTEXT_FIX(ISLASTBAR,0,0,0,MAINBUSINESS);在屏幕左上角显示主营构成                                                                                                        |
| GNBLOCK             | 所属概念板块(字串)          | 所属概念板块                                               | DRAWTEXT_FIX(ISLASTBAR,0,0,0,GNBLOCK);在屏幕左上角显示所属概念板块                                                                                                           |
| FGBLOCK             | 所属风格板块(字串)          | 所属风格板块                                               | DRAWTEXT_FIX(ISLASTBAR,0,0,0,FGBLOCK);在屏幕左上角显示所属风格板块                                                                                                           |
| ZSBLOCK             | 所属指数板块(字串)          | 所属指数板块                                               | DRAWTEXT_FIX(ISLASTBAR,0,0,0,ZSBLOCK);在屏幕左上角显示所属指数板块                                                                                                           |
| ZHBLOCK             | 所属组合板块(字串)          | 所属组合板块                                               | DRAWTEXT_FIX(ISLASTBAR,0,0,0,ZHBLOCK);在屏幕左上角显示所属组合板块                                                                                                           |
| ZDBLOCK             | 所属自定义板块(字串)         | 所属自定义板块                                              | DRAWTEXT_FIX(ISLASTBAR,0,0,0,ZDBLOCK);在屏幕左上角显示所属自定义板块                                                                                                          |
| GNBLOCKNUM          | 所属概念板块(个数)          | 所属概念板块的个数                                            | IF(GNBLOCKNUM>5,1,0)                                                                                                                                           |
| FGBLOCKNUM          | 所属风格板块(个数)          | 所属风格板块的个数.                                           |                                                                                                                                                                |
| ZSBLOCKNUM          | 所属指数板块(个数)          | 所属指数板块的个数                                            |                                                                                                                                                                |
| ZHBLOCKNUM          | 所属组合板块(个数)          | 所属组合板块的个数                                            |                                                                                                                                                                |
| ZDBLOCKNUM          | 所属自定义板块(个数)         | 所属自定义板块的个数                                           |                                                                                                                                                                |
| HYZSCODE            | 所属行业的板块指数代码         | 品种所属行业的板块指数代码                                        | CALCSTOCKINDEX(HYZSCODE,'KDJ',3)                                                                                                                               |
| HYSYL               | 指数市盈率或个股所属行业的市盈率    | 指数市盈率或个股所属行业的市盈率                                     |                                                                                                                                                                |
| HYSJL               | 指数市净率或个股所属行业的市净率    | 指数市净率或个股所属行业的市净率                                     |                                                                                                                                                                |
| GNBKZSCODE          | 所属概念板块的指数代码         | 品种所属概念板块的指数代码                                        | 参数表示是第几个,支持1-60<br>用于支持Level2行情的版本,比如:CALCSTOCKINDEX(GNBKZSCODE(1),'KDJ',3)                                                                                    |
| FGBKZSCODE          | 所属风格板块的指数代码         | 品种所属风格板块的指数代码                                        | 参数表示是第几个,支持1-60.<br>用于支持Level2行情的版本,比如:CALCSTOCKINDEX(FGBKZSCODE(1),'KDJ',3)                                                                                   |
| INBLOCK             | 属于某板块               | 品种是否属于某板块                                            | if(INBLOCK('沪深300'),x,y);<br>板块名称支持系统板块(上证Ａ股,深证Ａ股,沪深Ａ股/全部Ａ股,创业板,科创板,自选股,板块指数等),地区,行业(按系统设置的通达信二级或研究二级),概念,风格,指数,组合和自定义板块,注意名称要准确(HY.和GN.和MY.开头就直接找行业和概念和自定义板块) |
| NAMELIKE            | 模糊匹配品种名称            | 品种名称是否以参数开头                                          | if(NAMELIKE('ST'),x,y)                                                                                                                                         |
| CODELIKE            | 模糊匹配品种代码            | 品种代码是否以参数开头                                          | if(CODELIKE('600'),x,y)                                                                                                                                        |
| NAMEINCLUDE         | 品种名称中包含             | 品种名称中是否包含参数                                          | if(NAMEINCLUDE('文化'),x,y)                                                                                                                                      |
| GETNAMEOFCODE       | 根据品种代码得到品种名称        | 根据品种代码和市场(比如深交所为0,上交所和板块指数为1,未知时可传-1),得到品种名称         | DRAWTEXT_FIX(ISLASTBAR,0,0,0,GETNAMEOFCODE(1,HYZSCODE))                                                                                                        |
| CON2STR             | 取值转为字符串             | CON2STR(A,N):取A最后的值(非序列值)转为字符串,小数位数N                 | CON2STR(FINANCE(20),3)表示取营业收入,以3位小数转为字符串                                                                                                                       |
| VAR2STR             | 取值转为字符串(序列)         | VAR2STR(A,N):取A的每一个值转为字符串,小数位数N                      | VAR2STR(C,3)表示取收盘价,以3位小数转为字符串                                                                                                                                  |
| STR2CON             | 字符串转为数字             | STR2CON(S):将字符串S转化为数字                                | STR2CON('2365.02')表示将字符串'2365.02'转化为数字2365.02                                                                                                                  |
| STRLEN              | 得到字符串的长度            | STRLEN(S):得到字符串S(非序列值)的长度                            | STRLEN('通达信')表示字符串'通达信'为6                                                                                                                                      |
| STRCAT              | 字符串相加               | STRCAT(A,B):将两个字符串A,B(非序列化)相加成一个字符串C                 | STRCAT('多头','开仓')将两个字符串'多头','开仓'相加成一个字符串'多头开仓'                                                                                                                 |
| STRCAT6             | 字符串相加               | STRCAT6(A,B,C,D,E,F):将六个字符串A,B,C,D,E,F(非序列化)相加成一个字符串 | STRCAT6('多头','开仓','或者','空头','平仓','')将六个字符串相加成一个字符串                                                                                                             |
| STRSPACE            | 字符串加一空格             | STRSPACE(A):字符串附带一空格                                 |                                                                                                                                                                |
| SUBSTR              | 字符串中取一部分            | SUBSTR(S,A,N):取字符串S中从位置A取N长的子字符串,A从1开始               |                                                                                                                                                                |
| VARCAT              | 字符串相加(序列)           | VARCAT(A,B):将两个字符串A,B相加成一个字符串C                       | DRAWTEXT(CLOSE>OPEN,LOW,VARCAT('多头',VAR2STR(C,2)))将两个字符串相加成一个字符串并按条件显示出来                                                                                       |
| STRCMP              | 字符串比较               | STRCMP(A,B):比较两个字符串A,B是否相等                           | STRCMP(HYBLOCK,'房地产')将成分股行业字符串与'房地产'比较,是否相等,如果相等表示属于房地产板块                                                                                                      |
| FINDSTR             | 字符串查找               | FINDSTR(A,B):在字符串A中查找字符串B,如果找到返回1,否则返回0              | FINDSTR('多头开仓','开仓')在字符串'多头开仓'中查找字符串'开仓',返回1                                                                                                                   |
| TOKENWORD           | 标识简字<br>            | 用户在客户端设置的标识简字                                        | DRAWTEXT_FIX(ISLASTBAR,0.1,0.5,0,TOKENWORD);                                                                                                                   |

### 4.5 逻辑函数

| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                    |
| ------------------- | ------------------- | ------------------------------------- | -------------------------------------------------------------------------------------- |
| CROSS               | 上穿                  | 两条线交叉                                 | CROSS(A,B)表示当A从下方向上穿过B时返回1,否则返回0.<br>例如:CROSS(MA(CLOSE,5),MA(CLOSE,10))表示5日均线与10日均线交金叉 |
| LONGCROSS           | 维持一定周期后上穿           | 两条线维持一定周期后交叉                          | LONGCROSS(A,B,N)表示A在N周期内都小于B,本周期从下方向上穿过B时返回1,否则返回0                                     |
| UPNDAY              | 连涨                  | 是否连涨周期数                               | UPNDAY(CLOSE,M)表示连涨M个周期                                                                |
| DOWNNDAY            | 连跌                  | 是否连跌周期                                | DOWNNDAY(CLOSE,M)表示连跌M个周期                                                              |
| NDAY                | 连大                  | 是否持续存在X>Y                             | NDAY(CLOSE,OPEN,3)表示连续3日收阳线                                                            |
| EXIST               | 存在                  | 是否存在                                  | EXIST(CLOSE>OPEN,10)表示前10日内存在着阳线                                                       |
| EVERY               | 一直存在                | 一直存在                                  | EVERY(CLOSE>OPEN,10)表示前10日内一直阳线                                                        |
| LAST                | 持续存在                | 持续存在                                  | LAST(CLOSE>OPEN,10,5),表示从前10日到前5日内一直阳线.<br>若A为0,表示从第一天开始,B为0,表示到最后日止.                  |
| NOT                 | 取反                  | 求逻辑非                                  | NOT(X)返回非X,即当X=0时返回1,否则返回0<br>例如:NOT(ISUP)表示平盘或收阴                                      |
| ISVALID             | 判断有效值               | 判断是否是有效数值                             |                                                                                        |
| UPDOWN              | 大小变化                | 数据相对上一周期的大小                           | UPDOWN(X)表示X相对上一周期的大小,-1为变小,0表示不变,1为变大                                                 |
### 4.6 选择函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                                                                    |
| ------------------- | ------------------- | ------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| IF                  | 条件判断                | 根据条件求不同的值                             | IF(X,A,B)若X不为0则返回A,否则返回B.<br>例如:IF(CLOSE>OPEN,HIGH,LOW)表示该周期收阳则返回最高值,否则返回最低值                                                           |
| IFF                 | 条件判断                | 根据条件求不同的值                             | IFF(X,A,B)若X不为0则返回A,否则返回B.<br>例如:IFF(CLOSE>OPEN,HIGH,LOW)表示该周期收阳则返回最高值,否则返回最低值                                                         |
| IFN                 | 条件反判断               | 根据条件求不同的值                             | IFN(X,A,B)若X不为0则返回B,否则返回A.<br>例如:IFN(CLOSE>OPEN,HIGH,LOW)表示该周期收阴则返回最高值,否则返回最低值                                                         |
| IFC                 | 条件判断,可终止            | 根据条件执行不同的语句,可中止(根据序列的最后一个数值来判断)       | IFC(X,A,B)若X不为0则执行A,否则执行B.<br>IFC与IF函数的区别:根据X的值来选择性执行A、B表达式.<br>例如:IFC(CLOSE>OPEN,HIGH,TESTSKIP(1));L;表示当日收阳则返回最高值,并执行下一句"L;",否则退出公式计算 |
| VALUEWHEN           | 条件跟随                | VALUEWHEN(COND,X)                     | 当COND条件成立时,取X的当前值,否则取VALUEWHEN的上个值                                                                                                     |
| TESTSKIP            | 是否就此返回              | TESTSKIP(A):满足A则直接返回                  | TESTSKIP(A),表示如果满足条件A则该公式直接返回,不再计算接下来的表达式注意:A为非序列数据,只取最后一个数据                                                                           |
### 4.7 数学函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                                  |
| ------------------- | ------------------- | ------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| MAX                 | 较大值                 | 求最大值                                  | MAX(A,B)返回A和B中的较大值.<br>例如:MAX(CLOSE-OPEN,0)表示若收盘价大于开盘价返回它们的差值,否则返回0                                  |
| MIN                 | 较小值                 | 求最小值                                  | MIN(A,B)返回A和B中的较小值.<br>例如:MIN(CLOSE,OPEN)返回开盘价和收盘价中的较小值                                              |
| MAX6                | 较大值                 | 求6个参数中的最大值                            | MAX6(A,B,C,D,E,F)返回较大值                                                                               |
| MIN6                | 较小值                 | 求6个参数中的最小值                            | MIN6(A,B,C,D,E,F)返回较小值                                                                               |
| ACOS                | 反余弦                 | 反余弦值                                  | ACOS(X)返回X的反余弦值                                                                                      |
| ASIN                | 反正弦                 | 反正弦值                                  | ASIN(X)返回X的反正弦值                                                                                      |
| ATAN                | 反正切                 | 反正切值                                  | ATAN(X)返回X的反正切值                                                                                      |
| COS                 | 余弦                  | 余弦值                                   | COS(X)返回X的余弦值                                                                                        |
| SIN                 | 正弦                  | 正弦值                                   | SIN(X)返回X的正弦值                                                                                        |
| TAN                 | 正切                  | 正切值                                   | TAN(X)返回X的正切值                                                                                        |
| EXP                 | 指数                  | 指数                                    | EXP(X)e的X次幂.<br>例如:EXP(CLOSE)返回e的CLOSE次幂                                                             |
| LN                  | 自然对数                | 自然对数                                  | LN(X)以e为底的对数.<br>例如:LN(CLOSE)求收盘价的对数                                                                 |
| LOG                 | 对数                  | 求10为底的对数                              | LOG(X)取得X的对数.<br>例如:LOG(100)等于2                                                                      |
| SQRT                | 开方                  | 开平方                                   | SQRT(X)求X的平方根.<br>例如:SQRT(CLOSE)收盘价的平方根                                                              |
| ABS                 | 绝对值                 | 求绝对值                                  | ABS(X)返回X的绝对值.<br>例如:ABS(-34)返回34                                                                    |
| POW                 | 乘幂                  | 乘幂                                    | POW(A,B)返回A的B次幂.<br>例如:POW(CLOSE,3)求得收盘价的3次方                                                         |
| CEILING             | 向上舍入                | 向上舍入                                  | CEILING(A)返回沿A数值增大方向最接近的整数.<br>例如:CEILING(12.3)求得13,CEILING(-3.5)求得-3                                |
| FLOOR               | 向下舍入                | 向下舍入                                  | FLOOR(A)返回沿A数值减小方向最接近的整数.<br>例如:FLOOR(12.3)求得12,FLOOR(-3.5)求得-4                                      |
| INTPART             | 整数部分                |                                       | INTPART(A)返回沿A绝对值减小方向最接近的整数.<br>例如:INTPART(12.3)求得12,INTPART(-3.5)求得-3                               |
| BETWEEN             | 介于                  | 介于                                    | BETWEEN(A,B,C)表示A处于B和C之间时返回1,否则返回0.<br>例如:BETWEEN(CLOSE,MA(CLOSE,10),MA(CLOSE,5))表示收盘价介于5日均线和10日均线之间 |
| FRACPART            | 小数部分                | 小数部分                                  | FRACPART(X),返回X的小数部分                                                                                 |
| ROUND               | 四舍五入                | 四舍五入                                  | ROUND(X),返回X四舍五入到个位的数值                                                                               |
| ROUND2              | 四舍五入                | 四舍五入                                  | ROUND2(X,N),返回X四舍五入到N位小数的数值.由于精度问题,数据越大误差可能越大                                                        |
| SIGN                | 符号                  | 符号                                    | SIGN(X),返回X的符号.当X>0,X=0,X<0分别返回1,0,-1                                                                |
| MOD                 | 模                   | 取模                                    | MOD(M,N),返回M关于N的模(M除以N的余数).<br>例如:MOD(5,3)返回2注意:公式系统对有效数字部分有要求,如果数字部分超过7-8位,会有精度丢失                   |
| RAND                | 随机正整数               | 取随机数                                  | RAND(N),返回一个范围在1-N的随机整数                                                                              |
### 4.8 统计函数

| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center>              | <center>用法</center>                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ------------------- | ------------------- | -------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| AVED                | 平均绝对方差              | AVEDEV(X,N)返回平均绝对方差                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| DEVSQ               | 数据偏差平方和             | DEVSQ(X,N)返回数据偏差平方和                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| FORCAST             | 线性回归预测值             | FORCAST(X,N)返回线性回归预测值                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| SLOPE               | 线性回归斜率              | SLOPE(X,N)返回线性回归斜率                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| STD                 | 估算标准差               | STD(X,N)返回估算标准差                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| STDP                | 总体标准差               | STDP(X,N)返回总体标准差                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| VAR                 | 估算样本方差              | VAR(X,N)返回估算样本方差                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| VARP                | 总体样本方差              | VARP(X,N)返回总体样                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| COVAR               | 协方差                 | COVAR(X,Y,N)返回X和Y的N周期的协方差,N支持变量                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| RELATE              | 相关系数                | RELATE(X,Y,N)返回X和Y的N周期的相关系数,N支持变量                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| BETA                | (Beta)系数            | β(Beta)系数                                          | BETA(N)返回当前证券N周期收益与对应大盘指数收益相比的贝塔系数,N支持变量.<br>(对应指数的数据必须要先下载到本地)                                                                                                                                                                                                                                                                                                                                                                                               |
| BETAEX              | 相关放大系数              | BETAEX(X,Y,N)返回X与Y的N周期的相关放大系数,N支持变量                |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| IVOLAT              | 期权波动率               | IVOLAT(N,M)返回期权波动率N表示计算周期M表示类型,0:标的证券的历史波动率1:隐含波动率 |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| BLOCKSETNUM         | 板块股个数               | BLOCKSETNUM横向统计                                    | BLOCKSETNUM(板块名称),返回该板块的股票个数.<br>板块名称支持系统板块(上证Ａ股,深证Ａ股,沪深Ａ股/全部Ａ股,创业板,科创板,自选股,板块指数等),地区,行业(按系统设置的通达信二级或研究二级),概念,风格,指数,组合和自定义板块,注意名称要准确(HY.和GN.和MY.开头就直接找行业和概念和自定义板块,此函数计算有较大耗时,请慎用于画线指标),<br>第一个参数也可以是HYBLOCK等,某板块指数的STKNAME.                                                                                                                                                                                                                                   |
| HORCALC             | 板块统计                | HORCALC横向统计                                        | HORCALC(板块名称,数据项,计算方式,权重),<br>数据项:100-HIGH,101-OPEN,102-LOW,103-CLOSE,104-VOL,105-涨幅,106-成交额<br>计算方式:0-累加,1-排名次,2-平均值<br>平均值权重:0-总股本,1-流通股本,2-等同权重,3-流通市值,4-总市值.<br>板块名称支持系统板块(上证Ａ股,深证Ａ股,沪深Ａ股/全部Ａ股,创业板,科创板,自选股,板块指数等),地区,行业(按系统设置的通达信二级或研究二级),概念,风格,指数,组合和自定义板块,注意名称要准确(HY.和GN.和MY.开头就直接找行业和概念和自定义板块,此函数计算有较大耗时,请慎用于画线指标),<br>第一个参数也可以是HYBLOCK等,某板块指数的STKNAME                                                                                                 |
| INSORT              | 板块指标排序              | INSORT横向统计                                         | INSORT(板块名称,指标名称,指标线,升降序),返回该股在板块中的排序序号<br>例如:INSORT('房地产','KDJ',3,0)表示该股的KDJ指标第三个输出即J之值在房地产板块中的排名,<br>最后一个参数为0表示降序排名.<br>板块名称支持系统板块(上证Ａ股,深证Ａ股,沪深Ａ股/全部Ａ股,创业板,科创板,自选股,板块指数等),地区,行业(按系统设置的通达信二级或研究二级),概念,风格,指数,组合和自定义板块,注意名称要准确(HY.和GN.和MY.开头就直接找行业和概念和自定义板块,此函数计算有较大耗时,请慎用于画线指标),<br>第一个参数也可以是HYBLOCK等,某板块指数的STKNAME                                                                                                                                           |
| INSUM               | 板块指标统计              | INSUM横向统计                                          | INSUM(板块名称,指标名称,指标线,计算类型), 返回板块各成分该指标相应输出按计算类型得到的计算值.<br>计算类型:0-累加,1-平均数,2-最大值,3-最小值,4-最大值所处的品种序号,5-最小值所处的品种序号.<br>例如:INSUM('房地产','KDJ',3,0)表示房地产板块中所有股票的KDJ指标第三个输出即J之值的累加值.<br>板块名称支持系统板块(上证Ａ股,深证Ａ股,沪深Ａ股/全部Ａ股,创业板,科创板,自选股,板块指数等),地区,行业(按系统设置的通达信二级或研究二级),概念,风格,指数,组合和自定义板块,注意名称要准确(HY.和GN.和MY.开头就直接找行业和概念和自定义板块,此函数计算有较大耗时,请慎用于画线指标),<br>第一个参数也可以是HYBLOCK等,某板块指数的STKNAME,<br>若为MYBGBK和MYFGBK(Level2行情的版本),则为它所属的一些概念板块指数和风格板块指数,例如:INSUM('MYGNBK','KDJ',3,4) |
### 4.9 形态函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                                     |
| ------------------- | ------------------- | ------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| COST                | 成本分布                | 成本分布情况                                | COST(10),表示10%获利盘的价格是多少,即有10%的持仓量在该价格以下,其余90%在该价格以上,为套牢盘.<br>该函数仅对日线分析周期有效                              |
| PEAK                | 波峰值                 | 前M个ZIG转向波峰值                           | PEAK(K,N,M)表示之字转向ZIG(K,N)的前M个波峰的数值,M必须大于等于1.<br>例如:PEAK(1,5,1)表示%5最高价ZIG转向的上一个波峰的数值                     |
| PEAKBARS            | 波峰位置                | 前M个ZIG转向波峰到当前距离                       | PEAKBARS(K,N,M)表示之字转向ZIG(K,N)的前M个波峰到当前的周期数,M必须大于等于1.<br>例如:PEAKBARS(0,5,1)表示%5开盘价ZIG转向的上一个波峰到当前的周期数     |
| SAR                 | 抛物转向                | 抛物转向                                  | SAR(N,S,M),N为计算周期,S为步长,M为极值.<br>例如:SAR(10,2,20)表示计算10日抛物转向,步长为2%,极限值为20%                                |
| SARTURN             | 抛物转向点               | 抛物转向点                                 | SARTURN(N,S,M)N为计算周期,S为步长,M为极值,若发生向上转向则返回1,若发生向下转向则返回-1,否则为0.<br>其用法与SAR函数相同.                           |
| TROUGH              | 波谷值                 | 前M个ZIG转向波谷值                           | TROUGH(K,N,M)表示之字转向ZIG(K,N)的前M个波谷的数值,M必须大于等于1.<br>例如:TROUGH(2,5,2)表示%5最低价ZIG转向的前2个波谷的数值                 |
| TROUGHBARS          | 波谷位置                | 前M个ZIG转向波谷到当前距离                       | TROUGHBARS(K,N,M)表示之字转向ZIG(K,N)的前M个波谷到当前的周期数,M必须大于等于1.<br>例如:TROUGHBARS(2,5,2)表示%5最低价ZIG转向的前2个波谷到当前的周期数 |
| WINNER              | 获利盘比例               | 获利盘比例                                 | WINNER(CLOSE)表示以当前收市价卖出的获利盘比例.<br>例如:返回0.1表示10%获利盘;WINNER(10.5)表示10.5元价格的获利盘比例.该函数仅对日线分析周期有效            |
| LWINNER             | 近期获利盘比例             | 近期获利盘比例                               | LWINNER(5,CLOSE)表示最近5天的那部分成本以当前收市价卖出的获利盘比例.例如返回0.1表示10%获利盘                                              |
| PWINNER             | 远期获利盘比例             | 远期获利盘比例                               | PWINNER(5,CLOSE)表示5天前的那部分成本以当前收市价卖出的获利盘比例.例如返回0.1表示10%获利盘                                               |
| COSTEX              | 区间成本                | 区间成本                                  | COSTEX(CLOSE,REF(CLOSE,1)),表示近两日收盘价格间筹码的成本,例如返回10表示区间成本为20元.<br>该函数仅对日线分析周期有效                           |
| PPART               | 远期成本分布比例            | 远期成本分布比例                              | PPART(10),表示10前的成本占总成本的比例,0.2表示20%                                                                      |
| ZIG                 | 之字转向                | 之字转向                                  | ZIG(K,N)当价格变化量超过N%时转向,K表示0:开盘价,1:最高价,2:最低价,3:收盘价,其余:数组信息.<br>例如:ZIG(3,5)表示收盘价的5%的ZIG转向                  |
| ZIGA                | 之字转向                | 属于未来函数,之字转向                           | ZIGA(K,X),当价格变化超过X时转向,K表示0:开盘价,1:最高价,2:最低价,3:收盘价,其余:数组信息.<br>例如:ZIGA(3,1.5)表示收盘价变化1.5元的ZIGA转向           |
| NewSAR              | 新抛物转向               | 新抛物转向函数                               | NewSAR(N,S),N为起始统计天数,S为加速因子.<br>例如:NewSAR(10,2)表示从10日后开始统计,加速因子为2的抛物转向.<br>LFS锁定因子,LFS返回个股锁定因子          |
### 4.10 指数标的函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center>                       | <center>用法</center>                          |
| ------------------- | ------------------- | ----------------------------------------------------------- | -------------------------------------------- |
| INDEXA              | 大盘的成交额              | 对应的大盘成交额,分别是上证指数,深证成指,科创50,创业板指,港股为恒生指数,国内期货为对应的L9指数品种(持仓量) | (对应指数的数据必须要先下载到本地)                           |
| INDEXADV            | 大盘的上涨家数             | 对应的上涨家数,分别是上证指数,深证成指,科创50,创业板指                              | (对应指数的数据必须要先下载到本地)                           |
| INDEXDEC            | 大盘的下跌家数             | 对应的下跌家数,分别是上证指数,深证成指,科创50,创业板指                              | (对应指数的数据必须要先下载到本地)                           |
| INDEXC              | 大盘的收盘价              | 对应的大盘收盘价,分别是上证指数,深证成指,科创50,创业板指,港股为恒生指数,国内期货为对应的L9指数品种      | (对应指数的数据必须要先下载到本地)注:多日线周期(除缺省45日),需要对应数据日期一致 |
| INDEXH              | 大盘的最高价              | 对应的大盘最高价,分别是上证指数,深证成指,科创50,创业板指,港股为恒生指数,国内期货为对应的L9指数品种      | (对应指数的数据必须要先下载到本地)                           |
| INDEXL              | 大盘的最低价              | 对应的大盘最低价,分别是上证指数,深证成指,科创50,创业板指,港股为恒生指数,国内期货为对应的L9指数品种      | (对应指数的数据必须要先下载到本地)                           |
| INDEXO              | 大盘的开盘价              | 对应的大盘开盘价,分别是上证指数,深证成指,科创50,创业板指,港股为恒生指数,国内期货为对应的L9指数品种      | (对应指数的数据必须要先下载到本地)                           |
| INDEXV              | 大盘的成交量              | 对应的大盘成交量,分别是上证指数,深证成指,科创50,创业板指,港股为恒生指数,国内期货为对应的L9指数品种      | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXA           | 行业指数的成交额            | 对应的行业指数成交额,如果没有通达信板块指数,港美股没有扩展板块指数,则不支持.                    | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXADV         | 行业指数的上涨家数           | 对应的行业指数上涨家数,如果没有通达信板块指数,则不支持                                | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXDEC         | 行业指数的下跌家数           | 对应的行业指数下跌家数,如果没有通达信板块指数,则不支持                                | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXC           | 行业指数的收盘价            | 对应的行业指数收盘价,如果没有通达信板块指数,港美股没有扩展板块指数,则不支持                     | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXH           | 行业指数的最高价            | 对应的行业指数最高价,如果没有通达信板块指数,港美股没有扩展板块指数,则不支持                     | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXL           | 行业指数的最低价            | 对应的行业指数最低价,如果没有通达信板块指数,港美股没有扩展板块指数,则不支持                     | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXO           | 行业指数的开盘价            | 对应的行业指数开盘价,如果没有通达信板块指数,港美股没有扩展板块指数,则不支持                     | (对应指数的数据必须要先下载到本地)                           |
| HY_INDEXV           | 行业指数的成交量            | 对应的行业指数成交量,如果没有通达信板块指数,港美股没有扩展板块指数,则不支持                     | (对应指数的数据必须要先下载到本地)                           |
| DPZSCODE            | 所属的大盘指数的代码          | 所属的大盘指数的代码                                                  | CALCSTOCKINDEX(DPZSCODE,'KDJ',3)             |
| DPZSNAME            | 所属的大盘指数的名称          | 所属的大盘指数的名称                                                  | DRAWTEXT_FIX(ISLASTBAR,0,0,0,DPZSNAME)       |
| UNDERCODE           | 对应标的的代码             | 对应标的的代码,对于股票期权品种和可转债品种等有效                                   | CALCSTOCKINDEX(UNDERCODE,'KDJ',3)            |
| UNDERLYC            | 对应标的的收盘价            | 对应标的的收盘价,对于股票期权品种和可转债品种等有效                                  | (对应指数的数据必须要先下载到本地)                           |
### 4.11 资金流向函数

| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                 |
| ------------------- | ------------------- | ------------------------------------- | ----------------------------------------------------------------------------------- |
| TRADENUM            | 总成交单数               |                                       | 逐笔成交总单数,沪深京品种的资金流向,仅日线以上周期,用于特定版本                                                   |
| TRADEINNUM          | 逐笔买入成交单数            |                                       | 逐笔买入成交单数,相当于L2_VOLNUM(0,0)+L2_VOLNUM(1,0),沪深京品种的资金流向,仅日线以上周期,用于特定版本                 |
| TRADEOUTNUM         | 逐笔卖出成交单数            |                                       | 逐笔卖出成交单数,相当于L2_VOLNUM(0,1)+L2_VOLNUM(1,1),沪深京品种的资金流向,仅日线以上周期,用于特定版本                 |
| LARGETRDINNUM       | 逐笔买入大单成交单数          |                                       | 逐笔买入大单成交单数,相当于L2_VOLNUM(0,0),沪深京品种的资金流向,仅日线以上周期,用于特定版本                              |
| L2_VOLNUM           | 单数分档                | L2_VOLNUM(N,M)                        | 单数分档,按:N(0--1):(超大+大)/(中+小),M(0--1):买/卖二类,沪深京品种的资金流向,仅日线以上周期,用于特定版本                 |
| L2_VOL              | 成交量分档               | L2_VOL(N,M)                           | 成交量分档,按:N(0--3):超大/大/中/小四档处理,M(0--3):买入/卖出/主买/主卖四类,沪深京品种的资金流向,仅日线以上周期,用于特定版本        |
| L2_AMO              | 成交额分档               | L2_AMO(N,M)                           | 成交额分档,按:N(0--3):超大/大/中/小四档处理,M(0--3):买入/卖出/主买/主卖四类,沪深京品种的资金流向,仅日线以上周期,用于特定版本        |
| CUR_BUYORDER        | 当前总委买量              |                                       | 当前总委买量,专业版等(资金流向功能)沪深京品种行情专用                                                        |
| CUR_SELLORDER       | 当前总委卖量              |                                       | 当前总委卖量,专业版等(资金流向功能)沪深京品种行情专用                                                        |
| ACTINVOL            | 主动买成交量              |                                       | 主动买成交量,相当于L2_VOL(0,2)+L2_VOL(1,2)+L2_VOL(2,2)+L2_VOL(3,2),沪深京品种的资金流向,仅日线以上周期,用于特定版本 |
| ACTOUTVOL           | 主动卖成交量              |                                       | 主动卖成交量,相当于L2_VOL(0,3)+L2_VOL(1,3)+L2_VOL(2,3)+L2_VOL(3,3),沪深京品种的资金流向,仅日线以上周期,用于特定版本 |
| LARGEINTRDVOL       | 逐笔买入大单成交量           |                                       | 逐笔买入大单成交量,相当于L2_VOL(0,0)+L2_VOL(1,0),沪深京品种的资金流向,仅日线以上周期,用于特定版本                      |
| LARGEOUTTRDVOL      | 逐笔卖出大单成交量           |                                       | 逐笔卖出大单成交量,相当于L2_VOL(0,1)+L2_VOL(1,1),沪深京品种的资金流向,仅日线以上周期,用于特定版本                      |
| BIDORDERVOL         | 累计总有效委买量            |                                       | 累计总有效委买量,专业版等(资金流向功能)沪深京品种行情专用累计总有效委买量-累计总有效撤买量=总买+总成交量                             |
| BIDCANCELVOL        | 累计总有效委卖量            |                                       | 累计总有效撤买量,专业版等(资金流向功能)沪深京品种行情专用累计总有效委买量-累计总有效撤买量=总买+总成交量                             |
| AVGBIDPX            | 最新委买均价              |                                       | 专业版等(资金流向功能)沪深京品种行情专用:最新委买均价                                                        |
| OFFERORDERVOL       | 累计总有效委卖量            |                                       | 累计总有效委卖量,专业版等(资金流向功能)沪深京品种行情专用累计总有效委卖量-累计总有效撤卖量=总卖+总成交量                             |
| OFFERCANCELVOL      | 累计总有效撤卖量            |                                       | 累计总有效撤卖量,专业版等(资金流向功能)沪深京品种行情专用累计总有效委卖量-累计总有效撤卖量=总卖+总成交量                             |
| AVGOFFERPX          | 最新委卖均价              |                                       | 专业版等(资金流向功能)沪深京品种行情专用:最新委卖均价                                                        |
### 4.12  绘图函数

| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                                                                                                                                                                                         |
| ------------------- | ------------------- | ------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| PLOYLINE            | 折线段                 | 在图形上绘制折线段                             | PLOYLINE(COND,PRICE),当COND条件满足时,以PRICE位置为顶点画折线连接.<br>例如:PLOYLINE(HIGH>=HHV(HIGH,20),HIGH)表示在创20天新高点之间画折线                                                                                                                                                    |
| DRAWLINE            | 直线段                 | 在图形上绘制直线段                             | DRAWLINE(COND1,PRICE1,COND2,PRICE2,EXPAND)<br>当COND1条件满足时,在PRICE1位置画直线起点,当COND2条件满足时,在PRICE2位置画直线终点,EXPAND为延长类型<br>例如:DRAWLINE(HIGH>=HHV(HIGH,20),HIGH,LOW<=LLV(LOW,20),LOW,1)表示在创20天新高与创20天新低之间画直线并且向右延长                                                   |
| DRAWSL              | 斜线                  | 绘制斜线                                  | DRAWSL(COND,PRICE,SLOPE,LEN,DIRECT),当COND条件满足时,在PRICE位置画斜线,SLOPE为斜率,LEN为长度,DIRECT为0向右延伸,1向左延伸,2双向延伸.<br>注意:<br>1.K线间的纵向高度差为SLOPE;<br>2.SLOPE为0时,为水平线;<br>3.SLOPE为10000时,为垂直线,LEN为向上的像素高度,DIRECT表示向上或向下延伸;<br>4.SLOPE和LEN支持变量;                               |
| DRAWKLINE           | K线                  |                                       | DRAWKLINE(HIGH,OPEN,LOW,CLOSE).以HIGH为最高价,OPEN为开盘价,LOW为最低,CLOSE收盘画K线                                                                                                                                                                                         |
| STICKLINE           | 柱线线                 | 在图形上绘制柱线                              | STICKLINE(COND,PRICE1,PRICE2,WIDTH,EMPTY),当COND条件满足时,在PRICE1和PRICE2位置之间画柱状线,宽度为WIDTH(10为标准间距),EMPTH不为0则画空心柱.<br>例如:STICKLINE(CLOSE>OPEN,CLOSE,OPEN,0.8,1)表示画K线中阳线的空心柱体部分                                                                                    |
| DRAWICON            | 图标                  | 在图形上绘制小图标                             | DRAWICON(COND,PRICE,TYPE),当COND条件满足时,在PRICE位置画TYPE号图标.<br>例如:DRAWICON(CLOSE>OPEN,LOW,1)表示当收阳时在最低价位置画1号图标<br>图标一共有九个,图形如附图.序号,最下面的是"1"号,最上面的是"9"号.                                                                                                           |
| DRAWTEXT            | 文字                  | 在图形上显示文字                              | DRAWTEXT(COND,PRICE,TEXT),当COND条件满足时,在PRICE位置书写文字TEXT.<br>例如:DRAWTEXT(CLOSE/OPEN>1.08,LOW,'大阳线')表示当日实体阳线大于8%时在最低价位置显示'大阳线'字样                                                                                                                                |
| DRAWTEXT_FIX        | 定点文字                | 1.固定位置显示文字;2.在指标排序中显示字符串栏目            | DRAWTEXT_FIX(COND,X,Y,TYPE,TEXT),COND中一般需要加ISLASTBAR,当COND条件满足时,在当前指标窗口内(X,Y)位置书写文字TEXT,X,Y为书写点在窗口中相对于左上角的百分比,TYPE:0为左对齐,1为右对齐.<br>例如:DRAWTEXT_FIX(ISLASTBARANDCLOSE/OPEN>1.08,0.5,0.5,0,'大阳线')表示最后一个交易日实体阳线大于8%时在窗口中间位置显示'大阳线'字样.若文字中含有&,则进行折行             |
| DRAWNUMBER          | 画数字                 | 画出数字                                  | DRAWNUMBER(COND,PRICE,NUMBER),当COND条件满足时,在PRICE位置书写数字NUMBER.<br>例如:DRAWNUMBER(CLOSE/OPEN>1.08,LOW,C)表示当日实体阳线大于8%时在最低价位置显示收盘价                                                                                                                                |
| DRAWNUMBER_FIX      | 画定点数字               | 固定位置显示数字                              | DRAWNUMBER_FIX(COND,X,Y,TYPE,NUMBER),COND中一般需要加ISLASTBAR,当COND条件满足时,在当前指标窗口内(X,Y)位置书写数字NUMBER,X,Y为书写点在窗口中相对于左上角的百分比,TYPE:0为左对齐,1为右对齐.<br>例如:DRAWNUMBER_FIX(ISLASTBARANDCLOSE/OPEN>1.08,0.5,0.5,0,C)表示最后一个交易日实体阳线大于8%时在窗口中间位置显示收盘价                           |
| RGB                 | 自定色                 | 将自定颜色作为数值输出                           | RGB(Red,Green,Blue),输出为0XBBGGRR,参数使用十进制数,范围为0至255,以最近一个周期数值为准.<br>例如:RGB(0,0,255)输出结果为16进制的0XFF0000                                                                                                                                                         |
| DRAWBAND            | 画带状线                | 画出带状线                                 | DRAWBAND(VAL1,COLOR1,VAL2,COLOR2),当VAL1>VAL2时,在VAL1和VAL2之间填充COLOR1;当VAL1<VAL2时,填充COLOR2,这里的颜色均使用RGB函数计算得到<br>例如:DRAWBAND(OPEN,RGB(0,224,224),CLOSE,RGB(255,96,96))                                                                                          |
| DRAWBMP             | 画图片                 | 画出图片                                  | DRAWBMP(COND,PRICE,'Bmp文件名'),当条件COND满足时,在PRICE位置画T0002目录下面的signals目录下面的"Bmp文件名";<br>例如:DRAWBMP(O>C,CLOSE,'高开')                                                                                                                                              |
| DRAWGBK             | 填充背景                | 填充背景                                  | DRAWGBK(COND,COLOR1,COLOR2,是否横向渐进,'BMP或PNG文件名',是否拉升BMP或PNG文件名),当条件COND满足时填充背景,如果COLOR1和COLOR2有一个不为0,则以COLOR1到COLOR2的渐变色为背景,否则画T0002目录下面的signals目录下面的'Bmp或Png文件名'(优先使用BMP文件).<br>例如:DRAWGBK(ISLASTBARANDO>C,RGB(0,255,0),RGB(255,0,0),0,'背景图',0)             |
| DRAWGBK_DIV         | 填充部分背景              | 填充部分背景                                | DRAWGBK_DIV(COND,COLOR1,COLOR2,填色方式,填充范围),填充满足COND条件的背景区域.<br>填色方式:0是上下渐进1是左右渐进2是用COLOR1画框线3是用COLOR1画框线,用COLOR2填充.<br>填充范围:0为整个区域1为最高最低区(主图)2为开盘收盘区(主图).<br>例如:DRAWGBK_DIV(C>O,RGB(0,255,0),RGB(255,0,0),0,0)                                               |
| DRAWRECTREL         | 相对位置上画矩形            | 相对位置上画矩形                              | DRAWRECTREL(LEFT,TOP,RIGHT,BOTTOM,COLOR),以图形窗口(LEFT,TOP)为左上角,(RIGHT,BOTTOM)为右下角绘制矩形,坐标单位是窗口沿水平和垂直方向的1/1000,取值范围是0—999,超出范围则可能显示在图形窗口外,矩形中间填充颜色COLOR,COLOR为0表示不填充.<br>例如:DRAWRECTREL(0,0,500,500,RGB(255,255,0)),NOFRAME;表示在图形最左上部1/4位置用黄色绘制矩形.NOFRAME表示不加边框 |
| PARTLINE            | 条件颜色线               | 条件颜色线                                 | PARTLINE(VAL,COLOR,DIRECT),VAL表示数值,COLOR为RGB颜色函数,DIRECT为画法(0表示颜色从当前数据开始,1表示颜色从上个数据到当前数据).例如:PARTLINE(C,IF(C=O,RGB(192,192,192),IF(C>O,RGB(255,0,0),RGB(0,128,0))),0),LINETHICK3                                                                             |
### 4.13 关联财务函数
| <center>名称</center> | <center>含义</center>               |
| ------------------- | --------------------------------- |
| MULTTPLIER          | 期货每手乘数                            |
| TQFLAG              | 当前的复权状态                           |
| USEDDATANUM         | 当前使用的数据个数                         |
| TOTALCAPITAL        | 当前总股本(手)                          |
| CAPITAL             | 当前流通股本(手)                         |
| FINANCE(1)          | 总股本(股)                            |
| FINANCE(2)          | 市场类型                              |
| FINANCE(3)          | 沪深京品种类型                           |
| FINANCE(4)          | 沪深京行业代码                           |
| FINANCE(5)          | B股                                |
| FINANCE(6)          | H股                                |
| FINANCE(7)          | 流通股本(股)                           |
| FINANCE(8)          | 股东人数(户)                           |
| FINANCE(9)          | 资产负债率%                            |
| FINANCE(10)         | 总资产                               |
| FINANCE(11)         | 流动资产                              |
| FINANCE(12)         | 固定资产                              |
| FINANCE(13)         | 无形资产                              |
| FINANCE(15)         | 流动负债                              |
| FINANCE(16)         | 少数股东权益                            |
| FINANCE(17)         | 资本公积金                             |
| FINANCE(18)         | 每股公积金                             |
| FINANCE(19)         | 股东权益(净资产)                         |
| FINANCE(20)         | 营业收入                              |
| FINANCE(21)         | 营业成本                              |
| FINANCE(22)         | 应收账款                              |
| FINANCE(23)         | 营业利润                              |
| FINANCE(24)         | 投资收益                              |
| FINANCE(25)         | 经营现金流量                            |
| FINANCE(26)         | 总现金流量                             |
| FINANCE(27)         | 存货                                |
| FINANCE(28)         | 利益总额                              |
| FINANCE(29)         | 税后利益                              |
| FINANCE(30)         | 净利益                               |
| FINANCE(31)         | 未分配利益                             |
| FINANCE(32)         | 每股未分配利润                           |
| FINANCE(33)         | 每股收益(全年折算)                        |
| FINANCE(34)         | 每股净资产                             |
| FINANCE(35)         | 季报调整净资产                           |
| FINANCE(36)         | 股东权益比                             |
| FINANCE(37)         | 第几季报                              |
| FINANCE(38)         | 每股收益(最近一期)                        |
| FINANCE(39)         | 总市值                               |
| FINANCE(40)         | 流通市值                              |
| FINANCE(41)         | AB股总市值                            |
| FINANCE(42)         | 上市的天数                             |
| FINANCE(43)         | 利润同比%                             |
| FINANCE(44)         | 收入同比%                             |
| FINANCE(45)         | 股息率%                              |
| FINANCE(46)         | 自由流通股本(股)                         |
| FINANCE(48)         | 是否为陆股通标的                          |
| FINANCE(49)         | 今日权息标识                            |
| FINANCE(50)         | 是否属于沪深300                         |
| FINANCE(51)         | 是否含可转债                            |
| FINANCE(52)         | 是否为融资融券标的                         |
| FINANCE(53)         | 每股股息(港股,美股)                       |
| FINANCE(54)         | 扣非净利润                             |
| FINANCE(55)         | 研发费用                              |
| FINANCE(56)         | 员工人数                              |
| FINANCE(57)         | 货币资金                              |
| FINANCE(58)         | 合同负债                              |
| FINANCE(59)         | 其他权益工具                            |
| FINANCE(60)         | 行权比例(权证,期权)                       |
| FINANCE(61)         | 行权价(权证,期权)                        |
| FINANCE(62)         | 杠杆比率(权证,期权)                       |
| FINANCE(63)         | 内在价值(权证,期权)                       |
| FINANCE(64)         | 溢价率(权证,期权)                        |
| FINANCE(65)         | 时间价值(权证,期权)                       |
| FINANCE(66)         | 剩余天数(期货,期权)                       |
| FINANCE(67)         | 合约乘数(期权)                          |
| FINANCE(68)         | Delta对冲值(权证,期权)                   |
| FINANCE(69)         | 认购认沽类型(股票期权)                      |
| FINANCE(80)         | 最近财报公告离现在的天数                      |
| FINANCE(81)         | 最后涨停板离现在的天数                       |
| FINANCE(82)         | 最后跌停板离现在的天数                       |
| FINANCE(83)         | 最后上榜离现在的天数                        |
| FINANCE(84)         | 最近停牌离现在的天数                        |
| FINANCE(85)         | 最近业绩预告离现在的天数                      |
| FINANCE(86)         | 最近股份解禁离现在的天数                      |
| FINANCE(87)         | 最近定增股上市离现在的天数                     |
| FINANCE(88)         | 最近北上大额增仓日离现在的天数                   |
| FINANCE(89)         | 最近北上大额减仓日离现在的天数                   |
| FINANCE(90)         | 最近回购预案日离现在的天数                     |
| FINANCE(91)         | 最近股权激励预案日离现在的天数                   |
| FINANCE(101)        | 用户在客户端设置的标识                       |
| SAFECORE            | SAFESCORE安全分(0-100),通达信扫雷宝数据,仅供参考 |
| LOCALDAYNUM         | 客户端本地已下载的该品种的日线数据个数(含当日)          |
### 4.14 专业财务函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------- | ------------------- | ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FINVALUE            | 专业财务数据（序列）          |                                       | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场.<br>FINVALUE(ID),ID为数据编号<br>数据编号如下：<br>0--返回报告期(YYMMDD格式),150930表示为2015年第三季<br>说明：<br>1.所有指标没有标注单位的都是个位,如资金项单位都是元,股本单位都是股。<br>2.所有的空值数据显示为0,以方便客户加减运算,非金融类指标在指标名称后有标注。<br>-------------每股指标-----------------------------<br>1--基本每股收益<br>2--扣除非经常性损益每股收益<br>3--每股未分配利润<br>4--每股净资产<br>5--每股资本公积金<br>6--净资产收益率<br>7--每股经营现金流量<br>-------------资产负债表----------------------------<br>8.--货币资金<br>9.--交易性金融资产<br>10.--应收票据<br>11.--应收账款<br>12.--预付款项<br>13.--其他应收款<br>14.--应收关联公司款<br>15.--应收利息<br>16.--应收股利<br>17.--存货<br>18.--其中：消耗性生物资产<br>19.--一年内到期的非流动资产<br>20.--其他流动资产<br>21.--流动资产合计<br>22.--可供出售金融资产<br>23.--持有至到期投资<br>24.--长期应收款<br>25.--长期股权投资<br>26.--投资性房地产<br>27.--固定资产<br>28.--在建工程<br>29.--工程物资<br>30.--固定资产清理<br>31.--生产性生物资产<br>32.--油气资产<br>33.--无形资产<br>34.--开发支出<br>35.--商誉<br>36.--长期待摊费用<br>37.--递延所得税资产<br>38.--其他非流动资产<br>39.--非流动资产合计<br>40.--资产总计<br>41.--短期借款<br>42.--交易性金融负债<br>43.--应付票据<br>44.--应付账款<br>45.--预收款项<br>46.--应付职工薪酬<br>47.--应交税费<br>48.--应付利息<br>49.--应付股利<br>50.--其他应付款<br>51.--应付关联公司款<br>52.--一年内到期的非流动负债<br>53.--其他流动负债<br>54.--流动负债合计<br>55.--长期借款<br>56.--应付债券<br>57.--长期应付款<br>58.--专项应付款<br>59.--预计负债<br>60.--递延所得税负债<br>61.--其他非流动负债<br>62.--非流动负债合计<br>63.--负债合计<br>64.--实收资本（或股本）<br>65.--资本公积<br>66.--盈余公积<br>67.--减：库存股<br>68.--未分配利润<br>69.--少数股东权益<br>70.--外币报表折算价差<br>71.--非正常经营项目收益调整<br>72.--所有者权益（或股东权益）合计<br>73.--负债和所有者（或股东权益）合计<br>-------------利润表-----------------------------<br>74.--其中：营业收入<br>75.--其中：营业成本<br>76.--营业税金及附加<br>77.--销售费用<br>78.--管理费用<br>79.--勘探费用<br>80.--财务费用<br>81.--资产减值损失<br>82.--加：公允价值变动净收益<br>83.--投资收益<br>84.--其中：对联营企业和合营企业的投资收益<br>85.--影响营业利润的其他科目<br>86.--三、营业利润<br>87.--加：补贴收入<br>88.--营业外收入<br>89.--减：营业外支出<br>90.--其中：非流动资产处置净损失<br>91.--加：影响利润总额的其他科目<br>92.--四、利润总额<br>93.--减：所得税<br>94.--加：影响净利润的其他科目<br>95.--五、净利润<br>96.--归属于母公司所有者的净利润<br>97.--少数股东损益<br>------------------现金流量表---------------------<br>98.--销售商品、提供劳务收到的现金<br>99.--收到的税费返还<br>100.--收到其他与经营活动有关的现金<br>101.--经营活动现金流入小计<br>102.--购买商品、接受劳务支付的现金<br>103.--支付给职工以及为职工支付的现金<br>104.--支付的各项税费<br>105.--支付其他与经营活动有关的现金<br>106.--经营活动现金流出小计<br>107.--经营活动产生的现金流量净额<br>108.--收回投资收到的现金<br>109.--取得投资收益收到的现金<br>110.--处置固定资产、无形资产和其他长期资产收回的现金净额<br>111.--处置子公司及其他营业单位收到的现金净额<br>112.--收到其他与投资活动有关的现金<br>113.--投资活动现金流入小计<br>114.--购建固定资产、无形资产和其他长期资产支付的现金<br>115.--投资支付的现金<br>116.--取得子公司及其他营业单位支付的现金净额<br>117.--支付其他与投资活动有关的现金<br>118.--投资活动现金流出小计<br>119.--投资活动产生的现金流量净额<br>120.--吸收投资收到的现金<br>121.--取得借款收到的现金<br>122.--收到其他与筹资活动有关的现金<br>123.--筹资活动现金流入小计<br>124.--偿还债务支付的现金<br>125.--分配股利、利润或偿付利息支付的现金<br>126.--支付其他与筹资活动有关的现金<br>127.--筹资活动现金流出小计<br>128.--筹资活动产生的现金流量净额<br>129.--四、汇率变动对现金的影响<br>130.--四(2)、其他原因对现金的影响<br>131.--五、现金及现金等价物净增加额<br>132.--期初现金及现金等价物余额<br>133.--期末现金及现金等价物余额<br>134.--净利润  [注：该指标是现金流量表-补充资料中的净利润]<br>135.--加：资产减值准备<br>136.--固定资产折旧、油气资产折耗、生产性生物资产折旧<br>137.--无形资产摊销<br>138.--长期待摊费用摊销<br>139.--处置固定资产、无形资产和其他长期资产的损失<br>140.--固定资产报废损失<br>141.--公允价值变动损失<br>142.--财务费用<br>143.--投资损失<br>144.--递延所得税资产减少<br>145.--递延所得税负债增加<br>146.--存货的减少<br>147.--经营性应收项目的减少<br>148.--经营性应付项目的增加<br>149.--其他<br>150.--经营活动产生的现金流量净额2<br>151.--债务转为资本<br>152.--一年内到期的可转换公司债券<br>153.--融资租入固定资产<br>154.--现金的期末余额<br>155.--减：现金的期初余额<br>156.--加：现金等价物的期末余额<br>157.--减：现金等价物的期初余额<br>158.--现金及现金等价物净增加额<br>---------------------偿债能力分析------------------------<br>159.--流动比率(非金融类指标)<br>160.--速动比率(非金融类指标)<br>161.--现金比率(%)(非金融类指标)<br>162.--利息保障倍数(非金融类指标)<br>163.--非流动负债比率(%)(非金融类指标)<br>164.--流动负债比率(%)(非金融类指标)<br>166.--有形资产净值债务率(%)<br>167.--权益乘数(%)<br>168.--股东的权益/负债合计(%)<br>169.--有形资产/负债合计(%)<br>170.--经营活动产生的现金流量净额/负债合计(%)(非金融类指标)<br>171.--EBITDA/负债合计(%)(非金融类指标)<br>---------------------经营效率分析------------------------<br>172.--应收帐款周转率(非金融类指标)<br>173.--存货周转率(非金融类指标)<br>174.--运营资金周转率(非金融类指标)<br>175.--总资产周转率(非金融类指标)<br>176.--固定资产周转率(非金融类指标)<br>177.--应收帐款周转天数(非金融类指标)<br>178.--存货周转天数(非金融类指标)<br>179.--流动资产周转率(非金融类指标)<br>180.--流动资产周转天数(非金融类指标)<br>181.--总资产周转天数(非金融类指标)<br>182.--股东权益周转率(非金融类指标)<br>---------------------发展能力分析------------------------<br>183.--营业收入增长率(%)<br>184.--净利润增长率(%)<br>185.--净资产增长率(%)<br>186.--固定资产增长率(%)<br>187.--总资产增长率(%)<br>188.--投资收益增长率(%)<br>189.--营业利润增长率(%)<br>190.--扣非每股收益同比(%)<br>191.--扣非净利润同比(%)<br>192.--暂无<br>---------------------获利能力分析------------------------<br>193.--成本费用利润率(%)<br>194.--营业利润率(非金融类指标)<br>195.--营业税金率(非金融类指标)<br>196.--营业成本率(非金融类指标)<br>197.--净资产收益率<br>198.--投资收益率<br>199.--销售净利率(%)<br>200.--总资产净利率<br>201.--净利润率(非金融类指标)<br>202.--销售毛利率(%)(非金融类指标)<br>203.--三费比重(非金融类指标)<br>204.--管理费用率(非金融类指标)<br>205.--财务费用率(非金融类指标)<br>206.--扣除非经常性损益后的净利润<br>207.--息税前利润(EBIT)<br>208.--息税折旧摊销前利润(EBITDA)<br>209.--EBITDA/营业总收入(%)(非金融类指标)<br>---------------------资本结构分析---------------------<br>210.--资产负债率(%)<br>211.--流动资产比率(非金融类指标)<br>212.--货币资金比率(非金融类指标)<br>213.--存货比率(非金融类指标)<br>214.--固定资产比率<br>215.--负债结构比(非金融类指标)<br>216.--归属于母公司股东权益/全部投入资本(%)<br>217.--股东的权益/带息债务(%)<br>218.--有形资产/净债务(%)<br>---------------------现金流量分析---------------------<br>219.--每股经营性现金流(元)<br>220.--营业收入现金含量(%)(非金融类指标)<br>221.--经营活动产生的现金流量净额/经营活动净收益(%)<br>222.--销售商品提供劳务收到的现金/营业收入(%)<br>223.--经营活动产生的现金流量净额/营业收入<br>224.--资本支出/折旧和摊销<br>225.--每股现金流量净额(元)<br>226.--经营净现金比率（短期债务）(非金融类指标)<br>227.--经营净现金比率（全部债务）<br>228.--经营活动现金净流量与净利润比率<br>229.--全部资产现金回收率<br>---------------------单季度财务指标---------------------<br>230.--营业收入<br>231.--营业利润<br>232.--归属于母公司所有者的净利润<br>233.--扣除非经常性损益后的净利润<br>234.--经营活动产生的现金流量净额<br>235.--投资活动产生的现金流量净额<br>236.--筹资活动产生的现金流量净额<br>237.--现金及现金等价物净增加额<br>---------------------股本股东---------------------<br>238.--总股本<br>239.--已上市流通A股<br>240.--已上市流通B股<br>241.--已上市流通H股<br>242.--股东人数(户)<br>243.--第一大股东的持股数量<br>244.--十大流通股东持股数量合计(股)<br>245.--十大股东持股数量合计(股)<br>---------------------机构持股---------------------<br>246.--机构总量（家）<br>247.--机构持股总量(股)<br>248.--QFII机构数<br>249.--QFII持股量<br>250.--券商机构数<br>251.--券商持股量<br>252.--保险机构数<br>253.--保险持股量<br>254.--基金机构数<br>255.--基金持股量<br>256.--社保机构数<br>257.--社保持股量<br>258.--私募机构数<br>259.--私募持股量<br>260.--财务公司机构数<br>261.--财务公司持股量<br>262.--年金机构数<br>263.--年金持股量<br>---------------------新增指标---------------------<br>264.--十大流通股东持有的流通A股合计(股)[ 注：2019半年报之前，季度报告中，若股东持股除了流通A股、还有流通B股或流通H股，指标264取的是包含流通B股或流通H股的流通股数]<br>265.--第一大流通股东持股量(股)<br>266.--自由流通股(股)[注：1.自由流通股=已流通A股-持股5%以上股东的流通A股（一致行动人算一起）；2.指标按报告期展示，新股在上市日的下个报告期才有数据]<br>267.--受限流通A股(股)<br>268.--一般风险准备(金融类)<br>269.--其他综合收益(利润表)<br>270.--综合收益总额(利润表)<br>271.--归属于母公司股东权益(资产负债表)<br>272.--银行机构数(家)(机构持股)<br>273.--银行持股量(股)(机构持股)<br>274.--一般法人机构数(家)(机构持股)<br>275.--一般法人持股量(股)(机构持股)<br>276.--近一年净利润(元)<br>277.--信托机构数(家)(机构持股)<br>278.--信托持股量(股)(机构持股)<br>279.--特殊法人机构数(家)(机构持股)<br>280.--特殊法人持股量(股)(机构持股)<br>281.--加权净资产收益率(每股指标)<br>282.--扣非每股收益(单季度财务指标)<br>283.--最近一年营业收入（万元）<br>284.--国家队持股数量（万股)[注：本指标统计包含汇金公司、证金公司、外汇管理局旗下投资平台、国家队基金、国开、养老金以及中科汇通等国家队机构持股数量]<br>285.--业绩预告-本期归母净利润同比增幅下限%[注：指标285至294展示未来一个报告期的数据。例，3月31日至6月29日这段时间内展示的是中报的数据；如果最新的财务报告后面有多个报告期的业绩预告/快报，只能展示最新的财务报告后面的一个报告期的业绩预告/快报]<br>286.--业绩预告-本期归母净利润同比增幅上限%<br>287.--业绩快报-归母净利润<br>288.--业绩快报-扣非净利润<br>289.--业绩快报-总资产<br>290.--业绩快报-净资产<br>291.--业绩快报-每股收益<br>292.--业绩快报-摊薄净资产收益率<br>293.--业绩快报-加权净资产收益率<br>294.--业绩快报-每股净资产<br>295.--应付票据及应付账款(资产负债表)<br>296.--应收票据及应收账款(资产负债表)<br>297.--递延收益(资产负债表-非流动负债)<br>298.--其他综合收益(资产负债表)<br>299.--其他权益工具(资产负债表)<br>300.--其他收益(利润表)<br>301.--资产处置收益(利润表)<br>302.--持续经营净利润(利润表)<br>303.--终止经营净利润(利润表)<br>304.--研发费用(利润表)<br>305.--其中:利息费用(利润表-财务费用)<br>306.--其中:利息收入(利润表-财务费用)<br>307.--近一年经营活动现金流净额<br>308.--近一年归母净利润（万元）<br>309.--近一年扣非净利润（万元）<br>310.--近一年现金净流量（万元）<br>311.--基本每股收益（单季度）<br>312.--营业总收入(单季度)(万元)<br>313.--业绩预告公告日期 [注：本指标展示未来一个报告期的数据。例,3月31日至6月29日这段时间内展示的是中报的数据；如果最新的财务报告后面有多个报告期的业绩预告/快报，只能展示最新的财务报告后面的一个报告期的业绩预告/快报的数据；公告日期格式为YYMMDD，例：190101代表2019年1月1日]<br>314.--财报公告日期 [注：日期格式为YYMMDD,例：190101代表2019年1月1日]<br>315.--业绩快报公告日期 [注：本指标展示未来一个报告期的数据。例,3月31日至6月29日这段时间内展示的是中报的数据；如果最新的财务报告后面有多个报告期的业绩预告/快报，只能展示最新的财务报告后面的一个报告期的业绩预告/快报的数据；公告日期格式为YYMMDD，例：190101代表2019年1月1日]<br>316.--近一年投资活动现金流净额(万元)<br>317.--业绩预告-本期归母净利润下限(万元)[注：指标317至318展示未来一个报告期的数据。例，3月31日至6月29日这段时间内展示的是中报的数据；如果最新的财务报告后面有多个报告期的业绩预告/快报，只能展示最新的财务报告后面的一个报告期的业绩预告/快报]<br>318.--业绩预告-本期归母净利润上限(万元)<br>319.--营业总收入TTM(万元)<br>320.--员工总数(人)<br>321.--每股企业自由现金流<br>322.--每股股东自由现金流<br>323.--近一年营业利润（万元）<br>324.--净利润（单季度）(万元）<br>325.--北上资金数（家）(机构持股）<br>326.--北上资金持股量（股）(机构持股）<br>327.--有息负债率<br>328.--营业成本（单季度）(万元）<br>329.--投入资本回报率（ROIC）(获利能力分析)<br>330.--业绩快报-营业收入（本期）<br>331.--业绩快报-营业收入（上期）<br>332.--业绩快报-营业利润（本期）<br>333.--业绩快报-营业利润（上期）<br>334.--业绩快报-利润总额（本期）<br>335.--业绩快报-利润总额（上期）<br>336.--审计意见  [注：0-未审计,1-无保留意见,2-带强调事项段的无保留意见,3-保留意见,4-无法表示意见,5-否定意见及其他]<br>---------------------资产负债表新增指标---------------------<br>401.--专项储备(万元)<br>402.--结算备付金(万元)<br>403.--拆出资金(万元)<br>404.--发放贷款及垫款(万元)(流动资产科目)<br>405.--衍生金融资产(万元)<br>406.--应收保费(万元)<br>407.--应收分保账款(万元)<br>408.--应收分保合同准备金(万元)<br>409.--买入返售金融资产(万元)<br>410.--划分为持有待售的资产(万元)<br>411.--发放贷款及垫款(万元)(非流动资产科目)<br>412.--向中央银行借款(万元)<br>413.--吸收存款及同业存放(万元)<br>414.--拆入资金(万元)<br>415.--衍生金融负债(万元)<br>416.--卖出回购金融资产款(万元)<br>417.--应付手续费及佣金(万元)<br>418.--应付分保账款(万元)<br>419.--保险合同准备金(万元)<br>420.--代理买卖证券款(万元)<br>421.--代理承销证券款(万元)<br>422.--划分为持有待售的负债(万元)<br>423.--预计负债(万元)<br>424.--递延收益(万元)（流动负债科目，公告此科目的股票较少，大部分公司没有此数据）<br>425.--其中:优先股(万元)(非流动负债科目)<br>426.--永续债(万元)(非流动负债科目)<br>427.--长期应付职工薪酬(万元)<br>428.--其中:优先股(万元)(所有者权益科目)<br>429.--永续债(万元)(所有者权益科目)<br>430.--债权投资(万元)<br>431.--其他债权投资(万元)<br>432.--其他权益工具投资(万元)<br>433.--其他非流动金融资产(万元)<br>434.--合同负债(万元)<br>435.--合同资产(万元)<br>436.--其他资产(万元)<br>437.--应收款项融资(万元)<br>438.--使用权资产(万元)<br>439.--租赁负债(万元)<br>440.--发放贷款及垫款(万元)  [注：金融类科目]<br>---------------------利润表新增指标---------------------<br>501.--稀释每股收益(元)<br>502.--营业总收入(万元)<br>503.--汇兑收益(万元)<br>504.--其中:归属于母公司综合收益(万元)<br>505.--其中:归属于少数股东综合收益(万元)<br>506.--利息收入(万元)<br>507.--已赚保费(万元)<br>508.--手续费及佣金收入(万元)<br>509.--利息支出(万元)<br>510.--手续费及佣金支出(万元)<br>511.--退保金(万元)<br>512.--赔付支出净额(万元)<br>513.--提取保险合同准备金净额(万元)<br>514.--保单红利支出(万元)<br>515.--分保费用(万元)<br>516.--其中:非流动资产处置利得(万元)<br>517.--信用减值损失(万元)<br>518.--净敞口套期收益(万元)<br>519.--营业总成本(万元)<br>520.--信用减值损失(万元、2019格式)<br>521.--资产减值损失(万元、2019格式)<br>---------------------现金流量表新增指标---------------------<br>561.--加:其他原因对现金的影响2(万元)(现金的期末余额科目)<br>562.--客户存款和同业存放款项净增加额(万元)<br>563.--向中央银行借款净增加额(万元)<br>564.--向其他金融机构拆入资金净增加额(万元)<br>565.--收到原保险合同保费取得的现金(万元)<br>566.--收到再保险业务现金净额(万元)<br>567.--保户储金及投资款净增加额(万元)<br>568.--处置以公允价值计量且其变动计入当期损益的金融资产净增加额(万元)<br>569.--收取利息、手续费及佣金的现金(万元)<br>570.--拆入资金净增加额(万元)<br>571.--回购业务资金净增加额(万元)<br>572.--客户贷款及垫款净增加额(万元)<br>573.--存放中央银行和同业款项净增加额(万元)<br>574.--支付原保险合同赔付款项的现金(万元)<br>575.--支付利息、手续费及佣金的现金(万元)<br>576.--支付保单红利的现金(万元)<br>577.--其中:子公司吸收少数股东投资收到的现金(万元)<br>578.--其中:子公司支付给少数股东的股利、利润(万元)<br>579.--投资性房地产的折旧及摊销(万元)<br>580.--信用减值损失(万元)<br>581.--使用权资产折旧（万元） |
| FINONE              | 专业财务数据（指定日期）        |                                       | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场.<br>FINONE(ID,Y,MMDD),ID为数据编号,Y和MMDD表示年和月日.<br>如果Y和MMDD都为0,表示最新的财报;<br>如果Y为0,MMDD为小于300的数字,表示最近一期向前推MMDD期的数据,如果是331,630,930,1231这些,表示最近一期的对应季报的数据;<br>如果MMDD为0,Y为一数字,表示最近一期向前推Y年的同期数据;<br>季报分界点为:0331,0630,0930,1231<br>数据编号如下：<br>0--返回报告期(YYMMDD格式),150930表示为2015年第三季<br>说明：<br>1.所有指标没有标注单位的都是个位,如资金项单位都是元,股本单位都是股。<br>2.所有的空值数据显示为0,以方便客户加减运算,非金融类指标在指标名称后有标注                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| GPJYVALUE           | 股票交易类数据(序列)         |                                       | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场,不支持获取太早时间的数据.<br>GPJYVALUE(ID,N,TYPE),ID为数据编号,N表示第几个数据(取1或2),TYPE:为1表示做平滑处理,没有数据的周期返回上一周期的值;为0表示不做平滑处理;2表示没有数据则为0.<br>股票交易类数据函数，数据编号如下：<br>1--股东人数 股东户数(户)<br>2--龙虎榜   买入总计(万元) 卖出总计(万元)[注：该指标展示最近一年的数据]<br>3--融资融券1 融资余额(万元) 融券余量(股)<br>4--大宗交易 成交均价(元) 成交额(万元)<br>5--增减持   成交均价(元) 变动股数(股)<br>6--陆股通持股量  持股数量(股)[注：该指标展示20170317日之后的数据]<br>7--陆股通市场成交净额  陆股通市场净买入(万元)[注：官方只公布了每日的前十名数据]<br>8--龙虎榜机构(卖方)数据  卖方机构个数 机构卖出金额(万元)<br>9--龙虎榜机构(买方)数据  买方机构个数 机构买入金额(万元)<br>10--近3月机构调研情况  近3月机构调研次数 近3月调研机构数量<br>11--融资融券2 融资买入额(万元) 融资偿还额(万元)<br>12--融资融券3 融券卖出量(股) 融券偿还量(股)<br>13--融资融券4 融资净买入(万元) 融券净卖出(股)<br>14--涨停数据 涨停金额(万元) 开板次数[注：该指标展示20180319日之后的数据]<br>15--涨跌停 涨跌停状态 封单金额(万元)[注：涨停取2,曾涨停取1,跌停取-2,曾跌停取-1;跌停和曾跌停时,封单金额取负值 该指标展示20160926日之后的数据]<br>16--总市值 总市值(万元)<br>17--龙虎榜营业部数据    买入金额(万元) 卖出金额(万元) <br>18--龙虎榜沪深股通数据  买入金额(万元) 卖出金额(万元)<br>19--每周股票质押数量    无限售股份质押数(万) 有限售股份质押数(万)[注：该指标展示20180316日之后的数据]<br>20--每周股票质押比例    质押比例(%)[注：该指标展示20180316日之后的数据]<br>21--股息率 股息率(%)<br>22--涨跌停 封成比(%) 封流比(%)[注：该指标展示20180319日之后的数据]<br>23--拟增减持 拟增持数量(万股) 拟减持数量(万股)<br>24--涨停  首次涨停时间  涨停最大封单额(万) [注：首次涨停时间展示20160301之后的数据，涨停最大封单额展示20200730之后的数据]<br>25--盘前盘后成交量  开盘成交量(手)  盘后固定成交量(手)  [注：盘后固定成交量这个指标只有科创板有]<br>26--拟增减持金额  拟增持金额(万元)  拟减持金额(万元)<br>27--人气排名  市场人气排名  行业人气排名  [注：行业排名为通达信二级研究行业排名]<br>28--股票回购  回购均价(元)  回购数量(万股)<br>29--证券信息  是否复牌日  是否更名日  [注：是否复牌日说明：0-不是复牌日，n(n>0)-停牌n个交易日之后的复牌日；是否更明日说明：0-未更名，1-常规更名，2-加ST，3-加*ST，4-摘帽，5-其他]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| GPJYONE             | 股票交易类数据(指定日期)       | 引用某天某种类型的股票交易类数据                      | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场,不支持获取太早时间的数据.<br>GPJYONE(ID,N,Y,MMDD),ID为数据编号,N表示第几个数据(取1或2),Y和MMDD表示年和月日.<br>如果Y为0,MMDD为0,表示最新数据,MMDD为1,2,3...,表示倒数第2,3,4...个数据                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| BKJYVALUE           | 引用板块交易类数据(序列)       |                                       | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场.<br>BKJYVALUE(ID,N,TYPE),ID为数据编号,N表示第几个数据(取1或2),TYPE:为1表示做平滑处理,没有数据的周期返回上一周期的值;为0表示不做平滑处理;2表示没有数据则为0<br>板块交易类数据函数，数据编号如下：<br>几个主要指数(总市值等指数,上证指数,深圳成指,沪深300,创业板指,科创50,北证50)和通达信二、三级行业、通达信研究行业板块指数指标<br>如果是880001总市值，相当于是整个A股市场的数据<br>5--市盈率TTM   整体法  算术平均<br>6--市净率MRQ   整体法  算术平均<br>7--市销率TTM   整体法  算术平均<br>8--市现率TTM   整体法  算术平均<br>9--涨跌数   上涨家数  下跌家数<br>10--板块总市值(亿元)   整体法  算术平均<br>11--板块流通市值(亿元) 整体法  算术平均<br>12--涨停数   涨停家数  曾涨停家数[注：该指标展示20160926日之后的数据]<br>13--跌停数   跌停家数  曾跌停家数[注：该指标展示20160926日之后的数据]<br>14--涨停数据  市场高度(不含ST股和未开板新股)  2板及以上涨停个数(不含ST股和未开板新股)[注：该指标展示20180319日之后的数据]<br>15--融资融券  沪深融资余额(万元)   沪深融券余额(万元)<br>16--陆股通资金流入  沪股通流入金额(亿元)  深股通流入金额(亿元) [注：该指标展示20170320日之后的数据]<br>17--开盘成交金额    开盘成交金额(万元)<br>18--板块股息率(%)   算数平均  整体法                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| BKJYONE             | 引用板块交易类数据(指定日期)     |                                       | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场.<br>BKJYONE(ID,N,Y,MMDD),ID为数据编号,N表示第几个数据(取1或2),Y和MMDD表示年和月日.<br>如果Y为0,MMDD为0,表示最新数据,MMDD为1,2,3...,表示倒数第2,3,4...个数据<br>板块交易类数据函数，数据编号如下：<br>几个主要指数(总市值等指数,上证指数,深圳成指,沪深300,创业板指,科创50,北证50)和通达信二、三级行业、通达信研究行业板块指数指标<br>如果是880001总市值，相当于是整个A股市场的数据                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| SCJYVALUE           | 引用市场交易类数据(序列)       |                                       | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场.<br>SCJYVALUE(ID,N,TYPE),ID为数据编号,N表示第几个数据(取1或2),TYPE:为1表示做平滑处理,没有数据的周期返回上一周期的值;为0表示不做平滑处理;2表示没有数据则为0<br>市场交易类数据函数，数据编号如下：<br>1--融资融券       沪深融资余额(万元) 沪深融券余额(万元)<br>2--陆股通资金流入 沪股通流入金额(亿元) 深股通流入金额(亿元)[注：沪股通限制展示2000条数据，深股通展示自20161205以后的数据]<br>3--沪深京涨停股个数 涨停股个数  曾涨停股个数 [注：该指标展示20160926日之后的数据]<br>4--沪深京跌停股个数 跌停股个数  曾跌停股个数 [注：该指标展示20160926日之后的数据]<br>5--上证50股指期货  净持仓(手)[注：该指标展示20171009日之后的数据]<br>6--沪深300股指期货 净持仓(手) [注：该指标展示20171009日之后的数据]<br>7--中证500股指期货 净持仓(手) [注：该指标展示20171009日之后的数据]<br>8--ETF基金规模份额数据 ETF基金规模(亿份) ETF净申赎(亿份)<br>9--每月新增投资者数量-日期 新增自然人数量（户）新增非自然人数量（户） <br>10--增减持统计    增持额(万元)  减持额(万元)[注：部分公司公告滞后,造成每天查看的数据可能会不一样] <br>11--大宗交易      溢价的大宗交易额(万元) 折价的大宗交易额(万元)<br>12--限售解禁      限售解禁计划额(亿元)  限售解禁股份实际上市金额(亿元)[注：该指标展示201802月之后的数据;部分股票的解禁日期延后，造成不同日期提取的某天的计划额可能不同]<br>13--分红    市场总分红额(亿元)[注：除权派息日的A股市场总分红额] <br>14--募资    市场总募资额(亿元)[注：发行日期/除权日期的首发、配股和增发的总募资额] <br>15--打板资金    封板成功资金(亿元) 封板失败资金(亿元) [注：该指标展示20160926日之后的数据]<br>16--龙虎榜    买入总金额(亿元) 卖出总金额(亿元)<br>17--龙虎榜机构数据    买入金额(亿元) 卖出金额(亿元) <br>18--龙虎榜营业部数据    买入金额(亿元) 卖出金额(亿元) <br>19--龙虎榜沪深股通数据    买入金额(亿元) 卖出金额(亿元)<br>20--陆股通净买入    沪股通净买入额(亿元) 深股通净买入额(亿元)<br>21--每周无限售质押率    深市质押率(%) 沪市质押率(%)[注：该指标展示20180128日之后的数据]<br>22--每周有限售质押率    深市质押率(%) 沪市质押率(%)[注：该指标展示20180128日之后的数据]<br>23--连板家数    连板股个数(包含ST和未开板新股)  连板股个数(不含ST股和未开板新股）[注：该指标展示20180319日之后的数据]<br>24--沪深京涨跌停股个数    涨停股个数(不含ST股和未开板新股) 跌停股个数（不含ST股）[注：该指标展示20160926日之后的数据]<br>25--融资融券    沪深融资买入额（万元）沪深融券卖出量（万股）<br>26--每周市场质押比     每周市场质押比例（%）[注：该指标展示20180316日之后的数据]<br>27--央行公开市场净投放    央行公开市场净投放 (亿元) <br>28--历史A股新高新低数  历史新高A股股票个数 历史新低A股股票个数(上市满一年的股票)<br>29--120天A股新高新低数 120天新高A股股票个数 120天新低A股股票个数(上市满一年的股票)<br>30--涨停数据  市场高度(不含ST股和未开板新股)  2板以上涨停个数(不含ST股和未开板新股)[注：该指标展示20180319日之后的数据]<br>31--涨跌家数   涨家数（剔除停牌）  跌家数（剔除停牌）<br>32--20天A股新高新低数 20天新高A股股票个数 20天新低A股股票个数(上市满一年的股票)<br>33--市场总封单金额  涨停封单金额（亿元）跌停封单金额（亿元）[注：该指标展示20160926日之后的数据]<br>34--涨跌股成交量    上涨股成交量(万手)  下跌股成交量(万手) <br>35--涨停数据   换手板家数  回封率(%)  [注：两个指标都剔除了未开板新股，换手板家数展示20190605日之后的数据，回封率展示20180927日之后的数据]<br>36--曾涨跌停股个数	曾涨停股个数(剔除ST股和未开板新股)	曾跌停股个数(剔除ST股) [注：该指标展示20160926日之后的数据]<br>37--转融券  融出市值(亿元)  期末余额(亿元)<br>38--ETF基金规模金额数据  ETF基金规模(亿元)  ETF净申赎(亿元)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| SCJYONE             | 引用市场交易类数据(指定日期)     |                                       | 如果指标支持云数据函数(用于选股除外),则不需要[专业财务数据]下载,该函数只适用于沪深京市场.<br>SCJYONE(ID,N,Y,MMDD),ID为数据编号,N表示第几个数据(取1或2),Y和MMDD表示年和月日.<br>如果Y为0,MMDD为0,表示最新数据,MMDD为1,2,3...,表示倒数第2,3,4...个数据                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| GPONEDAT            | 股票的单个数据(非序列)        |                                       | GPONEDAT(ID),ID为数据编号<br>数据编号如下：<br>1--发行价(元)<br>2--总发行数量(万股)<br>3--一致预期目标价(元)[注：一致预期值均为近半年内各家机构预测数值的平均值]<br>4--一致预期T年度<br>5--一致预期T年每股收益<br>6--一致预期T+1年每股收益<br>7--一致预期T+2年每股收益<br>8--一致预期T年净利润(万元)<br>9--一致预期T+1年净利润(万元)<br>10--一致预期T+2年净利润(万元)<br>11--一致预期T年营业收入(万元)<br>12--一致预期T+1年营业收入(万元)<br>13--一致预期T+2年营业收入(万元)<br>14--一致预期T年营业利润(万元)<br>15--一致预期T+1年营业利润(万元)<br>16--一致预期T+2年营业利润(万元)<br>17--一致预期T年每股净资产(元)<br>18--一致预期T+1年每股净资产(元)<br>19--一致预期T+2年每股净资产(元)<br>20--一致预期T年净资产收益率(%)<br>21--一致预期T+1年净资产收益率(%)<br>22--一致预期T+2年净资产收益率(%)<br>23--一致预期T年PE<br>24--一致预期T+1年PE<br>25--一致预期T+2年PE<br>26--最新解禁日(YYMMDD格式)<br>27--最新解禁数量（万股）<br>28--下一报告期的预约披露时间<br>29--最新持股机构家数<br>30--最新机构持股总量（万股）<br>31--最新持股基金家数<br>32--最新基金持股量（万股）<br>33--最新总股本（万股）<br>34--最新实际流通A股（万股）<br>35--最新业绩预告  报告期(YYMMDD格式)<br>36--最新业绩预告  本期归母净利润下限（万元）<br>37--最新业绩预告  本期归母净利润上限（万元）<br>38--最新业绩预告  本期归母净利润预计同比增减幅下限%<br>39--最新业绩预告  本期归母净利润预计同比增减幅上限%<br>40--最新业绩快报  报告期<br>41--最新业绩快报  归母净利润（万元）<br>42--分红募资  派现总额（万元）<br>43--分红募资  募资总额（万元）<br>44--最新业绩预告  本期扣非净利润下限(万元)<br>45--最新业绩预告  本期扣非净利润上限(万元)<br>46--最新业绩预告  本期扣非净利润预计同比增减幅下限%<br>47--最新业绩预告  本期扣非净利润预计同比增减幅上限%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
### 4.15 即时行情函数
| <center>名称</center> | <center>含义</center> | <center>用法</center>                                                                                                                        |
| ------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| DYNAINFO(3)         | 昨收盘价                |                                                                                                                                            |
| DYNAINFO(4)         | 开盘价                 |                                                                                                                                            |
| DYNAINFO(5)         | 最高价                 |                                                                                                                                            |
| DYNAINFO(6)         | 最低价                 |                                                                                                                                            |
| DYNAINFO(7)         | 现价                  |                                                                                                                                            |
| DYNAINFO(8)         | 总量                  |                                                                                                                                            |
| DYNAINFO(9)         | 现量                  |                                                                                                                                            |
| DYNAINFO(10)        | 总金额                 |                                                                                                                                            |
| DYNAINFO(11)        | 均价                  |                                                                                                                                            |
| DYNAINFO(12)        | 日涨跌                 |                                                                                                                                            |
| DYNAINFO(13)        | 振幅                  |                                                                                                                                            |
| DYNAINFO(14)        | 涨幅                  |                                                                                                                                            |
| DYNAINFO(15)        | 开盘金额                |                                                                                                                                            |
| DYNAINFO(16)        | 前5日每分钟均量            |                                                                                                                                            |
| DYNAINFO(17)        | 量比                  |                                                                                                                                            |
| DYNAINFO(18)        | 上涨家数                |                                                                                                                                            |
| DYNAINFO(19)        | 下跌家数                |                                                                                                                                            |
| DYNAINFO(20)        | 买价(即买一价)            |                                                                                                                                            |
| DYNAINFO(21)        | 卖价(即卖一价)            |                                                                                                                                            |
| DYNAINFO(22)        | 内盘/板块指数跌停数          |                                                                                                                                            |
| DYNAINFO(23)        | 外盘/板块指数涨停数          |                                                                                                                                            |
| DYNAINFO(24)        | 涨速                  |                                                                                                                                            |
| DYNAINFO(25)        | 几分钟前的价格             |                                                                                                                                            |
| DYNAINFO(26)        | 涨停价                 |                                                                                                                                            |
| DYNAINFO(27)        | 跌停价                 |                                                                                                                                            |
| DYNAINFO(28)        | 笼子买入价上限             |                                                                                                                                            |
| DYNAINFO(29)        | 笼子卖出价下限             |                                                                                                                                            |
| DYNAINFO(30)        | 上个交易日的开盘成交量(手)      |                                                                                                                                            |
| DYNAINFO(31)        | 竞价涨停委买金额            |                                                                                                                                            |
| DYNAINFO(34)        | 昨日涨幅                |                                                                                                                                            |
| DYNAINFO(35)        | 3日换手Z               |                                                                                                                                            |
| DYNAINFO(36)        | 换手率Z                |                                                                                                                                            |
| DYNAINFO(37)        | 换手率                 |                                                                                                                                            |
| DYNAINFO(38)        | 市盈(静)               |                                                                                                                                            |
| DYNAINFO(39)        | 市盈(动)               |                                                                                                                                            |
| DYNAINFO(40)        | 市盈(TTM)             |                                                                                                                                            |
| DYNAINFO(49)        | 成交方向                |                                                                                                                                            |
| DYNAINFO(50)        | 采样点数(分笔数)           |                                                                                                                                            |
| DYNAINFO(51)        | 内外比                 |                                                                                                                                            |
| DYNAINFO(52)        | 港股资金流向              |                                                                                                                                            |
| DYNAINFO(53)        | 应计利息/昨净值            |                                                                                                                                            |
| DYNAINFO(54)        | TOPV                |                                                                                                                                            |
| DYNAINFO(55)        | 基金估算涨幅%             |                                                                                                                                            |
| DYNAINFO(57)        | 笔涨跌                 |                                                                                                                                            |
| DYNAINFO(58)        | 买量(即买一量)            |                                                                                                                                            |
| DYNAINFO(59)        | 卖量(即卖一量)            |                                                                                                                                            |
| DYNAINFO(60)        | 沪深总上涨家数             |                                                                                                                                            |
| DYNAINFO(61)        | 沪深总下跌家数             |                                                                                                                                            |
| DYNAINFO(62)        | 沪深总成交金额             |                                                                                                                                            |
| DYNAINFO(63)        | 3日涨幅                |                                                                                                                                            |
| DYNAINFO(64)        | 5日涨幅                |                                                                                                                                            |
| DYNAINFO(65)        | 10日涨幅               |                                                                                                                                            |
| DYNAINFO(66)        | 20日涨幅               |                                                                                                                                            |
| DYNAINFO(67)        | 60日涨幅               |                                                                                                                                            |
| DYNAINFO(68)        | 年初至今涨幅              |                                                                                                                                            |
| DYNAINFO(71)        | 买二价                 |                                                                                                                                            |
| DYNAINFO(72)        | 买二量                 |                                                                                                                                            |
| DYNAINFO(73)        | 卖二价                 |                                                                                                                                            |
| DYNAINFO(74)        | 卖二量                 |                                                                                                                                            |
| DYNAINFO(75)        | 买三价                 |                                                                                                                                            |
| DYNAINFO(76)        | 买三量                 |                                                                                                                                            |
| DYNAINFO(77)        | 卖三价                 |                                                                                                                                            |
| DYNAINFO(78)        | 卖三量                 |                                                                                                                                            |
| DYNAINFO(79)        | 买四价                 |                                                                                                                                            |
| DYNAINFO(80)        | 买四量                 |                                                                                                                                            |
| DYNAINFO(81)        | 卖四价                 |                                                                                                                                            |
| DYNAINFO(82)        | 卖四量                 |                                                                                                                                            |
| DYNAINFO(83)        | 买五价                 |                                                                                                                                            |
| DYNAINFO(84)        | 买五量                 |                                                                                                                                            |
| DYNAINFO(85)        | 卖五价                 |                                                                                                                                            |
| DYNAINFO(86)        | 卖五量                 |                                                                                                                                            |
| DYNAINFO(88)        | 封单额                 |                                                                                                                                            |
| DYNAINFO(89)        | 年涨停天数               |                                                                                                                                            |
| DYNAINFO(90)        | 连板天数                |                                                                                                                                            |
| DYNAINFO(91)        | 几天                  |                                                                                                                                            |
| DYNAINFO(92)        | 几板                  |                                                                                                                                            |
| DYNAINFO(93)        | 昨日成交额               |                                                                                                                                            |
| DYNAINFO(94)        | 最近3日成交额             |                                                                                                                                            |
| DYNAINFO(95)        | 昨封单额                | 若为负值,表示昨日为跌停状态                                                                                                                             |
| DYNAINFO(96)        | 前封单额                | 若为负值,表示昨日为跌停状态                                                                                                                             |
| DYNAINFO(99)        | 主买净额                | 按主动性口径统计的净流入额(对沪深有效).报价界面行情数据                                                                                                              |
| DYNAINFO(100)       | 主力净额                | 按主力口径统计的净流入额(对沪深有效).报价界面行情数据                                                                                                               |
| DYNAINFO(101)       | 量涨速                 | 周期由涨速周期决定,一般为5分钟.报价界面行情数据                                                                                                                  |
| DYNAINFO(102)       | 分钟换手率               | 周期由涨速周期决定,一般为5分钟.报价界面行情数据                                                                                                                  |
| DYNAINFO(103)       | 2分钟金额               | 报价界面行情数据                                                                                                                                   |
| DYNAINFO(104)       | 开盘抢筹                | 开盘抢筹幅度(对沪深京有效).报价界面行情数据                                                                                                                    |
| DYNAINFO(105)       | 委比                  | 报价界面行情数据                                                                                                                                   |
| DYNAINFO(106)       | 总委买量                | 当前总委买量(对沪深有效).Level2报价界面行情数据                                                                                                               |
| DYNAINFO(107)       | 总委卖量                | 当前总委卖量(对沪深有效).Level2报价界面行情数据                                                                                                               |
| DYNAINFO(108)       | 总撤买量                | 当前总撤买量(对沪深有效).Level2报价界面行情数据                                                                                                               |
| DYNAINFO(109)       | 总撤卖量                | 当前总撤卖量(对沪深有效).Level2报价界面行情数据                                                                                                               |
| DYNAINFO(110)       | L2逐笔成交数             | L2逐笔成交数(对沪深有效).Level2报价界面行情数据                                                                                                              |
| DYNAINFO(111)       | L2逐笔委托数             | L2逐笔委托数(对沪深有效).Level2报价界面行情数据                                                                                                              |
| DYNAINFO(117)       | 量比                  | 序列数据                                                                                                                                       |
| MAINZSHQ            | 主要指数行情              | MAINZSHQ(M,N)<br>M:0:当前品种所属指数 1:上证指数 2:深圳成指 3:创业板指 4:科创50指数 5:北证50指数 N:0现价 1:昨收 2:今开 3:最高 4:最低 5:成交额 6:上涨家数 7:下跌家数 8:涨幅 9:3日涨幅             |
| TOTALMMPAMO         | 沪深京买卖盘金额            | TOTALMMPAMO(N)<br>N:1:买一总金额 2:卖一总金额 3:前5档或前10档(Level2时)的买盘总金额 4:前5档或前10档(Level2时)的卖盘总金额 5:总委买金额(Level2时) 6:总委卖金额(Level2时) <br>单位为亿元,即时行情数据 |
| ISBUYORDER          | 主动性买单               |                                                                                                                                            |
| BETAVALUE           | 贝塔系数                |                                                                                                                                            |
| SHAPE_SHORT         | 短期形态值               |                                                                                                                                            |
| SHAPE_MID           | 中期形态值               |                                                                                                                                            |
| SHAPE_LONG          | 长期形态值               |                                                                                                                                            |
| SELLVOL             | 内盘                  |                                                                                                                                            |
| BUYVOL              | 外盘                  |                                                                                                                                            |
### 4.16 线形和资源等
| <center>名称</center> | <center>含义</center> | <center>用法</center>                                                                                                                      |
| ------------------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| COLOR               | 自定义色                | 格式为COLOR+"RRGGBB":RR、GG、BB表示红色、绿色和蓝色的分量,每种颜色的取值范围是00-FF,采用了16进制.<br>例如:MA5:MA(CLOSE,5),COLOR00FFFF表示纯红色与纯绿色的混合色:COLOR808000表示淡蓝色和淡绿色的混合色 |
| COLORBLACK          | 画黑色                 |                                                                                                                                          |
| COLORBLUE           | 画蓝色                 |                                                                                                                                          |
| COLORGREEN          | 画绿色                 |                                                                                                                                          |
| COLORCYAN           | 画青色                 |                                                                                                                                          |
| COLORRED            | 画红色                 |                                                                                                                                          |
| COLORMAGENTA        | 画洋红色                |                                                                                                                                          |
| COLORBROWN          | 画棕色                 |                                                                                                                                          |
| COLORLIGRAY         | 画淡灰色                |                                                                                                                                          |
| COLORGRAY           | 画深灰色                |                                                                                                                                          |
| COLORLIBLUE         | 画淡蓝色                |                                                                                                                                          |
| COLORLIGREEN        | 画淡绿色                |                                                                                                                                          |
| COLORLICYAN         | 画淡青色                |                                                                                                                                          |
| COLORLIRED          | 画淡红色                |                                                                                                                                          |
| COLORLIMAGENTA      | 画淡洋红色               |                                                                                                                                          |
| COLORYELLOW         | 画黄色                 |                                                                                                                                          |
| COLORWHITE          | 画白色                 |                                                                                                                                          |
| LINETHICK           | 线型粗细                | "LINETHICK+(1-9)"参数的取值范围在1—9之间,"LINETHICK1"表示最细的线,而"LINETHICK9"表示最粗的线                                                                    |
| STICK               | 画柱状线                |                                                                                                                                          |
| COLORSTICK          | 画彩色柱状线              |                                                                                                                                          |
| VOLSTICK            | 画彩色柱状线              | 成交量柱状线,当股价上涨时显示红色空心柱,则显示绿色实心柱                                                                                                            |
| LINESTICK           | 同时画出柱状线和指标线         |                                                                                                                                          |
| CROSSDOT            | 画小叉线                |                                                                                                                                          |
| CIRCLEDOT           | 画小圆圈线               |                                                                                                                                          |
| POINTDOT            | 画小圆点线               |                                                                                                                                          |
| DOTLINE             | 虚线                  |                                                                                                                                          |
| NODRAW              | 空线条                 |                                                                                                                                          |
| PLAYSOUND1          | 播放1号                | 声音和动画在[插入资源]中设置<br>最后一个数据满足条件后播放(只播放一次)                                                                                                  |
| PLAYSOUND2          | 播放2号                | 声音和动画在[插入资源]中设置<br>最后一个数据满足条件后播放(只播放一次)                                                                                                  |
| PLAYSOUND20         | 播放20号               | 声音和动画在[插入资源]中设置<br>最后一个数据满足条件后播放(只播放一次)                                                                                                  |
| NOTEXT              | 不显示输出线数据            | 输出线名称前带有NOTEXT字样时,不显示输出线数据                                                                                                               |
| ??MOVE?             | 指标线向后偏移N个单位         | 输出线名称中带有MOVE字段时,比如TMPMOVE3,表示整个输出线向后偏移3个单位,画线进入未来时间,N不应超过4                                                                               |
| ??MOVER?            | 指标线向前偏移N个单位         | 输出线名称中带有MOVE字段时,比如TMPMOVER3,表示整个输出线向前偏移3个单位                                                                                              |
### 4.17 交易信号函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                                                                                                                                         |
| ------------------- | ------------------- | ------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ORDERBUY            | 委托买入                |                                       | ORDERBUY(condition,volumetype,volume,pricetype,price).<br>此函数只适用于服务器端特定版本的策略交易模式下                                                                           |
| ORDERSELL           | 委托卖出                |                                       | ORDERSELL(condition,volumetype,volume,pricetype,price).<br>此函数只适用于服务器端特定版本的策略交易模式下                                                                          |
| CANSELLGP           | 可卖数量                |                                       | 此函数只适用于服务器端特定版本的策略交易模式下                                                                                                                                     |
| CANUSEMONEY         | 可用资金                |                                       | 此函数只适用于服务器端特定版本的策略交易模式下                                                                                                                                     |
| BUY                 | 买入开仓                | 多头建仓(买入开仓)                            | BUY(CROSS(A,B),LOW),当A上穿B时,在LOW处画标记,同时突出提示或直接下单,如果LOW改为DRAWNULL,就不画标记.(分时图上不支持<br>参数1为触发条件,参数2为标记放置位置.此函数只适用于特定版本交易模式下                                      |
| SELL                | 卖出平仓                | 多头平仓(卖出平仓)                            | SELL(CROSS(A,B),HIGH),当A上穿B时,在HIGH处画标记,同时突出提示或直接下单,如果HIGH改为DRAWNULL,就不画标记.(分时图上不支持)<br>参数1为触发条件,参数2为标记放置位置.此函数只适用于特定版本交易模式下                                 |
| SELLSHORT           | 卖出开仓                | 空头建仓(卖出开仓)                            | SELLSHORT(CROSS(A,B),HIGH),当A上穿B时,在HIGH处画标记,同时突出提示或直接下单,如果HIGH改为DRAWNULL,就不画标记.(分时图上不支持)<br>参数1为触发条件,参数2为标记放置位置.此函数只适用于特定版本交易模式下                            |
| BUYSHORT            | 买入平仓                | 空头平仓(买入平仓)                            | BUYSHORT(CROSS(A,B),LOW),当A上穿B时,在LOW处画标记,同时突出提示或直接下单,如果LOW改为DRAWNULL,就不画标记.(分时图上不支持)<br>参数1为触发条件,参数2为标记放置位置.此函数只适用于特定版本交易模式下                                |
| BUYSHORT_BUY        | 先平空仓再开多仓            | 先平空仓再开多仓                              | BUYSHORT_BUY(CROSS(A,B),LOW),当A上穿B时,在LOW处画标记,同时突出提示或直接下单,如果LOW改为DRAWNULL,就不画标记.(分时图上不支持)<br>独立池时,反手时平掉所有的原来仓位<br>参数1为触发条件,参数2为标记放置位置.此函数只适用于特定版本交易模式下       |
| SELL_SELLSHORT      | 先平多仓再开空仓            | 先平多仓再开空仓                              | SELL_SELLSHORT(CROSS(A,B),HIGH),当A上穿B时,在HIGH处画标记,同时突出提示或直接下单,如果HIGH改为DRAWNULL,就不画标记.(分时图上不支持).<br>独立池时,反手时平掉所有的原来仓位<br>参数1为触发条件,参数2为标记放置位置.此函数只适用于特定版本交易模式下 |
| CLOSEALLD           | 清多头仓                | 平掉所有多头仓位                              | CLOSEALLD(CROSS(A,B),HIGH),当A上穿B时,在HIGH处画标记,同时突出提示或直接下单,如果HIGH改为DRAWNULL,就不画标记.(分时图上不支持)<br>平掉所有多头仓位                                                        |
| CLOSEALLK           | 清空头仓                | 平掉所有空头仓位                              | CLOSEALLK(CROSS(A,B),LOW),当A上穿B时,在LOW处画标记,同时突出提示或直接下单,如果LOW改为DRAWNULL,就不画标记.(分时图上不支持)<br>参数1为触发条件,参数2为标记放置位置.此函数只适用于特定版本交易模式下                               |
| AUTOFILTER          | 自动过滤交易信号            |                                       | 对交易信号按照开平配对原则过滤.<br>1.连续的同方向指令只有第一个有效,其他的将被过滤;<br>2.交易信号必须配对出现(比如前面已经有了买开指令,则后面只允许出现卖平指令,其他的指令都被过滤掉).<br>注:使用AUTOFILTER后,就不要再使用其它的信号过滤方式了.此函数只适用于特定版本交易模式下  |
| ISLASTBUY           | 上个信号是否买入开仓          |                                       | 此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                                    |
| ISLASTSELL          | 上个信号是否卖出平仓          |                                       | 此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                                    |
| ISLASTSELLSHORT     | 上个信号是否卖出开仓          |                                       | 此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                                    |
| ISLASTBUYSHORT      | 上个信号是否买入平仓          |                                       | 此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                                    |
| LASTSIGNAL          | 上一次的信号类型            |                                       | 上一次的信号类型<br>1:买入开仓2:卖出平仓3:卖出开仓4:买入平仓7:清多头仓8:清空头仓<br>此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                |
| BUYPRICE            | 买入开仓信号时的价格          |                                       | 此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                                    |
| BUYBARS             | 买入开仓信号距离当前K线数       |                                       | 此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                                    |
| SELLSHORTPRICE      | 出开仓信号时的价格           |                                       | 当时数据品种的K线的收盘价<br>此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                   |
| SELLSHORTBARS       | 卖出开仓信号距离当前k线数       |                                       | 此函数只适用于特定版本交易模式下.(此函数会逐K线计算,请勿与未来函数同时使用)                                                                                                                    |
### 4.18 账户函数
| <center>名称</center> | <center>含义</center> | <center>返回值</center><center></center> | <center>用法</center>                   |
| ------------------- | ------------------- | ------------------------------------- | ------------------------------------- |
| BUYPOSITION         | 买持仓                 | 买持仓的数量(期货),针对当前品种                     | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| TODAYBUY            | 今买持仓                | 今日买入持仓的数量(期货),针对当前品种                  | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| BUYAVGPRICE         | 买均价                 | 买持仓的持仓均价(期货),针对当前品种                   | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| BUYPROFITLOSS       | 买持仓盈利               | 买持仓的浮动盈亏(期货),针对当前品种                   | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| SELLPOSITION        | 卖持仓                 | 卖持仓的数量(期货),针对当前品种                     | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| TODAYSELL           | 今卖持仓                | 今日卖出持仓的数量(期货),针对当前品种                  | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| SELLAVGPRICE        | 卖均价                 | 卖持仓的持仓均价(期货),针对当前品种                   | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| SELLPROFITLOSS      | 卖持仓盈利               | 卖持仓的浮动盈亏(期货),针对当前品种                   | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| TOTALPOSITION       | 总持仓                 | 总持仓,针对当前品种                            | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| CANUSEPOSITION      | 总可用持仓               | 总可用的持仓,针对当前品种                         | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| TOTALAVGPRICE       | 总持仓均价               | 总持仓均价,针对当前品种                          | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| FREEMONEY           | 总可用资金量              | 总可用资金量,针对当前交易帐户                       | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| CURRENTEQUITY       | 动态权益                | 动态权益(期货),针对当前交易帐户                     | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| PREVIOUSEQUTTY      | 昨日结存权益              | 昨日结存的权益(期货),针对当前交易帐户                  | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| PROFITLOSS          | 持仓盈利                | 持仓盈亏(期货),针对当前交易帐户的当前品种                | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| CLOSEPROFIT         | 平仓盈利                | 平仓盈亏(期货),针对当前交易帐户的当前品种                | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| TOTALMARGIN         | 持仓保证金               | 持仓保证金(期货),针对当前交易帐户                    | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| FEERATE             | 合约手续费               | 合约手续费比例(百分比),(具体交易策略中设置)              | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
| MARGINRATE          | 合约保证金               | 合约保证金比例(百分比),(具体交易策略中设置)              | (两种情况下支持:1.本地策略交易时,2.程序交易评测时配合交易函数使用) |
### 4.19 操作符

| <center>名称</center> | <center>含义</center> | <center>用法</center>                                                                                                                                                                                                                 |
| ------------------- | ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| +                   | 加                   |                                                                                                                                                                                                                                     |
| -                   | 减                   |                                                                                                                                                                                                                                     |
| *                   | 乘                   |                                                                                                                                                                                                                                     |
| /                   | 除                   |                                                                                                                                                                                                                                     |
| <                   | 小于                  |                                                                                                                                                                                                                                     |
| >                   | 大于                  |                                                                                                                                                                                                                                     |
| <=                  | 小于等于                |                                                                                                                                                                                                                                     |
| >=                  | 大于等于                |                                                                                                                                                                                                                                     |
| ==                  | 等于                  |                                                                                                                                                                                                                                     |
| !=                  | 不等于                 |                                                                                                                                                                                                                                     |
| <>                  | 不等于                 |                                                                                                                                                                                                                                     |
| {}                  | 注释                  | {注释部分},注:注释中不能再加注释                                                                                                                                                                                                                  |
| AND                 | 并且                  |                                                                                                                                                                                                                                     |
| &&                  | 并且                  |                                                                                                                                                                                                                                     |
| OR                  | 或者                  |                                                                                                                                                                                                                                     |
| \|\|                | 或者                  |                                                                                                                                                                                                                                     |
| $                   | 引用特定数据              | `"000014$CLOSE"`,表示取000014的收盘价,注意加入双引号.<br>可在前面加SZ(深市),SH(沪市),BJ(京市),或市场_,支持引用指标输出线,比如`KDJ.K`、<br>`"SZ000001$CLOSE"`表示平安银行,<br>`"47_IFL8$CLOSE"`表示沪深主力合约,<br>`"SH688318$MACD.DIF"`表示取财富趋势的MACD指标的DIF输出,<br>注意:引用品种的对应周期的数据必须要先下载到本地 |
| ()                  | 括号                  |                                                                                                                                                                                                                                     |
| ,                   | 逗号                  |                                                                                                                                                                                                                                     |
| :                   | 输出                  |                                                                                                                                                                                                                                     |
| :=                  | 赋值                  |                                                                                                                                                                                                                                     |
| “”                  | 双引号                 |                                                                                                                                                                                                                                     |
| .                   | 引用指标输出              |                                                                                                                                                                                                                                     |
| ;                   | 分号                  |                                                                                                                                                                                                                                     |
| #                   | 跨周期引用符              |                                                                                                                                                                                                                                     |
| MIN1                | 引用1分钟线              | 跨周期1分钟线引用                                                                                                                                                                                                                           |
| MIN5                | 引用5分钟线              | 跨周期5分钟线引用                                                                                                                                                                                                                           |
| MIN15               | 引用15分钟线             | 跨周期15分钟线引用                                                                                                                                                                                                                          |
| MIN30               | 引用30分钟线             | 跨周期30分钟线引用                                                                                                                                                                                                                          |
| MIN60               | 引用60分钟线             | 跨周期60分钟线引用                                                                                                                                                                                                                          |
| WEEK                | 引用周线                | 跨周期周线引用,注:DAY,MONTH,YEAR等也支持引用                                                                                                                                                                                                      |
| SEASON              | 引用季线                | 跨周期季线引用,注:DAY,MONTH,YEAR等也支持引用                                                                                                                                                                                                      |
| CLOUDREF.T?         | 云端引用子公式             | 云端运行时引用子公式的情形,比如CLOUDREF.T1#WEEK(9,3,3),编写的子公式名必须是CLOUDREF,参数名为N1,N2...N16(最多16个参数),输出线名为T1,T2...T16(最多16个输出,引用时不带参数值)                                                                                                              |
# 公式系统(中级)
## 1. 基本公式编写实例
本章主要介绍一些基础的公式编写的表达方法、方式,例如上面所列出来的放量、上涨等等,这些都是在公式编写过程当中要用到的基本形态特征,许多的技术指标的选股条件都是由它们组成的.
### 1.1 放量
1、今日比昨日的成交量放大了1倍:
VOL/REF(VOL,1)>2;
2、今日的五日均量比五天前的五日均量放大了3倍:
AA:=MA(VOL,5);
BB:=REF(AA,5);
AA/BB>4;
3、今天的成交量达到了整个流通盘的10%以上:
VOL/CAPITAL>10/100;
(注意,10%的表达式是10/100,或者0.1)
### 1.2 缩量
1、今日比昨日的成交量缩小了1倍:
VOL/REF(VOL,1)<0.5;
2、今日的五日均量比五天前的五日均量缩小了一半:
AA:=MA(VOL,5);
BB:=REF(AA,5);
AA/BB<0.5;
3、今天的成交量不足整个流通盘的0.5%:
VOL/CAPITAL<0.5/100;
### 1.3 上涨
1、今日涨幅达到了7%以上:
CLOSE/REF(CLOSE,1)>1.07;
2、十日均价继续上涨:
AA:=MA(CLOSE,10);
BB:=REE(AA,1);
AA>BB;
### 1.4 下跌
收阳、收阴:
1、当天收阳:CLOSE>OPEN;
2、当天收阴:CLOSE<OPEN;
### 1.5 高开、低开
1、当天股价高开,即开盘高于昨日收盘:OPEN>REF(CLOSE,1);
2、当天股价低开:OPEN<REF(CLOSE,1);
### 1.6 跳空
跳空亦有向上和向下两种:
当日开盘在昨日最高之上,即为向上跳空:OPEN>REF(HIGH,1);
反之,开盘小于昨日的最高价,为向下跳空:OPEN<REF(LOW,1);
### 1.7 放量上攻
AA:=VOL/REF(VOL,1)>2;{成交量是昨日的两倍}
BB:=CLOSE/REF(CLOSE,1)>1.07;{涨幅大于7%}
AA AND BB;
### 1.8 高开高走
AA:=VOL/REF(VOL,1)>2;{成交量是昨日的两倍}
BB:=CLOSE/REF(CLOSE,1)>1.07;{涨幅大于7%}
AA AND BB;
### 1.9 创新高
创新高指当日最高价是最近一段时间的最高价:
HIGH=HHV(HIGH,N);
其中的HIGH为当期最高价,HHV(X,N)是求N周期内X最高值.因此该公式的含义是当日最高价创Ｎ日新高时返回值为１,否则为0
### 1.10 横盘整理
横盘整理指最近一段时期价格在一定幅度之内摆动:
(HHV(CLOSE,10)-LLV(CLOSE,10))/CLOSE<0.05;
其中的LLV(X,N)是求N周期内X最低值.因此该公式表示10日收盘价振幅振幅在5%以内.
## 2. 公式组合实例
下面介绍如何对基本公式进行组合,描述一些简单的K线形态.在编写公示前,需要准确对K线形态进行定义.
### 2.1 向上跳空之后两天内并未回补
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)
**定义**:实际上就是昨天发生了跳空缺口,这两天的最低价一直在两天前的最高价之上.
AA:=REF(OPEN,1)>REF(HIGH,2);
BB:=REF(LOW,1)>REF(HIGH,2);
CC:=LOW>REF(HIGH,2);
AA AND BB AND CC;
仔细一想,若BB成立,AA一定成立,AA实际上没有存在的必要.
更简单的方法,下面的一句话可以的上面的四句:
COUNT(LOW>REF(HIGH,2),2)=2;
### 2.2 5日,10日,30日均线多头排列
**![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)**
**定义**:均线多头排列,是指从短周期到长周期均线,从上而下的依次排列
AA:=MA(CLOSE,5);
BB:=MA(CLOSE,10);
CC:=MA(CLOSE,30);
T1:AA>BBANDBB>CC;
以上情况维持一段时间,假设我们这里定为4天以上:
COUNT(T1,4)=4;
COUNT(X,N)表示统计在N天内满足条件X的有几天.
最终的结果就是如下所示:
AA:=MA(CLOSE,5);
BB:=MA(CLOSE,10);
CC:=MA(CLOSE,30);
T1:=AA>BBANDBB>CC;
COUNT(T1,4)=4;
### 2.3 逃顶K线形态之--黄昏之星![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image005.png)
**定义**:当市场出现一条大阳线后,通常会产生跳空高开的情况,有时便会出现十字星或类似十字星的小阴线(小阳线),当该形态出现在一段上升行情的当中,就很容易形成经典K线形态--黄昏之星.
为了结构简单起见,首先将二天的高开低收用中间表达式表达出来,因为我们在后面的编写过程中会分别使用到这些数据.
1、今日K线的:
开-a1,a1:=open；
收-a2,a2:=close；
高-a3,a3:=high；
2、昨天K线的:
开-b1,b1:=ref(open,1)；
收-b2,b2:=ref(close,1)；
高-b3,b3:=ref(high,1)；
低-b4,b4:=ref(low,1)；
3、前天K线的:
开-c1,c1:=ref(open,2)；
收-c2,c2:=ref(close,2)；
高-c3,c3:=ref(high,2)；
低-c4,c4:=ref(low,2)；
4、我们将会分别描述出三天的K线形态,然后汇总,首先我们观察今日K线的特征,今天
是一根低开低走的大阴线,我们给它一些数字上的定义:a、今日开盘价小于昨日收盘价:aa:=a1＜b2and
b、今日的阴线实体较长,我们用开盘价和收盘价相比,长度大于4%:a1/a2＞1.04；
5、昨日K线的特征,是一根十字形态的K线,并且在左右两根K线之上,分别表达为:a、昨日跳开,高于前天的收盘:bb:=b1＞c3
b、昨日收盘同样在缺口之上:andb2＞c3
c、线形实体长度很小,也就是昨日开盘和收盘之差比昨日开盘的值小于0.01:
andabs(b1-b2)/b1＜0.01
d、K线有上下影线,可以表示为最高价和最低价不等于收盘价也不等于开盘价:
andb3＞b1andb3＞b2andb4＜b1andb4＜b2
e、当日的最高价为20天以来的最高价:andb3=hhv(high,20)；
6、前日K线的特征:股价大幅上扬,幅度较前一日收盘高出4%并且收盘大于开盘:cc:=c2/ref(close,3)＞1.04andc2＞c1；
综合选股条件:最后我们将三天的K线特征结合起来,合成一个最后的条件就是由图所示内容:aa and bb and cc
最终结果就是(可以直接加进通达信公式编辑器):
a1:=open;
a2:=close;
a3:=high;
b1:=ref(open,1);
b2:=ref(close,1);
b3:=ref(high,1);
b4:=ref(low,1);
c1:=ref(open,2);
c2:=ref(close,2);
c3:=ref(high,2);
c4:=ref(low,2);
aa:=a1<b2anda1/a2>1.04;
bb:=b1>c3andb2>c3andabs(b1-b2)/b1<0.01andb3>b1andb3>b2andb4<b1andb4<b2andb3=hhv(high,20);
cc:=c2/ref(close,3)>1.04andc2>c1;
aa and bb and cc;
如果我们想把这个选股公式改为指标公式,修改最后一个语句就可以了.
将aa and bb and cc;改为DRAWICON((AA AND BB AND CC),HIGH×1.02,2);
这时在符合条件的K线上方出现了一个绿色的向下箭头,提示卖出
### 2.4 突破底部横盘整理创新高
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)
**定义**:股价突破长期盘整区间,之后放量上攻进入主升段."长期"设定为150天；"横盘"设定股价在150日均线上下15%波动；放量；并且股价创下150天以来的历史新高.
首先用公式描述放量
a、将会使用5日均量来进行比较,成交量比昨日成交量放大两倍；
b、V1是五日均量,REF(V1,1)就是昨日的均量；
V1:=MA(VOL,5);
V2:VOL/REF(V1,1)>2;
长期横盘
a、PZ1是当天150日均价；PZ1:=MA(CLOSE,M)；
b、PZ2是150日的最高价；PZ2:=HHV(HIGH,M)；
c、PZ3是150日的最低价；PZ3:=LLV(LOW,M)；
d、PZ4是150日的最高价和150日均价的距离的百分比,PZ5刚好相反是最低价和均价的差的百分比；PZ4:=(PZ2-PZ1)/PZ1；PZ5:=(PZ1-PZ3)/PZ1；
e、设为股价在150日均线上下15%波动,也就是PZ4、PZ5都小于0.15；
PZ:=REF(PZ4,1)<0.15ANDREF(PZ5,1)<0.15;
3、今天创下历史新高,也就是今天的最高价是150天内的最高价！
TP1:HHV(HIGH,M);
TP:=HIGH=TP1;
综合三个条件的最后的逻辑判断式就是我们的最后结论:
V2ANDPZANDTP(参数M=150天)
最终结果就是:
(参数M=150天)
V1:=MA(VOL,5);
V2:=VOL/REF(V1,1)>2;
PZ1:=MA(CLOSE,M);
PZ2:=HHV(HIGH,M);
PZ3:=LLV(LOW,M);
PZ4:=(PZ2-PZ1)/PZ1;
PZ5:=(PZ1-PZ3)/PZ1;
PZ:=REF(PZ4,1)<0.15ANDREF(PZ5,1)<0.15;
TP1:HHV(HIGH,M);
TP:=HIGH=TP1;
V2ANDPZANDTP;
注意:如果源码加入到公式编辑器后显示错误,请多注意标点符号,需要将中文模式下的标点改成英文模式下的标点
## 3. 各种指标公式编辑器的详细区别
公式管理器可管理四种类型的公式:指标公式:用于指标图形的绘制.条件选股公式:用于条件选股.交易系统公式:用于专家指示及测参、测指.五彩Ｋ线公式:用于Ｋ线模式指示.这四种公式相互独立,名称可以相同,但其内容和作用不同.每种类型的公式包括四种形式:系统加密公式:用绿色图标和锁形符号显示,要进行密码确认系统公式:用绿色图标显示,可进行删改用户加密公式:用红色图标和锁形符号显示,要进行密码确认用户公式:用红色图标显示,可进行删改指标公式附加买卖逻辑判断式,得到交易系统公式；指标公式附加选股条件逻辑判断式,得到条件选股公式.指标公式附加色彩逻辑判断,得到五彩K线公式.
### 3.1 技术指标公式编辑器
技术指标公式即通常所说画线指标,此类公式的主要目的是通过对数据采取一定的运算,将输出结果直观的显现在分析图上,为投资者提供研判行情的基本依据.此类指标至少要有一条输出线,输出包括文字,图标等,本系统老版本允许最多6条的输出线,新版本可以输出50条输出线.技术指标公式编辑器实现对技术图表分析中各类技术指标和自我定义的技术分析指标的编写,并且通过TDX的分析界面形成图表、曲线,以方便和寻找有意义的技术图形和技术特征.
### 3.2 条件选股公式编辑器
也就是通常意义上解释的智能选股.但我们的目的在于建立一个完全开放、自由的选股平台,可以通过对该平台的熟练使用,借助计算机的高速和准确的检索功能寻找满足您的理解的股票形态和技术特征,如果和预警系统结合起来用,将可以在盘中实时提示符合条件的股票.条件选股公式有且仅有一个输出,这是它和技术指标不同的地方.
### 3.3 五彩K线公式编辑器
准确讲,该编辑器的功能是附属于条件选股功能之上的,我们可以通过该功能将满足条件的连续K线形态赋予颜色,区别了其它的K线.条件选股公式与五彩K线公式的区别:条件选股公式和五彩K线公式都有且仅有一个输出,其目的都是为投资者提供买入或卖出点的指示,不同之处在于:条件选股公式仅对最近数据提示买入或卖出,而五彩K线公式则对输入的所有历史数据进行提示.另外,五彩K线公式的输出是在K线图上,通过各种颜色对提示数据进行标识,条件选股公式的输出是找出符合最近条件的所有股票.
### 3.4 交易系统公式编辑器
交易系统公式是通过设定买入和卖出点(有且仅有这两个输出),由计算机进行模拟操作.以此为依据,系统一方面可以进行五彩K线公式的功能,同时提示买入和卖出；另一方面可以通过模拟操作,对指标买卖的收益、指标的最佳参数及最佳指标等各情形进行测试.交易系统是在条件选股功能上的一次大的延伸,旨在建立一套完整的交易规则体系,通过该编辑器对各个相关的交易环节,包括买入的切入、卖出、止损以及整体的交易性能检验等等作出定量的规定,帮助投资者建立一套属于自己的买卖规则和理论.
# 公式系统(高级)

## 1. 特殊公式脚本编写
要编写一个公式,必须要明确这个公式对应的理论知识.一套完整的理论知识且能在通达信的公式平台上做成公式还要满足如下要求:
1.从该理论应能分析出公式启动的起始数据.如股票的开高低收价格、成交量、各财务数据、各即时数据、时间数据、一些常见的技术分析概念、其他理论的结果等,这些数据大部分是系统提供的,而最后两项则要从其他公式中得来也就是对应于公式编写中的指标引用操作(当然在这公式编写前要确保该要引用的指标已实现).
2.从理论中应能分析出起始数据到结果的明确运算过程.在公式平台中提供了一些系统函数,这些函数包含了部分常用的运算过程(如HHV(X,N)可求N周期内X最高值).如果理论中的运算过程拆解完全后,能由公式平台中的函数及允许的基本运算全部组成就可以编写成公式了.
在之前的学习当中,我们已经对公式系统、公式脚本编辑有了基本的认识.公式系统提供给我们的基本函数、系统公式,就是我们运用公式系统编写自己的公式时的基本元素.对于一些常见的技术分析概念的编写在上一章节已经给出了介绍和示例,本章节主要来9介绍一下在公式脚本编写如果用系统函数及基本运算来解决一些特殊难题.
对公式编写有问题进行提问,可以点击客户端上方栏财富圈→论坛→公式天堂加入,或者点击公式论坛地址直接进入:
https://sns.tdx.com.cn/site/tdx_sns/page_index.html#/CircleDetail?id=12&systemType=1
### 1.1 在分钟周期下划分交易日
1.均线(分钟):
指标名称:均线(分钟)
指标原理:均价=累加自当日开市到当前K线时间内的成交金额/累加自当日开市到当前K线时间内的成交量.
编写分析:
1.确定交易日内第一根K线的位置(难点)；
2.自1中确定的位置累加成交金额、成交量(由系统函数SUM实现)；
3.由成交金额、成交量求均价(由除法操作符实现).
公式脚本:
FIRST:=IF(PERIOD=0,HOUR=9 AND MINUTE=31,
IF(PERIOD=1,HOUR=9 AND MINUTE=35,
IF(PERIOD=2,HOUR=9 AND MINUTE=45,
IF(PERIOD=3,HOUR=10 AND MINUTE=0,
IF(PERIOD=4,HOUR=10 AND MINUTE=30,0)))));
SUM(AMO,BARSLAST(FIRST)+1)/SUM(VOL,BARSLAST(FIRST)+1);
上面的公式适用于1分钟,5分钟,15分钟,30分钟,60分钟等五个周期下.将给出每个交易日中各周期下均线的走势.公式脚本编写中的重点就是First变量的确定,这也是这段脚本的亮点.First变量表示的是当日当前周期的第一根K线位置,是通过IF函数的嵌套使用结合各分钟周期的第一根K线的时间得来的.
### 1.2 跨周期引用数据
在同一个公式脚本中,所有变量的数据周期都是相同的,就是调用公式时设置的周期.在公式脚本中要用其它周期的数据,共有两种方式:
1)**对变量用变周期符号(#),改变其周期**这种方式有局限性,只能在小周期公式中得到大周期数据,且仅适用于一些基本数据,如close,high,low,open等.
示例脚本:
日最高价:H;
周最高价:H#WEEK;
运行示例:
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)
2)**在公式脚本中调用其它公式以取得其它周期的数据**.调用其它公式,并用#设置其周期.
比如,公式脚本在日线下运行时,可用Kdj.k#week;来获得kdj在周线下的k值,另属于于同一周线的日线将获得相同的K值.
示例脚本:
公式1:
公式名称:JBSJ
公式描述:基本数据
公式脚本:
JC:C;{当前周期收盘价}
JH:H;{当前周期最高价}
JL:L;{当前周期最低价}
JO:O;{当前周期开盘价}
JYC:REF(C,1);{前一个周期收盘价}
公式2:
公式名称:TEST049
公式脚本:
日线开盘价:JBSJ.JO#DAY;
周线开盘价:O;
月线开盘价:JBSJ.JO#MONTH;
运行示例:
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)
公式3:
E:=CURRBARSCOUNT;
E1:=DAY!=REF(DAY,1);
E2:=BARSLAST(E1)+1;
E3:=MA(C,E2);
E4:=SUM(AMO,E2)/SUM(VOL,E2)/100;
E5:=IF(CAPITAL>0,E4,E3);
昨开:IF(E<=CONST(E2),TMP#DAY,DRAWNULL),COLORCYAN,LINETHICK3;
TMP的指标源码如下:
REF(OPEN,1);
此指标用于分钟周期线,同时在昨开盘价的位置上画一根线.
运行示例:
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)
3)使用跨周期引用数据时注意点
可供引用的周期类型有:
MIN1,MIN5,MIN15,MIN30,MIN60,DAY,WEEK,MONTH
分别表示将1,5,15,30,60分钟K线数据,以及日,周,月K线数据,代入被引用的公式,进行运算.
{非指标引用时只可用于OPEN,HIGH,LOW,CLOSE,VOL,AMOUNT,VOLINSTK等,当前周期不支持多秒线,多分钟线和多日线,并且引用周期必须要高于当前周期,5秒线只支持引用1分钟线和5分钟线,周期数据转换得到}
TMP2:=KDJ.K#WEEK;
{跨周期指标引用,引用品种的对应周期的数据必须要先下载到本地}
跨周期指标引用不支持带参数
提示:跨周期时,可能会引用到未来数据
## 1.3 对某个时间段统计
1)某绝对时间段最高价
此脚本段求2022年8月3日到2022年12月31日间的最高价:
HH:=IF(YEAR=2022AND(MONTH>8OR(MONTH=8ANDDAY>=3))AND(MONTH<12OR(MONTH=12ANDDAY<=31)),H,0);{HH变量在该时间段内等于H,其他时间为0}
HHV(HH,0);{此例求2022年8月3日到2022年12月31日间的最高价}
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)
2)某相对时间段最高价
60天前到40天前之间的最高价
REF(HHV(H,60-40),40);
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)
### 1.4 在某个时间段内某条件满足
TT:=C/REF(C,1)>1.095;{是否涨停}
COUNT(TT,20)>0;{二十个交易日内时候涨停过}
上面的脚本配合1.3中示例可以写出历史某绝对时间段,或相对时间内是否涨停过的选股公式.
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg)
上图中的效果还可以借助Filter这个函数来实现.
### 1.5 K线绘制
示例公式:博弈K线
公式名称:博弈K线
公式脚本:
BKO:WINNER(O),NODRAW;
BKH:WINNER(H),NODRAW;
BKL:WINNER(L),NODRAW;
BKC:WINNER(C),NODRAW;
DRAWKLINE(BKH,BKO,BKL,BKC);
运行示例:
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image014.jpg)
### 1.6 创新高周期数
成交量创新高周期数脚本:
V:=IF(BARSCOUNT(C)=0,9999999999,VOL);
量创新高周期数:SUMBARS(REF(FV,1)-FV,0);
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image016.jpg)
### 1.7 脚本控制
在通达信的公式脚本中没有专门的控制语句,一切都是变量(仅有输出与不输出的区别),所以要实现应用于多种情况的脚本也要依靠变量来控制.
系统函数中有几个重要的函数就是IF,IFF,IFN,TESTSKIP.请大家注意的是通达信的函数的参数都是先计算出结果然后将参数传给函数的.因此对于TESTSKIP,最好作为一条单独的语句来使用.
公式脚本1:同1.2中的JBSJ公式.
{用于引用股票的基本数据.}
公式脚本2:FZMN分钟模拟
{用于通过几种分钟周期的数据模拟出当天对应于改周期的各项数据}
N:=IF(PERIOD=0,1,
IF(PERIOD=1,5,
IF(PERIOD=2,15,
IF(PERIOD=3,30,
IF(PERIOD=4,60,0)))));
CTRL:=TESTSKIP(N=0);{仅用于分钟周期}
TTIME1:=(TIME/100);
TTIME2:=IF(TTIME1<1000,TTIME1-930,IF(TTIME1<1100,TTIME1-1000+30,IF(TTIME1<1131,TTIME1-1100+90,IF(TTIME1<1300,120,IF(TTIME1<1400,TTIME1-1300+120,IF(TTIME1<1500,TTIME1-1400+180,240))))));
TTIME:=TTIME2/N;
YTC:="JBSJ.JYC#DAY";
YTDPC:="399300$CLOSE#DAY";
ZFS:=(C*1000/YTC)-1000;
AC:="399300$CLOSE";
ZFA:=(AC*1000/YTDPC)-1000;
DJC:(ZFS-ZFA)*YTC/1000+YTC;
DJH:IF(TTIME<2,DJC,HHV(DJC,TTIME-1));
DJL:IF(TTIME<2,DJC,LLV(DJC,TTIME-1));
DJO:REFV(DJC,TTIME-1);
{DRAWKLINE(DJH,DJO,DJL,DJC);};
公式脚本3:
在日线周期下,引用公式2中的数据(通过引用指标设置周期的方法来获得分钟周期的数据),通过K线绘制的函数就可以画出模拟的K线了.
JH:="FZMN.DJH#MIN5";
JO:="FZMN.DJO#MIN5";
JLC:="FZMN.DJL#MIN5";
JC:="FZMN.DJC#MIN5";
DRAWKLINE(JH,JO,JLC,JC);
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg)
### 1.8 横向统计函数
横向统计类函数是板块中所有股票都参与计算的函数,有:BLOCKSETNUM,HORCALC,INSORT,INSUM等四个.
其中INSUM是新加入的函数,其用法如下:
INSUM(板块名称,指标名称,指标线,计算类型),
返回板块各成分该指标相应输出安计算类型得到的计算值.计算类型:0-累加,1-平均数,2-最大值,3-最小值.
现在用INSUM计算出个股所在行业中最大和最小的涨跌幅:
1.首先新建一个指标ZDF,用于计算个股的涨跌幅.
示例公式:ZDF
公式名称:涨跌幅
公式脚本:
(C-REF(C,1))/REF(C,1);
2.新建指标TJZDF,通过INSUM函数调用ZDF指标计算出该个股所在板块成分股最大最小涨跌幅.
示例公式:TJZDF
公式名称:统计涨跌幅
公式脚本:
INSUM(HYBLOCK,'ZDF',1,2);{ZDF指标第一个输出的最大值}
INSUM(HYBLOCK,'ZDF',1,3);{ZDF指标第一个输出的最大值};
注释:
1.指标TJZDF中HYBLOCK函数用来取当前成份股所在板块
### 1.9 指标窗口定点输出函数
在新版本的公式编辑器中新加了两个绘图函数,用于定点输出文字或数字.他们就是DRAWTEXT_FIX,DRAWNUMBER_FIX.
1.RAWTEXT_FIX
固定位置显示文字.
用法:DRAWTEXT_FIX(COND,X,Y,TYPE,TEXT),当COND条件满足时,在当前指标窗口内(X,Y)位置书写文字TEXT,X,Y为书写点在窗口中相对于左上角的百分比,TYPE:0为左对齐,1为右对齐.
例如:DRAWTEXT_FIX(CURRBARSCOUNT=1ANDCLOSE/OPEN>1.08,0.5,0.5,0,'大阳线')表示最后一个交易日涨幅大于8%时在窗口中间位置显示'大阳线'字样.
2.DRAWNUMBER_FIX
固定位置显示数字.
用法:DRAWNUMBER_FIX(COND,X,Y,TYPE,NUMBER),当COND条件满足时,在当前指标窗口内(X,Y)位置书写数字NUMBER,X,Y为书写点在窗口中相对于左上角的百分比,TYPE:0为左对齐,1为右对齐.
例如:DRAWNUMBER_FIX(CURRBARSCOUNT=1ANDCLOSE/OPEN>1.08,0.5,0.5,0,C)表示最后一个交易日涨幅大于8%时在窗口中间位置显示收盘价.
现在我们举例说明这两个函数的用法:
示例公式:DRAWFIX
公式名称:DRAWFIX
公式脚本:
DRAWTEXT_FIX(ISLASTBAR,0.5,0,0,HYBLOCK),COLORYELLOW;
DRAWTEXT_FIX(ISLASTBAR,0,0,0,'股本结构:'),COLORRED;
DRAWTEXT_FIX(ISLASTBAR,0,0.1,0,'总股本:'),COLORRED;
DRAWNUMBER_FIX(ISLASTBAR,0,0.2,0,FINANCE(1)),COLORMAGENTA;
DRAWTEXT_FIX(ISLASTBAR,0.3,0.1,0,'流通A股:'),COLORGREEN;
DRAWNUMBER_FIX(ISLASTBAR,0.3,0.2,0,FINANCE(7)),COLORYELLOW;
DRAWTEXT_FIX(ISLASTBAR,0.5,0.1,0,'今日换手率:'),COLORGREEN;
DRAWNUMBER_FIX(ISLASTBAR,0.5,0.2,0,V*100/CAPITAL),COLORYELLOW;
效果图:
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image020.jpg)
注:
1.当窗口大小改变时,DRAWFIX各输出文字或数字的相对位置不变；
2.通过方向键等方式改变分析图中K线个数时,DRAWFIX窗口内的文字或数字位置不随之改变；
### 1.10 字符串函数
新加入公式管理器的字符串函数有:HYBLOCK、DYBLOCK、INBLOCK、NAMELIKE、CODELIKE、CON2STR、STR2CON、STRCAT、STRCMP、FINSTR;在公式管理器的插入函数列表中有它们的介绍.
注:字符串中含百分号时,2个百分号代表一个%
示例公式:DRAWFIX2
公式名称:DRAWFIX2
公式脚本:
ST股:=NAMELIKE('S')ORNAMELIKE('');
BE显示:=INBLOCK('上证Ａ股')ANDNOT(ST股)ANDCODELIKE('600');
DRAWTEXTFIX(NOT(BE显示),0,0,0,'本公式不适用该品种！适用品种:上证Ａ股且不是ST股且品种代码以600开头！'),COLORYELLOW;
DRAWTEXTFIX(BE显示,0,0,0,STRCAT('品种行业:',HYBLOCK)),COLORYELLOW;
DRAWTEXTFIX(BE显示,0.5,0,0,STRCAT('品种地域:',DYBLOCK)),COLORYELLOW;
DRAWTEXTFIX(BE显示,0,0.1,0,'股本结构:'),COLORRED;
DRAWTEXTFIX(BE显示,0,0.2,0,STRCAT('总股本:',STRCAT(CON2STR(FINANCE(1)/10000,0),'万股'))),COLORRED;
DRAWTEXTFIX(BE显示,0.3,0.2,0,STRCAT('流通A股:',STRCAT(CON2STR(FINANCE(7)/10000,1),'万股'))),COLORGREEN;
DRAWTEXT_FIX(BE显示,0.5,0.2,0,STRCAT('今日换手率:',STRCAT(CON2STR(V100/CAPITAL,2),'% %'))),COLORGREEN;
公式演示截图:
600361创新新材
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image022.jpg)
000008神州高铁
![](file:///C:/Users/ThinkPad/AppData/Local/Temp/msohtmlclip1/01/clip_image024.jpg)